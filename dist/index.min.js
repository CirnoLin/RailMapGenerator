!function(t){function e(e){for(var n,i,r=e[0],a=e[1],h=0,o=[];h<r.length;h++)i=r[h],Object.prototype.hasOwnProperty.call(s,i)&&s[i]&&o.push(s[i][0]),s[i]=0;for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n]);for(l&&l(e);o.length;)o.shift()()}var n={},s={3:0};function i(e){if(n[e])return n[e].exports;var s=n[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.e=function(t){var e=[],n=s[t];if(0!==n)if(n)e.push(n[2]);else{var r=new Promise((function(e,i){n=s[t]=[e,i]}));e.push(n[2]=r);var a,h=document.createElement("script");h.charset="utf-8",h.timeout=120,i.nc&&h.setAttribute("nonce",i.nc),h.src=function(t){return i.p+""+({0:"LineGZ",1:"LineHK",2:"LineSH",4:"initDesign",5:"initInfo",6:"initLayout",7:"initStations",9:"vendors~initStations"}[t]||t)+".min.js"}(t);var l=new Error;a=function(e){h.onerror=h.onload=null,clearTimeout(o);var n=s[t];if(0!==n){if(n){var i=e&&("load"===e.type?"missing":e.type),r=e&&e.target&&e.target.src;l.message="Loading chunk "+t+" failed.\n("+i+": "+r+")",l.name="ChunkLoadError",l.type=i,l.request=r,n[1](l)}s[t]=void 0}};var o=setTimeout((function(){a({type:"timeout",target:h})}),12e4);h.onerror=h.onload=a,document.head.appendChild(h)}return Promise.all(e)},i.m=t,i.c=n,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="./dist/",i.oe=function(t){throw console.error(t),t};var r=window.webpackJsonp=window.webpackJsonp||[],a=r.push.bind(r);r.push=e,r=r.slice();for(var h=0;h<r.length;h++)e(r[h]);var l=a;i(i.s=9)}([function(t,e,n){"use strict";var s,i,r;function a(t){localStorage.setItem("rmgParam",JSON.stringify(t))}function h(){return JSON.parse(localStorage.rmgParam)}function l(t,e){let n=h();n[t]=e,a(n)}function o(t){var[e,n]=t.attr("viewBox").split(" ").slice(2),s=$("canvas")[0];$("canvas").attr({width:2.5*e,height:2.5*n});var i=s.getContext("2d");i.clearRect(0,0,s.width,s.height),t.find(".rmg-name__en.rmg-name__gzmtr--station, .rmg-name__en.rmg-name__mtr--station, .rmg-name__zh.IntName").each((t,e)=>{$(e).attr("font-size","10px")}),t.find(".rmg-name__en.rmg-name__gzmtr--int").each((t,e)=>{$(e).attr("font-size","8px")}),t.find(".rmg-name__en.rmg-name__gzmtr--int-small, .rmg-name__en.IntName").each((t,e)=>{$(e).attr("font-size","7px")}),t.find(".rmg-name__en.rmg-name__gzmtr--express").each((t,e)=>{$(e).attr("font-size","6.5px")}),t.find("text:not([font-size]), tspan:not([font-size])").each((t,e)=>{$(e).attr("font-size",window.getComputedStyle(e).fontSize)}),t.find("text, tspan").each((t,e)=>{var n=window.getComputedStyle(e);$(e).attr({"font-family":n.getPropertyValue("font-family"),fill:n.getPropertyValue("fill"),"alignment-baseline":n.getPropertyValue("alignment-baseline"),"dominant-baseline":n.getPropertyValue("dominant-baseline"),"text-anchor":n.getPropertyValue("text-anchor")}).removeAttr("class")}),t.find("#strip, #dest_strip").each((t,e)=>{var n=window.getComputedStyle(e);$(e).attr({"stroke-width":n.getPropertyValue("stroke-width")})});var r=new Image;r.onload=function(){var t,s,a;i.drawImage(r,0,0,2.5*e,2.5*n),t=$("canvas")[0].toDataURL("image/png"),s="rmg_export","string"==typeof(a=document.createElement("a")).download?(a.href=t,a.download=s,document.body.appendChild(a),a.click(),document.body.removeChild(a)):window.open(t)},r.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(t[0].outerHTML)))}function c(t,e){let n=$("#"+e)[0],s=t.getBoundingClientRect(),i=n.createSVGPoint(),r=n.getScreenCTM();i.x=s.left,i.y=s.top;let a=i.matrixTransform(r.inverse());return{x:a.x,y:a.y,width:s.width,height:s.height}}function d(t,e,n){var[s,i]=t.map(t=>t.split(/\\/g)),r=$("<text>").addClass("rmg-name__zh IntName").text(s[0]);for(let t=1;t<s.length;t++)r=r.append($("<tspan>",{x:0,dy:e,"dominant-baseline":"central"}).text(s[t]));var a=(s.length,9);r=r.append($("<tspan>",{x:0,dy:a,class:"rmg-name__en IntName"}).text(i[0]));for(let t=1;t<i.length;t++)r=r.append($("<tspan>",{x:0,dy:n,class:"rmg-name__en IntName"}).text(i[t]));return[r,s.length,i.length]}function g(){return Math.floor(Math.random()*Math.pow(36,4)).toString(36).padStart(4,"0")}function _(t){let e=["癸","甲","乙","丙","丁","戊","己","庚","辛","壬","日","月","金","木","水","火","土","竹","戈","十","大","中","一","弓","人","心","手","口","尸","廿","山","女","田","難","卜","重"],n=["Zero","One","Two","Three","Four","Five","Six","Seven","Eight","Nine","Alfa","Bravo","Charlie","Delta","Echo","Foxtrot","Golf","Hotel","India","Juliett","Kilo","Lima","Mike","November","Oscar","Papa","Quebec","Romeo","Sierra","Tango","Uniform","Victor","Whiskey","X-ray","Yankee","Zulu"];return[t.split("").map(t=>e[parseInt(t,36)]).join(""),t.split("").map(t=>n[parseInt(t,36)]).join(" ")]}function u(t){return`Number of stations: ${Object.keys(t.stn_list).length-2}\n            ${Object.entries(t.stn_list).map(t=>["linestart","lineend"].includes(t[0])?"":t[1].name.join(" - ")).join("<br>").trim().replace(/\\/," ")}`}function p(t){var e=t.toUpperCase().split("");return 2==t.length?e.map(t=>String.fromCodePoint(t.codePointAt(0)+127397)).join(""):"🏴"+e.map(t=>String.fromCodePoint(t.codePointAt(0)+917536)).join("")+"󠁿"}function f(t){let e=t.match(/[\d]+/g).map(t=>Number(t).toString(16).padStart(2,"0")).join("");switch(e){case"000000":return"#000";case"ffffff":return"#fff";default:return"#"+e}}function m(){var t=h();"line_name"in t||(t.line_name=["路線名","Name of Line"]),"dest_legacy"in t||(t.dest_legacy=!1),"char_form"in t||(t.char_form=(t=>{switch(t){case"KR":return"trad";case"TC":return"tw";case"SC":return"cn";case"JP":return"jp"}})(t.fontZH[0].split(" ").reverse()[0])),delete t.fontZH,delete t.fontEN,delete t.weightZH,delete t.weightEN;for(let[e,n]of Object.entries(t.stn_list))"branch"in n||(t.stn_list[e].branch={left:[],right:[]},2==n.children.length?t.stn_list[e].branch.right=["through",n.children[1]]:t.stn_list[e].branch.right=[],2==n.parents.length?t.stn_list[e].branch.left=["through",n.parents[1]]:t.stn_list[e].branch.left=[]);"psd_num"in t||(t.psd_num=1),"line_num"in t||(t.line_num=1),delete t.style,3==t.theme.length&&t.theme.push("#fff");for(let[e,n]of Object.entries(t.stn_list))["linestart","lineend"].includes(e)||"num"in n||(t.stn_list[e].num="00");for(let[e,n]of Object.entries(t.stn_list))"interchange"in n&&n.interchange.map(t=>{t.map(t=>{5==t.length&&t.splice(3,0,"#fff")})});"info_panel_type"in t||(t.info_panel_type="panasonic");for(let[e,n]of Object.entries(t.stn_list))"osi22_end_p"===n.change_type&&(t.stn_list[e].change_type="osi22_pr"),"osi22_end_u"===n.change_type&&(t.stn_list[e].change_type="osi22_ur");for(let[e,n]of Object.entries(t.stn_list))"interchange"in n||(t.stn_list[e].interchange=[[]]);"gz_1"===t.info_panel_type&&(t.info_panel_type="gz28"),"panasonic"===t.info_panel_type&&(t.info_panel_type="gz28"),"gz_2"===t.info_panel_type&&(t.info_panel_type="gzgf"),"gz_3"===t.info_panel_type&&(t.info_panel_type="gz3"),"direction_gz_x"in t||(t.direction_gz_x=50),"direction_gz_y"in t||(t.direction_gz_y=70);for(let[e,n]of Object.entries(t.stn_list))"transfer"in n||(t.stn_list[e].transfer={type:n.change_type.split("_")[0],tick_direc:"none"===n.change_type||"int2"===n.change_type?"r":n.change_type.split("_")[1].split("").slice().reverse()[0],paid_area:-1===n.change_type.indexOf("osi")||"p"===n.change_type.split("_")[1][0],osi_names:-1!==n.change_type.indexOf("osi")?[n.interchange[1][0]]:[],info:2===n.interchange.length?[n.interchange[0],n.interchange[1].slice(1)]:n.interchange});for(let[e,n]of Object.entries(t.stn_list))"services"in n||(t.stn_list[e].services=["local"]);a(t)}n.d(e,"a",(function(){return s})),n.d(e,"c",(function(){return i})),n.d(e,"b",(function(){return r})),n.d(e,"l",(function(){return a})),n.d(e,"g",(function(){return h})),n.d(e,"n",(function(){return l})),n.d(e,"o",(function(){return o})),n.d(e,"j",(function(){return c})),n.d(e,"k",(function(){return d})),n.d(e,"h",(function(){return g})),n.d(e,"f",(function(){return _})),n.d(e,"e",(function(){return u})),n.d(e,"d",(function(){return p})),n.d(e,"m",(function(){return f})),n.d(e,"p",(function(){return m})),n.d(e,"i",(function(){return b})),function(t){t[t.left=0]="left",t[t.right=1]="right"}(s||(s={})),function(t){t[t.parents=0]="parents",t[t.children=1]="children"}(i||(i={})),function(t){t[t.city=0]="city",t[t.line=1]="line",t[t.colour=2]="colour",t[t.fg=3]="fg",t[t.nameZH=4]="nameZH",t[t.nameEN=5]="nameEN"}(r||(r={}));const b=(t,e)=>t[(t=>{switch(t){case"en":return["en"];case"zh-Hans":return["zh-Hans","zh","en"];case"zh-HK":return["zh-HK","zh-Hant","zh","en"];default:return[t,"en"]}})(e).find(e=>t[e])]},function(t,e){t.exports=jQuery},function(t,e){t.exports=mdc.dialog},function(t,e){t.exports=mdc.ripple},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var s=n(0),i=n(5);class r{constructor(t){this._longInterval=1,this.stations={},this._svgHeight=t.svg_height,this._svgWidth=t.svg_width,this._svgDestWidth=t.svg_dest_width,this._showOuter=t.show_outer,[this.themeCity,this.themeLine,this._themeColour,this._fgColour]=t.theme,this.yPc=t.y_pc,this._padding=t.padding,this._stripPc=t.strip_pc,this._branchSpacing=t.branch_spacing,this._lineNames=t.line_name;for(let[e,n]of Object.entries(t.stn_list))this.stations[e]=this._initStnInstance(e,n);this._currentStnId=t.current_stn_idx,this._direction=t.direction,this._platformNum=t.platform_num;for(let t of Object.keys(this.stations))this._updateStnInstance(t)}_initStnInstance(t,e){return new i.a(t,e)}_updateStnInstance(t){if(["linestart","lineend"].includes(t))return;let e=this.stations[t];e.x=this._stnRealX(t),e.y=this._stnRealY(t),e.state=this._stnState(t)}set svgDestWidth(t){isNaN(t)||t<=0||(this._svgDestWidth=t,Object(s.n)("svg_dest_width",t),this.drawSVGFrame(),this.drawStrip(),this.drawDestInfo())}set svgWidth(t){if(!(isNaN(t)||t<=0)){this._svgWidth=t,Object(s.n)("svg_width",t),this.drawSVGFrame();for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.x=this._stnRealX(t),e.y=this._stnRealY(t));r.clearSVG(),this.drawStns(),this.drawLine(),this.drawStrip()}}set yPc(t){this._yPc=t,Object(s.n)("y_pc",t);let e=t*this._svgHeight/100;$("g#main").attr("transform",`translate(0,${e})`)}set padding(t){t=Number(t),this._padding=t,Object(s.n)("padding",t);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.x=this._stnRealX(t));r.clearSVG(),this.drawStns(),this.drawLine()}set branchSpacing(t){this._branchSpacing=t,Object(s.n)("branch_spacing",t);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.x=this._stnRealX(t),e.y=this._stnRealY(t));r.clearSVG(),this.drawStns(),this.drawLine()}set themeColour(t){this._themeColour=t[0],this._fgColour=t[1];var e=Object(s.g)();e.theme[2]=t[0],e.theme[3]=t[1],Object(s.l)(e),this.fillThemeColour()}set direction(t){this._direction=t,Object(s.n)("direction",t);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.state=this._stnState(t));r.clearSVG(),this.drawStns(),this.drawLine(),this.drawDestInfo()}set platformNum(t){this._platformNum=t,Object(s.n)("platform_num",t),$(".rmg-name__platformnum").text(t)}set lineNames(t){this._lineNames=t,Object(s.n)("line_name",t)}set currentStnId(t){this._currentStnId=t,Object(s.n)("current_stn_idx",t);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.state=this._stnState(t));r.clearSVG(),this.drawStns(),this.drawLine(),this.drawDestInfo()}_rightWideFactor(t){return 0}_leftWideFactor(t){return 0}_pathWeight(t,e){return this.stations[t].children.includes(e)?1+this._rightWideFactor(t)+this._leftWideFactor(e):-1/0}_cp(t,e){let n=this;if(t==e)return{len:0,nodes:[t]};let s=[],i=[];this.stations[t].children.forEach(r=>{let a=n._cp(r,e);a.len<0||(s.push(this._pathWeight(t,r)+a.len),a.nodes.unshift(t),i.push(a.nodes))});let r=Math.max(...s);return{len:r,nodes:i[s.indexOf(r)]}}get criticalPath(){let t=[],e=[];this.leftDests.forEach(n=>{this.rightDests.forEach(s=>{let i=this._cp(n,s);t.push(i.len),e.push(i.nodes)})});let n=Math.max(...t);return{len:n,nodes:e[t.indexOf(n)]}}_topoOrder(t,e=[]){var n=this;return e.push(t),this.stations[t].children.forEach(s=>{2==this._stnIndegree(s)&&0==this.stations[s].parents.indexOf(t)||e.concat(n._topoOrder(s,e))}),e}get tpo(){let t=this._topoOrder("linestart");return t.slice(1,t.length-1)}get stripY(){return this._stripPc*this._svgHeight/100}get turningRadius(){return this._branchSpacing/2*(Math.sqrt(2)/(Math.sqrt(2)-1))}get lineXs(){return[this._svgWidth*this._padding/100,this._svgWidth*(1-this._padding/100)]}get leftDests(){return this.stations.linestart.children}get rightDests(){return this.stations.lineend.parents}get lValidDests(){return Array.from(new Set(this.routes.filter(t=>-1!==t.indexOf(this._currentStnId)).map(t=>t.filter(t=>"lineend"!==t&&"linestart"!==t)[0])))}get rValidDests(){return Array.from(new Set(this.routes.filter(t=>-1!==t.indexOf(this._currentStnId)).map(t=>t.filter(t=>"lineend"!==t&&"linestart"!==t).reverse()[0])))}_stnIndegree(t){return this.stations[t].inDegree}_stnOutdegree(t){return this.stations[t].outDegree}_stnXShare(t){var e=this.criticalPath;if(e.nodes.includes(t))return this._cp(e.nodes[0],t).len;for(var n=t,s=t,i=!1,r=!1;;){var a=this.stations[n].parents[0];if("linestart"==a){i=!0;break}if(n=a,this._stnOutdegree(n)>1)break}for(;;){var h=this.stations[s].children;if("lineend"==h[0]){r=!0;break}if(s=h[0],this._stnIndegree(s)>1)break}var l=this._cp(n,t).len,o=this._cp(t,s).len;if(i){var c=this._cp(e.nodes[0],s).len;return this._stnXShare(s)-o/(l+o)*c}if(r)c=this._cp(n,e.nodes.slice(-1)[0]).len;else c=this._cp(n,s).len;return this._stnXShare(n)+l/(l+o)*c}_stnRealX(t){let[e,n]=this.lineXs;return e+this._stnXShare(t)/this.criticalPath.len*(n-e)}_stnYShare(t){return this._stnYShareMTR(t)}_stnYShareMTR(t){if(["linestart","lineend"].includes(t)||this._stnIndegree(t)>1||this._stnOutdegree(t)>1)return 0;var e=this.stations[t].parents[0];let n=this;return e?1==this._stnOutdegree(e)?n._stnYShareMTR(e):0==this.stations[e].children.indexOf(t)?1:-1:0}_stnRealY(t){return-this._stnYShare(t)*this._branchSpacing}_isSuccessor(t,e){for(let n of this.routes){let s=n.indexOf(t),i=n.indexOf(e);if(-1!==s&&-1!==i&&s<i)return!0}return!1}_isPredecessor(t,e){for(let n of this.routes){let s=n.indexOf(t),i=n.indexOf(e);if(-1!==s&&-1!==i&&i<s)return!0}return!1}_stnState(t){return t==this._currentStnId?0:"r"==this._direction?this._isSuccessor(this._currentStnId,t)?1:-1:this._isPredecessor(this._currentStnId,t)?1:-1}drawSVGFrame(){$("#railmap, #outer").attr({width:this._svgWidth,height:this._svgHeight}),$("#destination, #dest_outer").attr({width:this._svgDestWidth,height:this._svgHeight})}showFrameOuter(){this._showOuter?$("#outer, #dest_outer").show():$("#outer, #dest_outer").hide()}drawStns(){for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||$("#stn_icons").append(e.html);$("#stn_icons").html($("#stn_icons").html())}get stnDX(){return this.turningRadius-this._branchSpacing/2}get stnDY(){return this._branchSpacing/2}get stnExtraH(){var[t,e]=this.lineXs;return(e-t)/this.criticalPath.len*this._longInterval}get stnSpareH(){var[t,e]=this.lineXs,n=((e-t)/this.criticalPath.len-2*this.stnDX)/2;return n<0&&console.warn(`SVG width too small! ${n}`),n}get pathTurnENE(){return`a ${this.turningRadius},${this.turningRadius} 0 0,0 ${this.stnDX},${-this.stnDY}`}get pathTurnNEE(){return`a ${this.turningRadius},${this.turningRadius} 0 0,1 ${this.stnDX},${-this.stnDY}`}get pathTurnESE(){return`a ${this.turningRadius},${this.turningRadius} 0 0,1 ${this.stnDX},${this.stnDY}`}get pathTurnSEE(){return`a ${this.turningRadius},${this.turningRadius} 0 0,0 ${this.stnDX},${this.stnDY}`}_linePath(t){var[e,n,s]=[],i=[],{stnExtraH:r,stnSpareH:a,pathTurnESE:h,pathTurnSEE:l,pathTurnENE:o,pathTurnNEE:c,stnDX:d}=this;return t.forEach(t=>{var[g,_]=["_stnRealX","_stnRealY"].map(e=>this[e](t));if(!n&&0!==n)return[e,s,n]=[t,g,_],void i.push(`M ${g},${_}`);_>n?(i.push(0===_?`h ${g-s-r*this._leftWideFactor(t)-a-2*d}`:`h ${r*this._rightWideFactor(e)+a}`),i.push(h,l)):_<n&&(i.push(0===_?`h ${g-s-r*this._leftWideFactor(t)-a-2*d}`:`h ${r*this._rightWideFactor(e)+a}`),i.push(o,c)),i.push(`H ${g}`),[e,s,n]=[t,g,_]}),i.join(" ").replace(/( H ([\d.]+))+/g," H $2")}drawLine(){this.branches.map(t=>{var e=t.filter(t=>this.stations[t].state>=0),n=t.filter(t=>this.stations[t].state<=0);1===e.length&&(n=t),0==e.filter(t=>-1!==n.indexOf(t)).length&&e.length&&(n[0]===t[0]?n.push(e[0]):e[0]===t[0]&&e[e.length-1]===t[t.length-1]&&n.length?(n=t,e=[]):n.unshift(e[e.length-1])),$("#line_main").append($("<path>",{d:this._linePath(e)})),$("#line_pass").append($("<path>",{d:this._linePath(n)}))}),$("#line_main").html($("#line_main").html()),$("#line_pass").html($("#line_pass").html())}drawStrip(){$("#strip").attr("d",`M 0,${this.stripY} H ${this._svgWidth}`),$("#dest_strip").attr("d",`M 0,${this.stripY} H ${this._svgDestWidth}`)}fillThemeColour(){$("#line_main, #strip, #dest_strip").attr("stroke",this._themeColour),$("#dest_name > #platform > circle").attr("fill",this._themeColour)}drawDestInfo(){}updateStnName(t,e,n){let i=Object(s.g)();i.stn_list[t].name=e,i.stn_list[t].num=n,Object(s.l)(i),this.stations[t].name=e,this.stations[t].stnNum=n,$(`#stn_icons #${t}`).remove(),$("#stn_icons").append(this.stations[t].html),$("#stn_icons").html($("#stn_icons").html()),this.leftDests.includes(t)&&"l"==this._direction?this.drawDestInfo():this.rightDests.includes(t)&&"r"==this._direction&&this.drawDestInfo()}updateStnServices(t,e){if(e.selected){if(this.stations[t].services.has(e.chipId))return;this.stations[t].services.add(e.chipId)}else if(!this.stations[t].services.delete(e.chipId))return;let n=Object(s.g)();n.stn_list[t].services=Array.from(this.stations[t].services),Object(s.l)(n)}updateStnTransfer(t,e,n=null){this.stations[t].constructor.name;let i=e.split("_")[0],a="none"===e||"int2"===e?"r":e.split("_")[1].split("").slice().reverse()[0],h=-1===e.indexOf("osi")||"p"===e.split("_")[1][0],l=-1!==e.indexOf("osi")?[n[1][0]]:[],o=2===n.length?[n[0],n[1].slice(1)]:n;var c=Object(s.g)();c.stn_list[t].change_type=e,"none"==e?(c.stn_list[t].interchange=[[]],c.stn_list[t].transfer={type:i,tick_direc:a,paid_area:h,osi_names:[],info:[[]]}):(c.stn_list[t].interchange=n,c.stn_list[t].transfer={type:i,tick_direc:a,paid_area:h,osi_names:l,info:o}),Object(s.l)(c),this.stations[t]=this._initStnInstance(t,c.stn_list[t]);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||this._updateStnInstance(t);r.clearSVG(),this.drawStns(),this.drawLine(),this.drawStrip()}removeStn(t){var e=Object(s.g)(),n=this.stations[t].parents,i=this.stations[t].children,a=!0;for(let e in this.stations)if(![t,"linestart","lineend"].includes(e)&&0==this._stnYShareMTR(e)){a=!1;break}if(2==n.length&&2==i.length)return!1;if(a)return!1;if(4==Object.keys(e.stn_list).length)return!1;if(2==n.length||2==i.length)n.forEach(t=>{e.stn_list[t].children=i,this.stations[t].children=i}),i.forEach(t=>{e.stn_list[t].parents=n,this.stations[t].parents=n}),1==n.length&&(e.stn_list[n[0]].branch.right=this.stations[t].branch.right,this.stations[n[0]].branch.right=this.stations[t].branch.right),1==i.length&&(e.stn_list[i[0]].branch.left=this.stations[t].branch.left,this.stations[i[0]].branch.left=this.stations[t].branch.left);else if(2==this._stnOutdegree(n[0])&&2==this._stnIndegree(i[0])){var h=this.stations[n[0]].children.indexOf(t),l=this.stations[i[0]].parents.indexOf(t);e.stn_list[n[0]].children.splice(h,1),this.stations[n[0]].children.splice(h,1),e.stn_list[i[0]].parents.splice(l,1),this.stations[i[0]].parents.splice(l,1),e.stn_list[n[0]].branch.right=[],this.stations[n[0]].branch.right=[],e.stn_list[i[0]].branch.left=[],this.stations[i[0]].branch.left=[]}else n.forEach(n=>{var s=e.stn_list[n].children.indexOf(t);i.length?(e.stn_list[n].children[s]=i[0],this.stations[n].children[s]=i[0]):(e.stn_list[n].children.splice(s,1),this.stations[n].children.splice(s,1)),this.stations[n].branch.right[1]===t&&(this.stations[n].branch.right[1]=i[0],e.stn_list[n].branch.right[1]=i[0])}),i.forEach(s=>{var i=e.stn_list[s].parents.indexOf(t);n.length?(e.stn_list[s].parents[i]=n[0],this.stations[s].parents[i]=n[0]):(e.stn_list[s].parents.splice(i,1),this.stations[s].parents.splice(i,1)),this.stations[s].branch.left[1]===t&&(this.stations[s].branch.left[1]=n[0],e.stn_list[s].branch.left[1]=n[0])});delete e.stn_list[t],delete this.stations[t];if(this._currentStnId==t){var o=Object.keys(this.stations)[2];this._currentStnId=o,e.current_stn_idx=o,!0}Object(s.l)(e),n.concat(i).forEach(t=>{["linestart","lineend"].includes(t)||(this.stations[t]=this._initStnInstance(t,e.stn_list[t]))});for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||this._updateStnInstance(t);return r.clearSVG(),this.drawStns(),this.drawLine(),this.drawStrip(),this.drawDestInfo(),!0}newStnPossibleLoc(t,e){switch("before"==t?this._stnIndegree(e):this._stnOutdegree(e)){case 2:return[1,1,1,[],[]];case 1:if(0==this._stnYShareMTR(e)){let n=this.newBranchPossibleEnd(t,e);return n=n.length?n:[],[1,0,0,n,n]}return this._stnYShareMTR(e)<0?"before"==t?[this._stnOutdegree(this.stations[e].parents[0])-1,0,1,[],[]]:[this._stnIndegree(this.stations[e].children[0])-1,0,1,[],[]]:"before"==t?[this._stnOutdegree(this.stations[e].parents[0])-1,1,0,[],[]]:[this._stnIndegree(this.stations[e].children[0])-1,1,0,[],[]]}return[0,0,0,[],[]]}newBranchPossibleEnd(t,e){let n=[];if("before"==t){for(;1==this._stnIndegree(e);)e=this.stations[e].parents[0],n.unshift(e);n.pop()}else{for(;1==this._stnOutdegree(e);)e=this.stations[e].children[0],n.push(e);n.shift()}return n}addStn(t,e,n,i){let a=Object(s.h)();for(;Object.keys(this.stations).includes(a);)a=Object(s.h)();let h=Object(s.g)(),l={};"before"==t?"centre"==n?(l.parents=this.stations[e].parents,0==this._stnIndegree(e)&&0!=this._stnYShareMTR(e)?l.children=this.leftDests:0!=this._stnYShareMTR(e)?(l.children=this.stations[this.stations[e].parents[0]].children,l.branch={left:[],right:this.stations[l.parents[0]].branch.right},this.stations[l.parents[0]].branch.right=[],h.stn_list[l.parents[0]].branch.right=[]):(l.children=[e],l.branch={left:this.stations[e].branch.left,right:[]},this.stations[e].branch.left=[],h.stn_list[e].branch.left=[]),l.parents.forEach(t=>{this.stations[t].children=[a],h.stn_list[t].children=[a]}),l.children.forEach(t=>{this.stations[t].parents=[a],h.stn_list[t].parents=[a]})):"upper"==n?(l.branch={left:[],right:[]},2==this._stnIndegree(e)?(this.stations[e].branch.left[1]==this.stations[e].parents[0]&&(this.stations[e].branch.left[1]=a,h.stn_list[e].branch.left[1]=a),l.parents=this.stations[e].parents.slice(0,1),l.children=[e],l.parents.forEach(t=>{this.stations[t].children=[a],h.stn_list[t].children=[a]}),this.stations[e].parents[0]=a,h.stn_list[e].parents[0]=a):(l.parents=this.stations[e].parents,l.children=[e],l.parents.forEach(t=>{this.stations[t].children[0]=a,h.stn_list[t].children[0]=a,this.stations[t].branch.right[1]===e&&(this.stations[t].branch.right[1]=a,h.stn_list[t].branch.right[1]=a)}),l.children.forEach(t=>{this.stations[t].parents=[a],h.stn_list[t].parents=[a]}))):"lower"==n?(l.branch={left:[],right:[]},2==this._stnIndegree(e)?(this.stations[e].branch.left[1]==this.stations[e].parents[1]&&(this.stations[e].branch.left[1]=a,h.stn_list[e].branch.left[1]=a),l.parents=this.stations[e].parents.slice(1),l.children=[e],l.parents.forEach(t=>{this.stations[t].children=[a],h.stn_list[t].children=[a]}),this.stations[e].parents[1]=a,h.stn_list[e].parents[1]=a):(l.parents=this.stations[e].parents,l.children=[e],l.parents.forEach(t=>{let n=this.stations[t].children.length;this.stations[t].children[n-1]=a,h.stn_list[t].children[n-1]=a,this.stations[t].branch.right[1]===e&&(this.stations[t].branch.right[1]=a,h.stn_list[t].branch.right[1]=a)}),l.children.forEach(t=>{this.stations[t].parents=[a],h.stn_list[t].parents=[a]}))):"newupper"==n?(l.branch={left:[],right:[]},this.stations[e].branch.left=["through",a],h.stn_list[e].branch.left=["through",a],this.stations[i].branch.right=["through",a],h.stn_list[i].branch.right=["through",a],l.parents=[i],l.children=[e],this.stations[i].children.unshift(a),h.stn_list[i].children.unshift(a),this.stations[e].parents.unshift(a),h.stn_list[e].parents.unshift(a)):"newlower"==n&&(l.branch={left:[],right:[]},this.stations[e].branch.left=["through",a],h.stn_list[e].branch.left=["through",a],this.stations[i].branch.right=["through",a],h.stn_list[i].branch.right=["through",a],l.parents=[i],l.children=[e],this.stations[i].children.push(a),h.stn_list[i].children.push(a),this.stations[e].parents.push(a),h.stn_list[e].parents.push(a)):"centre"==n?(l.children=this.stations[e].children,0==this._stnOutdegree(e)&&0!=this._stnYShareMTR(e)?l.parents=this.rightDests:0!=this._stnYShareMTR(e)?(l.parents=this.stations[this.stations[e].children[0]].parents,l.branch={left:this.stations[l.children[0]].branch.left,right:[]},this.stations[l.children[0]].branch.left=[],h.stn_list[l.children[0]].branch.left=[]):(l.parents=[e],l.branch={left:[],right:this.stations[e].branch.right},this.stations[e].branch.right=[],h.stn_list[e].branch.right=[]),l.children.forEach(t=>{this.stations[t].parents=[a],h.stn_list[t].parents=[a]}),l.parents.forEach(t=>{this.stations[t].children=[a],h.stn_list[t].children=[a]})):"upper"==n?(l.branch={left:[],right:[]},2==this._stnOutdegree(e)?(this.stations[e].branch.right[1]==this.stations[e].children[0]&&(this.stations[e].branch.right[1]=a,h.stn_list[e].branch.right[1]=a),l.children=this.stations[e].children.slice(0,1),l.parents=[e],l.children.forEach(t=>{this.stations[t].parents=[a],h.stn_list[t].parents=[a]}),this.stations[e].children[0]=a,h.stn_list[e].children[0]=a):(l.children=this.stations[e].children,l.parents=[e],l.children.forEach(t=>{this.stations[t].parents[0]=a,h.stn_list[t].parents[0]=a,this.stations[t].branch.left[1]===e&&(this.stations[t].branch.left[1]=a,h.stn_list[t].branch.left[1]=a)}),l.parents.forEach(t=>{this.stations[t].children=[a],h.stn_list[t].children=[a]}))):"lower"==n?(l.branch={left:[],right:[]},2==this._stnOutdegree(e)?(this.stations[e].branch.right[1]==this.stations[e].children[1]&&(this.stations[e].branch.right[1]=a,h.stn_list[e].branch.right[1]=a),l.children=this.stations[e].children.slice(1),l.parents=[e],l.children.forEach(t=>{this.stations[t].parents=[a],h.stn_list[t].parents=[a]}),this.stations[e].children[1]=a,h.stn_list[e].children[1]=a):(l.children=this.stations[e].children,l.parents=[e],l.children.forEach(t=>{1===this._stnIndegree(t)?(this.stations[t].parents[0]=a,h.stn_list[t].parents[0]=a):(this.stations[t].parents[1]=a,h.stn_list[t].parents[1]=a),this.stations[t].branch.left[1]===e&&(this.stations[t].branch.left[1]=a,h.stn_list[t].branch.left[1]=a)}),l.parents.forEach(t=>{this.stations[t].children=[a],h.stn_list[t].children=[a]}))):"newupper"==n?(l.branch={left:[],right:[]},this.stations[e].branch.right=["through",a],h.stn_list[e].branch.right=["through",a],this.stations[i].branch.left=["through",a],h.stn_list[i].branch.left=["through",a],l.children=[i],l.parents=[e],this.stations[i].parents.unshift(a),h.stn_list[i].parents.unshift(a),this.stations[e].children.unshift(a),h.stn_list[e].children.unshift(a)):"newlower"==n&&(l.branch={left:[],right:[]},this.stations[e].branch.right=["through",a],h.stn_list[e].branch.right=["through",a],this.stations[i].branch.left=["through",a],h.stn_list[i].branch.left=["through",a],l.children=[i],l.parents=[e],this.stations[i].parents.push(a),h.stn_list[i].parents.push(a),this.stations[e].children.push(a),h.stn_list[e].children.push(a)),l.name=Object(s.f)(a),l.change_type="none",l.num="00",l.interchange=[[]],l.services=["local"],l.transfer={info:[[]],type:"none",osi_names:[],paid_area:!0,tick_direc:"r"},h.stn_list[a]=l,Object(s.l)(h),this.stations[a]=this._initStnInstance(a,l),this.stations[e]=this._initStnInstance(e,Object(s.g)().stn_list[e]);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||this._updateStnInstance(t);return r.clearSVG(),this.drawStns(),this.drawLine(),this.drawStrip(),this.drawDestInfo(),[a,l]}reverseStns(){var t=Object(s.g)();for(let[n,s]of Object.entries(this.stations))if("linestart"===n)t.stn_list.lineend.parents=s.children.reverse(),t.stn_list.lineend.branch={left:s.branch.right,right:[]};else if("lineend"===n)t.stn_list.linestart.children=s.parents.reverse(),t.stn_list.linestart.branch={left:[],right:s.branch.left};else{var e=s.children.reverse().map(t=>{switch(t){case"linestart":return"lineend";case"lineend":return"linestart";default:return t}});t.stn_list[n].children=s.parents.reverse().map(t=>{switch(t){case"linestart":return"lineend";case"lineend":return"linestart";default:return t}}),t.stn_list[n].parents=e,t.stn_list[n].branch.left=s.branch.right,t.stn_list[n].branch.right=s.branch.left}Object(s.l)(t),location.reload(!0)}updateBranchType(t,e,n){let i=s.a[e];if(this.stations[t].branch[i][0]===n)return!1;this.stations[t].branch[i][0]=n;let a=Object(s.g)();a.stn_list[t].branch[i][0]=n,Object(s.l)(a);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.state=this._stnState(t));return r.clearSVG(),this.drawStns(),this.drawLine(),this.drawDestInfo(),!0}updateBranchFirst(t,e,n){let i=s.a[e];if(this.stations[t].branch[i][1]===n)return!1;let a=n,h=Object(s.g)();if("right"===i){for(;1===this.stations[a].inDegree;)a=this.stations[a].children[0];let e=this.stations[t].children.indexOf(n);this.stations[t].branch.right[1]=h.stn_list[t].branch.right[1]=n,this.stations[a].branch.left[1]=h.stn_list[a].branch.left[1]=this.stations[a].parents[e]}else{for(;1===this.stations[a].outDegree;)a=this.stations[a].parents[0];let e=this.stations[t].parents.indexOf(n);this.stations[t].branch.left[1]=h.stn_list[t].branch.left[1]=n,this.stations[a].branch.right[1]=h.stn_list[a].branch.right[1]=this.stations[a].children[e]}Object(s.l)(h);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.x=this._stnRealX(t),e.y=this._stnRealY(t),e.state=this._stnState(t));return r.clearSVG(),this.drawStns(),this.drawLine(),this.drawDestInfo(),!0}updateBranchPos(t,e,n){let i=s.a[e];if("right"===i){if(this.stations[t].children.indexOf(this.stations[t].branch.right[1])===n)return!1}else if(this.stations[t].parents.indexOf(this.stations[t].branch.left[1])===n)return!1;let a=this.stations[t].branch[i][1],h=Object(s.g)();if("right"===i){for(;1===this.stations[a].inDegree;)a=this.stations[a].children[0];this.stations[t].children.reverse(),h.stn_list[t].children.reverse(),this.stations[a].parents.reverse(),h.stn_list[a].parents.reverse()}else{for(;1===this.stations[a].outDegree;)a=this.stations[a].parents[0];this.stations[t].parents.reverse(),h.stn_list[t].parents.reverse(),this.stations[a].children.reverse(),h.stn_list[a].children.reverse()}Object(s.l)(h);for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||(e.x=this._stnRealX(t),e.y=this._stnRealY(t));return r.clearSVG(),this.drawStns(),this.drawLine(),this.drawDestInfo(),!0}static clearSVG(){$("#stn_icons, #line_main, #line_pass").empty()}static initSVG(t){t.drawSVGFrame(),t.showFrameOuter(),t.drawStns(),t.fillThemeColour(),t.drawLine(),t.drawStrip(),t.drawDestInfo()}get branches(){for(var t=["linestart"],e=[[]],n=0;t.length;){var s=t.shift(),i=e[n][0]||null,r=[s];for(i&&r.unshift(i);"lineend"!=s&&("linestart"==s||i!=this.stations[s].branch.left[1]);){i=s;var a=this.stations[i].children;switch(a.length){case 1:s=a[0];break;case 2:if(e.push([i]),"linestart"==i)var h=this.stations[i].branch.right[1];else h=this.stations[i].branch.right[1];t.push(h),s=a.filter(t=>t!=h)[0]}r.push(s)}e[n]=r,n++}return e.map(t=>t.filter(t=>!["linestart","lineend"].includes(t)))}get routes(){for(var t=["linestart"],e=[["linestart"]],n=0;t.length;){var s=t.shift(),i=e[n].slice().reverse()[0]||null;for(i&&"linestart"!==s?e[n].push(s):e[n]=[s];"lineend"!==s;){i=s;var r=this.stations[i].children;switch(r.length){case 1:s=r[0];break;case 2:var a=this.stations[i].branch.right[1];"through"===this.stations[i].branch.right[0]?(e.push(e[n].slice()),t.push(a)):0===n&&(e.push([i]),t.push(a)),s=r.filter(t=>t!=a)[0]}if(e[n].push(s),i===this.stations[s].branch.left[1]&&"nonthrough"===this.stations[s].branch.left[0])break}n++}return e}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));class s{constructor(t,e){this.STN_NAME_Y=-10.5,this.STN_NAME_BASE_HEIGHT=30.390625,this.STN_NAME_LINE_GAP=14,this.STN_NAME_BG_ADJUST=.5,this.id=t,this.parents=e.parents,this.children=e.children,this.name=e.name,this.branch=e.branch,this.services=new Set(e.services)}get inDegree(){return this.parents.length}get outDegree(){return this.children.length}get nameClass(){switch(this.state){case-1:return"Pass";case 0:return"Current";default:return"Future"}}get _nameTxtAnchor(){return"middle"}get _nameDX(){return 0}get _nameDY(){return 0}get nameHTML(){var t=this.name[1].split("\\");if(this.namePos)var e=this.STN_NAME_LINE_GAP-this.STN_NAME_Y-this.STN_NAME_BG_ADJUST;else e=-this.STN_NAME_LINE_GAP-this.STN_NAME_Y-this.STN_NAME_BASE_HEIGHT-10*(t.length-1);0===this.state&&$("#current_bg").attr({y:this.y+e+this.STN_NAME_Y-1.5+this._nameDY,height:this.STN_NAME_BASE_HEIGHT+10*(t.length-1)+2+1.5});for(var n=t.shift(),s=$("<text>",{dy:15,class:"rmg-name__en rmg-name__mtr--station"}).text(n);n=t.shift();)s.append($("<tspan>",{x:0,dy:10,"alignment-baseline":"middle"}).text(n));return $("<g>",{transform:`translate(${this.x+this._nameDX},${this.y+e+this._nameDY})`,"text-anchor":this._nameTxtAnchor,class:`Name ${this.nameClass}`}).append($("<text>").addClass("rmg-name__zh rmg-name__mtr--station").text(this.name[0])).append(s)}get iconClass(){return-1==this.state?"rmg-stn__mtr--pass":"rmg-stn__mtr--future"}get iconHTML(){return $("<use>",{"xlink:href":"#stn_hk",x:this.x,y:this.y,class:this.iconClass})}get ungrpHTML(){return[this.iconHTML,this.nameHTML]}get html(){return $("<g>",{id:this.id}).append(...this.ungrpHTML)}}},function(t,e){t.exports=mdc.list},function(t,e){t.exports=mdc.tabBar},,function(t,e,n){"use strict";n.r(e);var s=n(0),i=n(4),r=n(2),a=n(6),h=n(3);var l=n(1),o=function(t,e,n,s){return new(n||(n=Promise))((function(i,r){function a(t){try{l(s.next(t))}catch(t){r(t)}}function h(t){try{l(s.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,h)}l((s=s.apply(t,e||[])).next())}))};var c=n(7);switch((window.urlParams.get("lang")||localStorage.rmgLang||navigator.language.split("-").slice(0,2).join("-")).toLowerCase()){case"zh-cn":case"zh-hans":window.urlParams.set("lang","zh-Hans");break;case"zh":case"zh-hk":case"zh-tw":window.urlParams.set("lang","zh-HK");break;default:window.urlParams.set("lang","en")}switch(window.urlParams.get("style")){case"mtr":case"gzmtr":case"shmetro":break;default:window.urlParams.set("style","mtr")}history.pushState({url:window.location.href},null,"?"+window.urlParams.toString()),l("head").append(...["share","destination","railmap"].map(t=>l("<link>",{rel:"stylesheet",href:`styles/${t}_${window.urlParams.get("style")}.css`,id:`css_${t}`}))),window.myLine=null,l(`[${window.urlParams.get("style")}-specific]`).show(),function(){const[t,e,n,l,o,c]=["#template_diag","#import_diag","#export_diag","#preview_diag","#style_diag","#lang_diag"].map(t=>r.MDCDialog.attachTo($(t)[0])),[d,g]=$("#panel_save .mdc-list").map((t,e)=>a.MDCList.attachTo(e)).get();$("#panel_save .mdc-list li").map((t,e)=>new h.MDCRipple(e)),d.listen("MDCList:action",e=>{switch(e.detail.index){case 0:t.open();break;case 1:$("#upload_file").click();break;case 2:$("<a>",{href:"data:application/json;base64,"+btoa(unescape(encodeURIComponent(localStorage.rmgParam))),download:"rmg_param.json"})[0].click();break;case 3:n.open()}}),$("#panel_save .mdc-list:nth-child(2) li:first-child span:nth-child(2) span:last-child").attr("trans-tag",$(`#style_diag [data-mdc-dialog-action="${window.urlParams.get("style")}"] span`).attr("trans-tag")).text($(`#style_diag [data-mdc-dialog-action="${window.urlParams.get("style")}"] span`).text()),$("#panel_save .mdc-list:nth-child(2) li:nth-child(2) span:nth-child(2) span:last-child").text($(`#lang_diag [data-mdc-dialog-action="${window.urlParams.get("lang")}"] span`).text()),g.listen("MDCList:action",t=>{switch(t.detail.index){case 0:o.open();break;case 1:c.open()}}),$.getJSON("templates/template_list.json",t=>{var e=window.urlParams.get("lang");t.forEach(t=>{$("#template_diag ul").append($("<li>",{class:"mdc-list-item","data-mdc-dialog-action":t.filename}).append($("<span>",{class:"mdc-list-item__text"}).text(Object(s.i)(t.desc,e))))}),$("#template_diag li:first-child").attr("tabindex",0),$("#theme_line__selection li").map((t,e)=>new h.MDCRipple(e))}),t.listen("MDCDialog:closed",t=>{"close"!=t.detail.action&&$.getJSON(`templates/${t.detail.action}.json`,t=>{localStorage.rmgParam=JSON.stringify(t),location.reload(!0)})}),n.listen("MDCDialog:closed",t=>{switch(t.detail.action){case"close":break;case"svg1":$("#preview_diag").attr("for","destination"),l.open();break;case"svg2":$("#preview_diag").attr("for","railmap"),l.open()}}),$(window).on("resize",t=>{_()});const _=()=>{var t=$("preview_diag").attr("for"),[e,n]=["destination"==t?Object(s.g)().svg_dest_width:Object(s.g)().svg_width,Object(s.g)().svg_height],i=$(window).width()-32-50,r=$(window).height()-60-53-60,a=Math.min(i/e,r/n);$("#preview_diag").find("svg").attr({width:e*a,height:n*a}),$("#preview_diag").find(".mdc-dialog__surface").attr("style",`max-width:${i+50}px;`)};let u;l.listen("MDCDialog:opened",t=>{var e=$(t.target).attr("for"),[n,i]=["destination"==e?Object(s.g)().svg_dest_width:Object(s.g)().svg_width,Object(s.g)().svg_height];$("#preview_diag .mdc-dialog__surface").attr("style",`max-width:${$(window).width()-32}px;`);var r=$(window).width()-32-50,a=$(window).height()-60-53-60,h=Math.min(r/n,a/i);$(t.target).find(".mdc-dialog__content").append($("#"+$(t.target).attr("for")).clone().attr({style:"all:initial;",viewBox:`0 0 ${n} ${i}`,width:n*h,height:i*h}));let l=["share",$(t.target).find("svg")[0].id].map(t=>Array.from($(`link#css_${t}`)[0].sheet.cssRules).map(t=>t.cssText).join(" "));$(t.target).find("svg").prepend(...l.map(t=>$("<style>").text(t))),$(t.target).find('svg [style="display: none;"]').remove()}),l.listen("MDCDialog:closed",t=>{if("close"!==t.detail.action){if("png"===t.detail.action)return Object(s.o)($(t.target).removeAttr("for").find("svg")),void $(t.target).find(".mdc-dialog__content").empty();if("svg"===t.detail.action){let n=$(t.target).find(".mdc-dialog__content svg");var e=document.createElement("a");e.href="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(n[0].outerHTML))),e.download="rmg_export.svg",e.click(),$(t.target).removeAttr("for").find(".mdc-dialog__content").empty()}}else $(t.target).removeAttr("for").find(".mdc-dialog__content").empty()}),$("#upload_file").on("change",t=>{console.log(t.target.files[0]);let n=new FileReader;n.onload=function(t){console.log(t.target),u=JSON.parse(t.target.result),$("#import_diag").find(".mdc-dialog__content").html(Object(s.e)(u)),e.open()},n.readAsText(t.target.files[0])}),e.listen("MDCDialog:closed",t=>{"close"!=t.detail.action?(i.a.clearSVG(),localStorage.rmgParam=JSON.stringify(u),location.reload(!0)):$("#upload_file")[0].value=""}),o.listen("MDCDialog:closed",t=>{switch(t.detail.action){case"close":case window.urlParams.get("style"):return;default:window.urlParams.set("style",t.detail.action),window.location.href="?"+window.urlParams.toString()}}),c.listen("MDCDialog:closed",t=>{if("close"!=t.detail.action){var e=t.detail.action;localStorage.rmgLang=e,e!=window.urlParams.get("lang")&&(window.urlParams.set("lang",e),window.location.href="?"+window.urlParams.toString())}})}(),function(){const t=t=>o(this,void 0,void 0,(function*(){let e=yield(s=window.urlParams.get("style"),o(void 0,void 0,void 0,(function*(){switch(s){case"mtr":return n.e(1).then(n.bind(null,20)).then(({RMGLineHK:t})=>t);case"gzmtr":return n.e(0).then(n.bind(null,21)).then(({RMGLineGZ:t})=>t);case"shmetro":return n.e(2).then(n.bind(null,22)).then(({RMGLineSH:t})=>t)}})));var s;window.myLine=yield new e(t),e.initSVG(window.myLine)}));if(null!=localStorage.rmgParam)try{Object(s.p)(),t(Object(s.g)())}catch(t){let e=r.MDCDialog.attachTo($("#init_err_diag")[0]);$("#init_err_diag").find("#err_stack").html(t+"<br>"+t.stack.replace(/\n/g,"<br>")),e.open(),console.error(t)}else $.getJSON("templates/blank.json",e=>{localStorage.rmgParam=JSON.stringify(e),Object(s.p)(),t(Object(s.g)())})}(),function(){let t=[!1,!0,!0,!0,!0];window.sliders=[],c.MDCTabBar.attachTo($("#panels .mdc-tab-bar")[0]).listen("MDCTabBar:activated",e=>{$(".panel--active").removeClass("panel--active"),$(".panel").eq(e.detail.index).addClass("panel--active"),1==e.detail.index&&t[1]&&n.e(6).then(n.bind(null,15)).then(e=>{e.common(),"gzmtr"===window.urlParams.get("style")&&e.gzmtr(),t[1]=!1}),1===e.detail.index&&window.sliders.forEach(t=>t.layout()),2==e.detail.index&&t[2]&&n.e(4).then(n.bind(null,16)).then(e=>{switch(e.common(),window.urlParams.get("style")){case"mtr":e.mtr();break;case"gzmtr":e.gzmtr()}t[2]=!1}),3==e.detail.index&&t[3]&&Promise.all([n.e(9),n.e(7)]).then(n.bind(null,17)).then(e=>{e.common(),t[3]=!1}),4==e.detail.index&&t[4]&&n.e(5).then(n.bind(null,18)).then(e=>{e.common(),t[4]=!1})})}()},function(t,e){t.exports=mdc.textField},function(t,e){t.exports=mdc.select},function(t,e){t.exports=mdc.switchControl},function(t,e){t.exports=mdc.slider}]);