(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{18:function(e,t,n){"use strict";n.r(t),n.d(t,"common",(function(){return u}));var a=n(0),i=n(3),d=n(11),l=n(10),c=n(7),o=n(20),s=n(4),r=n(12);const _=(e,t,n)=>$("<div>",{id:e,class:"mdc-card mdc-layout-grid__cell--span-2-desktop mdc-layout-grid__cell--span-4-tablet mdc-layout-grid__cell--span-2-phone station-card"}).append($("<div>",{class:"mdc-card__primary-action"}).append($("<div>",{class:"mdc-card__media mdc-card__media--16-9"})).append($("<div>",{class:"mdc-card__media-content station-card__content"}).html(t.join("<br>")).prepend($("<span>").css("display","gzmtr"===window.urlParams.get("style")?"inline":"none").text(n+" ")))).append($("<div>",{class:"mdc-card__actions"}).append($("<div>",{class:"mdc-card__action-icons"}).append($("<button>",{title:"Set As Current",class:"material-icons mdc-icon-button mdc-card__action mdc-card__action--icon"}).text("my_location")).append($("<button>",{title:"Interchange",class:"material-icons mdc-icon-button mdc-card__action mdc-card__action--icon"}).text("edit")).append($("<button>",{title:"Remove",class:"material-icons mdc-icon-button mdc-card__action mdc-card__action--icon"}).text("delete_forever")))),p=e=>$("<div>",{class:"mdc-chip",role:"row"}).css({"background-color":e[a.b.colour],color:e[a.b.fg]}).data("theme",{city:e[a.b.city],line:e[a.b.line]}).append($("<div>",{class:"mdc-chip__ripple"})).append($("<span>",{role:"gridcell"}).append($("<span>",{role:"button",tabindex:0,class:"mdc-chip__text"}).html(e[a.b.nameZH]+"<br>"+e[a.b.nameEN]))).append($("<span>",{role:"gridcell"}).append($("<i>",{class:"material-icons mdc-chip__icon mdc-chip__icon--trailing",tabindex:-1,role:"button"}).text("cancel")))[0],m=e=>{let t,n=e.map(e=>$(e).find(".mdc-chip").get().map(e=>{return t=e,[$(t).data("theme").city,$(t).data("theme").line,Object(a.m)($(t).css("background-color")),Object(a.m)($(t).css("color")),$(t).find(".mdc-chip__text").html().split("<br>")[0],$(t).find(".mdc-chip__text").html().split("<br>")[1]];var t})),i=n.map(e=>e.length);return 0===i[1]&&(n=[n[0]]),t=3===i[0]&&0===i[1]?"int3":2===i[0]&&1===i[1]?"osi31":2===i[0]&&0===i[1]?"int3":1===i[0]&&2===i[1]?"osi22":1===i[0]&&1===i[1]?"osi21":1===i[0]&&0===i[1]?"int2":0===i[0]&&3===i[1]?"osi13":0===i[0]&&2===i[1]?"osi12":0===i[0]&&1===i[1]?"osi11":0===i[0]&&0===i[1]?"none":"int3",console.log(t),{info:n,changeType:t}},h=(e,t,n)=>{let a,{changeType:i,info:d}=m(e),l=d,c=$("#stn_edit_diag").attr("for");if(-1!==i.indexOf("osi")){let e=$("button#osi_name .mdc-button__label").html().split("<br>");l[1].unshift(e)}a=t.selectedChipIds.length?t.selectedChipIds[0]:"r";let o=n.checked;-1!==i.indexOf("osi")?i+="_"+(o?"p":"u")+a:-1!==i.indexOf("int3")&&(i+="_"+a),window.myLine.updateStnTransfer(c,i,l)};function u(){var e=$("#stn_edit_diag .mdc-layout-grid__inner #int_name_zh,#int_name_en").slice(0,2).clone();e.find(".mdc-text-field").removeAttr("data-mdc-auto-init-state"),$("div#int_line").slice(1,3).after(e);const[t,n,m,u,g,f]=["#stn_add_diag","#stn_edit_diag","#stn_intbox_diag","#stn_osiname_diag","#stn_delete_diag","#stn_delete_err"].map(e=>new i.MDCDialog($(e)[0])),[v,b,w,y]=["#prep","#pivot","#loc","#end"].map(e=>new d.MDCSelect($("#stn_add_diag").find(e)[0])),x=$("#stn_edit_diag #panel_name .mdc-chip-set")[0],C=new o.a(x),D=["#name_zh","#name_en"].map(e=>new l.MDCTextField($("#stn_edit_diag").find(e)[0])),M=new l.MDCTextField($("#stn_edit_diag #stn_num")[0]),I=$("#stn_edit_diag .mdc-icon-button").get(),S=$("#stn_edit_diag #panel_interchange .mdc-chip-set.int-chip-set").get(),E=S.map(e=>new o.a(e)),k=(new s.MDCRipple($("#stn_edit_diag #osi_name")[0]),new d.MDCSelect($("#int_city")[0])),j=new d.MDCSelect($("#int_line")[0]),O=["zh","en"].map(e=>new l.MDCTextField($("#stn_intbox_diag").find("#name_"+e)[0])),L=new o.a($("#tick_direc")[0]),T=new r.MDCSwitch($("#paid_area")[0]),z=new c.MDCTabBar($("#stn_edit_diag .mdc-tab-bar")[0]),A=["zh","en"].map(e=>new l.MDCTextField($("#stn_osiname_diag").find(`#osi_name_${e}`)[0])),[P,q,B]=["through","first","pos"].map(e=>["left","right"].map(t=>new d.MDCSelect($(`#${t}_${e}`)[0])));var F=Object(a.g)().stn_list;window.myLine.tpo.forEach(e=>{$("#panel_stations .mdc-layout-grid__inner:first").append(_(e,F[e].name,F[e].num)),$("#pivot__selection").append($("<li>",{"data-value":e}).addClass("mdc-list-item").text(F[e].name.join()))}),$("#panel_stations .mdc-card__primary-action").on("click",e=>{}),$('#panel_stations .mdc-card__action-icons > [title="Add"]').on("click",e=>{t.open()}),$('#panel_stations .mdc-card__action-icons > [title="Set As Current"]').on("click",e=>{var t=e.target.closest(".mdc-card").id;window.myLine.currentStnId=t}),$('#panel_stations .mdc-card__action-icons > [title="Interchange"]').on("click",e=>{$("#stn_edit_diag").attr("for",e.target.closest(".mdc-card").id),n.open()}),$('#panel_stations .mdc-card__action-icons > [title="Remove"]').on("click",e=>{var t=e.target.closest(".mdc-card").id;$("#stn_delete_diag").attr("for",t),g.open()}),t.listen("MDCDialog:opening",()=>{b.selectedIndex=0}),t.listen("MDCDialog:opened",()=>{[v,b,w].forEach(e=>e.layout())}),t.listen("MDCDialog:closed",e=>{if("close"!=e.detail.action){var t=v.value,a=b.value,i=w.value,d=y.value,[l,c]=window.myLine.addStn(t,a,i,d);console.log(t,a,i,d);var o=window.myLine.tpo[window.myLine.tpo.indexOf(l)-1]||"add_stn";$(`#panel_stations .mdc-layout-grid__inner:first #${o}`).after(_(l,c.name,c.num)),$(`#panel_stations #${l} .mdc-card__primary-action`).on("click",e=>{}),$(`#panel_stations #${l} .mdc-card__action-icons > [title="Set As Current"]`).on("click",e=>{var t=e.target.closest(".mdc-card").id;window.myLine.currentStnId=t}),$(`#panel_stations #${l} .mdc-card__action-icons > [title="Interchange"]`).on("click",e=>{var t=e.target.closest(".mdc-card").id;$("#stn_edit_diag").attr("for",t),n.open()}),$(`#panel_stations #${l} .mdc-card__action-icons > [title="Remove"]`).on("click",e=>{var t=e.target.closest(".mdc-card").id;$("#stn_delete_diag").attr("for",t),g.open()});var s=$("<li>",{"data-value":l,class:"mdc-list-item"}).text(c.name.join(" - "));"add_stn"==o?$("#pivot__selection").prepend(s):$(`#pivot__selection [data-value="${o}"`).after(s),$("#stn_edit_diag").attr("for",l),n.open()}}),v.listen("MDCSelect:change",e=>{$("#stn_add_diag #pivot")[0].dispatchEvent(new Event("MDCSelect:change"))}),b.listen("MDCSelect:change",e=>{var t=v.value,n=b.value,i=Object(a.g)().stn_list;for(let[e,a]of window.myLine.newStnPossibleLoc(t,n).entries())1===a||a.length?($("#loc__selection li").eq(e).show(),e>=3&&($("#end__selection").empty(),a.forEach(e=>{$("#end__selection").append($("<li>",{class:"mdc-list-item","data-value":e}).text(i[e].name.join(" - ")))}))):$("#loc__selection li").eq(e).hide();w.value=Array.from(document.querySelectorAll("#loc__selection li")).filter(e=>"none"!==e.style.display)[0].dataset.value}),w.listen("MDCSelect:change",e=>{["newupper","newlower"].includes(e.detail.value)?($("#stn_add_diag [new-branch]").show(),y.selectedIndex=0):$("#stn_add_diag [new-branch]").hide()}),$("#stn_edit_diag").find("#name_zh, #name_en, #stn_num").on("input",()=>{let e=D.map(e=>e.value);var t=M.value,n=$("#stn_edit_diag").attr("for");window.myLine.updateStnName(n,e,t),$(`#panel_stations .mdc-layout-grid__inner:first #${n} .mdc-card__media-content`).html(e.join("<br>")).prepend($("<span>",{style:"gzmtr"==window.urlParams.get("style")?"":"display:none;"}).text(t+" ")),$(`li[data-value="${n}`).text(e.join())});const N=()=>{D.map(e=>e.layout()),M.layout()},J=()=>{A.forEach(e=>e.layout())},R=()=>{[...P,...q,...B].map(e=>e.layout())};z.listen("MDCTabBar:activated",e=>{switch(e.detail.index){case 0:$("#panel_name").show(),$("#panel_interchange, #panel_branch").hide(),N();break;case 1:$("#panel_interchange").show(),$("#panel_name, #panel_branch").hide(),J();break;case 2:$("#panel_name, #panel_interchange").hide(),$("#panel_branch").show(),R()}}),$.getJSON("data/city_list.json",e=>{var t=window.urlParams.get("lang");e.forEach(e=>{$("#int_city__selection.mdc-list").each((n,i)=>{$(i).append($("<li>",{class:"mdc-list-item","data-value":e.id}).text(Object(a.d)(e.country)+Object(a.i)(e.name,t)))})})}),n.listen("MDCDialog:opening",e=>{let t=$(e.target).attr("for"),n=Object(a.g)().stn_list[t];(e=>{D.forEach((t,n)=>t.value=e.name[n]),M.value=e.num,C.chips.forEach(t=>{t.selected=e.services.includes(t.id)})})(n),(e=>{$(S).empty(),e.transfer.info.forEach((e,t)=>{e.forEach((e,n)=>{let a=p(e);S[t].appendChild(a),E[t].addChip(a)})}),e.transfer.osi_names.length?$("button#osi_name .mdc-button__label").html(e.transfer.osi_names[0].join("<br>")):$("button#osi_name .mdc-button__label").html("車站名<br>Stn Name"),T.checked=e.transfer.paid_area,L.chips.filter(t=>t.id===e.transfer.tick_direc)[0].selected=!0})(n),(e=>{["left","right"].forEach(t=>{let n=e.branch[t][0];n?(P[a.a[t]].value=n,$(`#${t}_through__selection [data-value="na"]`).hide(),$(`#${t}_through__selection [data-value="through"]`).show(),$(`#${t}_through__selection [data-value="nonthrough"]`).show(),$(`[${t}-first-group], [${t}-pos-group]`).show()):(P[a.a[t]].value="na",$(`#${t}_through__selection [data-value="na"]`).show(),$(`#${t}_through__selection [data-value="through"]`).hide(),$(`#${t}_through__selection [data-value="nonthrough"]`).hide(),$(`[${t}-first-group], [${t}-pos-group]`).hide())}),$("#left_first__selection, #right_first__selection").empty(),Promise.resolve(Object(a.g)().stn_list).then(t=>{[0,1].forEach(n=>{e[a.c[n]].forEach(e=>{$(`#${a.a[n]}_first__selection`).append($("<li>",{class:"mdc-list-item","data-value":e}).text(t[e].name.join()))})})}).then(()=>{P.forEach((t,n)=>{q[n].selectedIndex="na"!==t.value?e[a.c[n]].indexOf(e.branch[a.a[n]][1]):0})}),B.forEach((t,n)=>{t.selectedIndex=e[a.c[n]].indexOf(e.branch[a.a[n]][1])})})(n)}),n.listen("MDCDialog:opened",e=>{N(),J(),R()}),C.listen("MDCChip:selection",e=>{if("local"===e.detail.chipId)return void(e.detail.selected||(C.chips.filter(e=>"local"===e.id)[0].selected=!0));let t=$("#stn_edit_diag").attr("for");window.myLine.updateStnServices(t,e.detail)}),I.forEach((e,t)=>{$(e).on("click",e=>{let n=[Object(a.g)().theme[0],null,null,"#000","線","Line"],i=p(n);S[t].appendChild(i),E[t].addChip(i),h(S,L,T)})}),E.forEach((e,t)=>{e.listen("MDCChip:interaction",e=>{$("#stn_intbox_diag").data("intId",{setIdx:t,chipId:e.detail.chipId}),m.open()})}),E.forEach((e,t)=>{e.listen("MDCChip:removal",()=>{h(S,L,T)})}),$("button#osi_name").on("click",e=>{u.open()}),m.listen("MDCDialog:opening",e=>{let{setIdx:t,chipId:n}=$(e.target).data("intId"),{city:a,line:i}=$(S[t]).find("#"+n).data("theme");k.value=a;let d=$(S[t]).find("#"+n).find(".mdc-chip__text").html().split("<br>");O.forEach((e,t)=>e.value=d[t])}),m.listen("MDCDialog:opened",e=>{O.map(e=>e.layout())}),k.listen("MDCSelect:change",e=>{if(-1===e.detail.index)return;let{setIdx:t,chipId:n}=$("#stn_intbox_diag").data("intId");$.getJSON(`data/${e.detail.value}.json`,e=>{var i=window.urlParams.get("lang");$("#int_line__selection.mdc-list").empty(),e.forEach(e=>{$("#int_line__selection.mdc-list").append(`<li class="mdc-list-item" data-value="${e.id}">\n                    <span style="background:${e.colour};color:${e.fg||"#fff"};">&nbsp;${Object(a.i)(e.name,i)}&nbsp;</span>\n                    </li>`)});let{line:d}=$(S[t]).find("#"+n).data("theme"),l=$("#int_line__selection.mdc-list").find(`[data-value="${d}"]`).index();j.selectedIndex=-1===l?0:l}),$(S[t]).find("#"+n).data("theme").city=e.detail.value}),j.listen("MDCSelect:change",e=>{let{value:t,index:n}=e.detail,{setIdx:a,chipId:i}=$("#stn_intbox_diag").data("intId");$(S[a]).find("#"+i).data("theme").line=t,$(S[a]).find("#"+i).css({"background-color":$("#int_line__selection span").eq(n).css("background-color"),color:$("#int_line__selection span").eq(n).css("color")})}),O.forEach(e=>{$(e.root_).find("input").on("input",()=>{let{setIdx:e,chipId:t}=$("#stn_intbox_diag").data("intId");$(S[e]).find("#"+t).find(".mdc-chip__text").html(O[0].value+"<br>"+O[1].value)})}),m.listen("MDCDialog:closed",()=>{h(S,L,T)}),u.listen("MDCDialog:opening",()=>{$("button#osi_name .mdc-button__label").html().split("<br>").forEach((e,t)=>A[t].value=e)}),u.listen("MDCDialog:opened",()=>{A.map(e=>e.layout())}),$("#osi_name_zh, #osi_name_en").find("input").each((e,t)=>{$(t).on("input",()=>{$("button#osi_name .mdc-button__label").html(A.map(e=>e.value).join("<br>"))})}),u.listen("MDCDialog:closed",()=>{h(S,L,T)}),L.listen("MDCChip:selection",e=>{0!==L.selectedChipIds.length&&h(S,L,T)}),$(T.root_).find("input").on("change",()=>{h(S,L,T)}),P.forEach((e,t)=>{e.listen("MDCSelect:change",e=>{if("na"===e.detail.value)return;let n=$("#stn_edit_diag").attr("for");window.myLine.updateBranchType(n,t,e.detail.value)})}),q.forEach((e,t)=>{e.listen("MDCSelect:change",e=>{if(1===$(`#${a.a[t]}_first__selection`).children().length)return;let n=$("#stn_edit_diag").attr("for");window.myLine.updateBranchFirst(n,t,e.detail.value)&&(B[t].selectedIndex=0===B[t].selectedIndex?1:0)})}),B.forEach((e,t)=>{e.listen("MDCSelect:change",e=>{if("na"===P[t].value)return;let n=$("#stn_edit_diag").attr("for");window.myLine.updateBranchPos(n,t,e.detail.index)})}),g.listen("MDCDialog:opening",e=>{var t=$(e.target).attr("for");$("#stn_delete_diag #err_stn").text(Object(a.g)().stn_list[t].name.join(" - "))}),g.listen("MDCDialog:closed",e=>{if("close"!=e.detail.action){var t=$(e.target).attr("for");window.myLine.removeStn(t)?($(`#panel_stations .mdc-layout-grid__inner #${t}`).remove(),$(`#pivot__selection [data-value="${t}"]`).remove()):f.open()}})}}}]);