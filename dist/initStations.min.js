(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{20:function(e,t,n){"use strict";n.r(t),n.d(t,"common",(function(){return f}));var i=n(0),a=n(2),l=n(3),d=n(13),s=n(12),c=n(8),o=n(22),r=n(4),_=n(14),p=n(16);const h=(e,t,n)=>$("<div>",{id:e,class:"mdc-chip",role:"row"}).append($("<div>",{class:"mdc-chip__ripple"})).append($("<span>",{class:"mdc-chip__icon mdc-chip__icon--leading"}).text(n).css("display","gzmtr"===window.urlParams.get("style")?"block":"none")).append($("<span>",{role:"gridcell"}).append($("<span>",{role:"button",tabindex:0,class:"mdc-chip__text"}).append($("<span>",{class:"stn-chip__text stn-chip__text--zh"}).text(t[0])).append($("<span>",{class:"stn-chip__text stn-chip__text--en"}).html(t[1].split("\\").join("<br>")))))[0],m=e=>$("<div>",{class:"mdc-chip",role:"row"}).css({"background-color":e[a.b.colour],color:e[a.b.fg]}).data("theme",{city:e[a.b.city],line:e[a.b.line]}).append($("<div>",{class:"mdc-chip__ripple"})).append($("<span>",{role:"gridcell"}).append($("<span>",{role:"button",tabindex:0,class:"mdc-chip__text"}).html(e[a.b.nameZH]+"<br>"+e[a.b.nameEN]))).append($("<span>",{role:"gridcell"}).append($("<i>",{class:"material-icons mdc-chip__icon mdc-chip__icon--trailing",tabindex:-1,role:"button"}).text("cancel")))[0],u=e=>{let t,n=e.map(e=>$(e).find(".mdc-chip").get().map(e=>{return t=e,[$(t).data("theme").city,$(t).data("theme").line,Object(i.j)($(t).css("background-color")),Object(i.j)($(t).css("color")),$(t).find(".mdc-chip__text").html().split("<br>")[0],$(t).find(".mdc-chip__text").html().split("<br>")[1]];var t})),a=n.map(e=>e.length);return 0===a[1]&&(n=[n[0]]),t=3===a[0]&&0===a[1]?"int3":2===a[0]&&1===a[1]?"osi31":2===a[0]&&0===a[1]?"int3":1===a[0]&&2===a[1]?"osi22":1===a[0]&&1===a[1]?"osi21":1===a[0]&&0===a[1]?"int2":0===a[0]&&3===a[1]?"osi13":0===a[0]&&2===a[1]?"osi12":0===a[0]&&1===a[1]?"osi11":0===a[0]&&0===a[1]?"none":"int3",console.log(t),{info:n,changeType:t}},g=(e,t,n)=>{let i,{changeType:a,info:l}=u(e),d=l,s=$("#stn_edit_diag").attr("for");if(-1!==a.indexOf("osi")){let e=$("button#osi_name .mdc-button__label").html().split("<br>");d[1].unshift(e)}i=t.selectedChipIds.length?t.selectedChipIds[0]:"r";let c=n.checked;-1!==a.indexOf("osi")?a+="_"+(c?"p":"u")+i:-1!==a.indexOf("int3")&&(a+="_"+i),window.myLine.updateStnTransfer(s,a,d)};function f(){const e=$("#stn_list")[0],t=new o.a(e),n=new p.MDCSnackbar($("#panel_stations .mdc-snackbar")[0]),[u,f,b,w,v,C]=["#stn_add_diag","#stn_edit_diag","#stn_intbox_diag","#stn_osiname_diag","#stn_delete_diag","#stn_delete_err"].map(e=>new l.MDCDialog($(e)[0])),[x,D,y,M]=["#prep","#pivot","#loc","#end"].map(e=>new d.MDCSelect($("#stn_add_diag").find(e)[0])),I=$("#stn_edit_diag #panel_name .mdc-chip-set")[0],j=new o.a(I),S=["#name_zh","#name_en"].map(e=>new s.MDCTextField($("#stn_edit_diag").find(e)[0])),E=new s.MDCTextField($("#stn_edit_diag #stn_num")[0]),k=$("#stn_edit_diag .mdc-icon-button").get(),O=$("#stn_edit_diag #panel_interchange .mdc-chip-set.int-chip-set").get(),L=O.map(e=>new o.a(e)),T=(new r.MDCRipple($("#stn_edit_diag #osi_name")[0]),new d.MDCSelect($("#int_city")[0])),z=new d.MDCSelect($("#int_line")[0]),P=["zh","en"].map(e=>new s.MDCTextField($("#stn_intbox_diag").find("#name_"+e)[0])),q=new o.a($("#tick_direc")[0]),B=new _.MDCSwitch($("#paid_area")[0]),F=new c.MDCTabBar($("#stn_edit_diag .mdc-tab-bar")[0]),N=["zh","en"].map(e=>new s.MDCTextField($("#stn_osiname_diag").find(`#osi_name_${e}`)[0])),[J,A,H]=["through","first","pos"].map(e=>["left","right"].map(t=>new d.MDCSelect($(`#${t}_${e}`)[0])));let R=Object(i.d)().stn_list;window.myLine.tpo.forEach(n=>{let i=h(n,R[n].name,R[n].num);e.appendChild(i),t.addChip(i),$("#pivot__selection").append($("<li>",{"data-value":n}).addClass("mdc-list-item").text("gzmtr"===window.urlParams.get("style")?`${R[n].num}: ${R[n].name.join()}`:R[n].name.join()))}),t.listen("MDCChip:selection",e=>{e.detail.selected?"add_stn"!==e.detail.chipId?n.open():u.open():n.close()}),n.listen("MDCSnackbar:opening",()=>{let e=Object(i.d)().stn_list[t.selectedChipIds[0]];"gzmtr"===window.urlParams.get("style")?n.labelText=`${e.num}: ${e.name.join()}`:n.labelText=`${e.name.join()}`}),n.listen("MDCSnackbar:closed",e=>{e.detail.reason&&(t.chips.filter(e=>t.selectedChipIds.includes(e.id))[0].selected=!1)}),$("#panel_stations .mdc-snackbar button#current").on("click",()=>{window.myLine.currentStnId=t.selectedChipIds[0]}),$("#panel_stations .mdc-snackbar button#edit").on("click",()=>{$("#stn_edit_diag").attr("for",t.selectedChipIds[0]),f.open()}),$("#panel_stations .mdc-snackbar button#remove").on("click",()=>{$("#stn_delete_diag").attr("for",t.selectedChipIds[0]),v.open()}),u.listen("MDCDialog:opening",()=>{D.selectedIndex=0}),u.listen("MDCDialog:opened",()=>{[x,D,y].forEach(e=>e.layout())}),u.listen("MDCDialog:closed",n=>{if(t.chips.filter(e=>t.selectedChipIds.includes(e.id))[0].selected=!1,"close"===n.detail.action)return;let i=x.value,a=D.value,l=y.value,d=M.value;console.log(i,a,l,d);let[s,c]=window.myLine.addStn(i,a,l,d),o=window.myLine.tpo,r=o[o.indexOf(s)-1]||"add_stn",_=h(s,c.name,c.num);$(e).find("#"+r).after(_),t.addChip(_);var p=$("<li>",{"data-value":s,class:"mdc-list-item"}).text(c.name.join(" - "));"add_stn"==r?$("#pivot__selection").prepend(p):$(`#pivot__selection [data-value="${r}"`).after(p),$("#stn_edit_diag").attr("for",s),f.open()}),x.listen("MDCSelect:change",e=>{$("#stn_add_diag #pivot")[0].dispatchEvent(new Event("MDCSelect:change"))}),D.listen("MDCSelect:change",e=>{var t=x.value,n=D.value,a=Object(i.d)().stn_list;for(let[e,i]of window.myLine.newStnPossibleLoc(t,n).entries())1===i||i.length?($("#loc__selection li").eq(e).show(),e>=3&&($("#end__selection").empty(),i.forEach(e=>{$("#end__selection").append($("<li>",{class:"mdc-list-item","data-value":e}).text(a[e].name.join(" - ")))}))):$("#loc__selection li").eq(e).hide();y.value=Array.from(document.querySelectorAll("#loc__selection li")).filter(e=>"none"!==e.style.display)[0].dataset.value}),y.listen("MDCSelect:change",e=>{["newupper","newlower"].includes(e.detail.value)?($("#stn_add_diag [new-branch]").show(),M.selectedIndex=0):$("#stn_add_diag [new-branch]").hide()}),$("#stn_edit_diag").find("#name_zh, #name_en, #stn_num").on("input",()=>{let e=S.map(e=>e.value);var t=E.value,n=$("#stn_edit_diag").attr("for");window.myLine.updateStnName(n,e,t),$(`#panel_stations .mdc-layout-grid__inner:first #${n} .mdc-card__media-content`).html(e.join("<br>")).prepend($("<span>",{style:"gzmtr"==window.urlParams.get("style")?"":"display:none;"}).text(t+" ")),$(`li[data-value="${n}`).text(e.join())});const Z=()=>{S.map(e=>e.layout()),E.layout()},G=()=>{N.forEach(e=>e.layout())},K=()=>{[...J,...A,...H].map(e=>e.layout())};F.listen("MDCTabBar:activated",e=>{switch(e.detail.index){case 0:$("#panel_name").show(),$("#panel_interchange, #panel_branch").hide(),Z();break;case 1:$("#panel_interchange").show(),$("#panel_name, #panel_branch").hide(),G();break;case 2:$("#panel_name, #panel_interchange").hide(),$("#panel_branch").show(),K()}}),$.getJSON("data/city_list.json",e=>{var t=window.urlParams.get("lang");e.forEach(e=>{$("#int_city__selection.mdc-list").each((n,a)=>{$(a).append($("<li>",{class:"mdc-list-item","data-value":e.id}).html(Object(i.a)(e.country)+Object(i.f)(e.name,t)))})})}),f.listen("MDCDialog:opening",e=>{let t=$(e.target).attr("for"),n=Object(i.d)().stn_list[t];(e=>{S.forEach((t,n)=>t.value=e.name[n]),E.value=e.num,j.chips.forEach(t=>{t.selected=e.services.includes(t.id)})})(n),(e=>{$(O).empty(),e.transfer.info.forEach((e,t)=>{e.forEach((e,n)=>{let i=m(e);O[t].appendChild(i),L[t].addChip(i)})}),e.transfer.osi_names.length?$("button#osi_name .mdc-button__label").html(e.transfer.osi_names[0].join("<br>")):$("button#osi_name .mdc-button__label").html("車站名<br>Stn Name"),B.checked=e.transfer.paid_area,q.chips.filter(t=>t.id===e.transfer.tick_direc)[0].selected=!0})(n),(e=>{["left","right"].forEach(t=>{let n=e.branch[t][0];n?(J[a.a[t]].value=n,$(`#${t}_through__selection [data-value="na"]`).hide(),$(`#${t}_through__selection [data-value="through"]`).show(),$(`#${t}_through__selection [data-value="nonthrough"]`).show(),$(`[${t}-first-group], [${t}-pos-group]`).show()):(J[a.a[t]].value="na",$(`#${t}_through__selection [data-value="na"]`).show(),$(`#${t}_through__selection [data-value="through"]`).hide(),$(`#${t}_through__selection [data-value="nonthrough"]`).hide(),$(`[${t}-first-group], [${t}-pos-group]`).hide())}),$("#left_first__selection, #right_first__selection").empty(),Promise.resolve(Object(i.d)().stn_list).then(t=>{[0,1].forEach(n=>{e[a.c[n]].forEach(e=>{$(`#${a.a[n]}_first__selection`).append($("<li>",{class:"mdc-list-item","data-value":e}).text(t[e].name.join()))})})}).then(()=>{J.forEach((t,n)=>{A[n].selectedIndex="na"!==t.value?e[a.c[n]].indexOf(e.branch[a.a[n]][1]):0})}),H.forEach((t,n)=>{t.selectedIndex=e[a.c[n]].indexOf(e.branch[a.a[n]][1])})})(n)}),f.listen("MDCDialog:opened",e=>{Z(),G(),K()}),j.listen("MDCChip:selection",e=>{if("local"===e.detail.chipId)return void(e.detail.selected||(j.chips.filter(e=>"local"===e.id)[0].selected=!0));let t=$("#stn_edit_diag").attr("for");window.myLine.updateStnServices(t,e.detail)}),k.forEach((e,t)=>{$(e).on("click",e=>{let n=[Object(i.d)().theme[0],null,null,"#000","線","Line"],a=m(n);O[t].appendChild(a),L[t].addChip(a),g(O,q,B)})}),L.forEach((e,t)=>{e.listen("MDCChip:interaction",e=>{$("#stn_intbox_diag").data("intId",{setIdx:t,chipId:e.detail.chipId}),b.open()})}),L.forEach((e,t)=>{e.listen("MDCChip:removal",()=>{g(O,q,B)})}),$("button#osi_name").on("click",e=>{w.open()}),b.listen("MDCDialog:opening",e=>{let{setIdx:t,chipId:n}=$(e.target).data("intId"),{city:i,line:a}=$(O[t]).find("#"+n).data("theme");T.value=i;let l=$(O[t]).find("#"+n).find(".mdc-chip__text").html().split("<br>");P.forEach((e,t)=>e.value=l[t])}),b.listen("MDCDialog:opened",e=>{P.map(e=>e.layout())}),T.listen("MDCSelect:change",e=>{if(-1===e.detail.index)return;let{setIdx:t,chipId:n}=$("#stn_intbox_diag").data("intId");$.getJSON(`data/${e.detail.value}.json`,e=>{var a=window.urlParams.get("lang");$("#int_line__selection.mdc-list").empty(),e.forEach(e=>{$("#int_line__selection.mdc-list").append($("<li>",{class:"mdc-list-item","data-value":e.id}).append($("<span>").css({background:e.colour,color:e.fg||"#fff"}).text(" "+Object(i.f)(e.name,a)+" ")))});let{line:l}=$(O[t]).find("#"+n).data("theme"),d=$("#int_line__selection.mdc-list").find(`[data-value="${l}"]`).index();z.selectedIndex=-1===d?0:d}),$(O[t]).find("#"+n).data("theme").city=e.detail.value}),z.listen("MDCSelect:change",e=>{let{value:t,index:n}=e.detail,{setIdx:i,chipId:a}=$("#stn_intbox_diag").data("intId");$(O[i]).find("#"+a).data("theme").line=t,$(O[i]).find("#"+a).css({"background-color":$("#int_line__selection span").eq(n).css("background-color"),color:$("#int_line__selection span").eq(n).css("color")})}),P.forEach(e=>{$(e.root_).find("input").on("input",()=>{let{setIdx:e,chipId:t}=$("#stn_intbox_diag").data("intId");$(O[e]).find("#"+t).find(".mdc-chip__text").html(P[0].value+"<br>"+P[1].value)})}),b.listen("MDCDialog:closed",()=>{g(O,q,B)}),w.listen("MDCDialog:opening",()=>{$("button#osi_name .mdc-button__label").html().split("<br>").forEach((e,t)=>N[t].value=e)}),w.listen("MDCDialog:opened",()=>{N.map(e=>e.layout())}),$("#osi_name_zh, #osi_name_en").find("input").each((e,t)=>{$(t).on("input",()=>{$("button#osi_name .mdc-button__label").html(N.map(e=>e.value).join("<br>"))})}),w.listen("MDCDialog:closed",()=>{g(O,q,B)}),q.listen("MDCChip:selection",e=>{0!==q.selectedChipIds.length&&g(O,q,B)}),$(B.root_).find("input").on("change",()=>{g(O,q,B)}),J.forEach((e,t)=>{e.listen("MDCSelect:change",e=>{if("na"===e.detail.value)return;let n=$("#stn_edit_diag").attr("for");window.myLine.updateBranchType(n,t,e.detail.value)})}),A.forEach((e,t)=>{e.listen("MDCSelect:change",e=>{if(1===$(`#${a.a[t]}_first__selection`).children().length)return;let n=$("#stn_edit_diag").attr("for");window.myLine.updateBranchFirst(n,t,e.detail.value)&&(H[t].selectedIndex=0===H[t].selectedIndex?1:0)})}),H.forEach((e,t)=>{e.listen("MDCSelect:change",e=>{if("na"===J[t].value)return;let n=$("#stn_edit_diag").attr("for");window.myLine.updateBranchPos(n,t,e.detail.index)})}),v.listen("MDCDialog:opening",e=>{var t=$(e.target).attr("for");$("#stn_delete_diag #err_stn").text(Object(i.d)().stn_list[t].name.join(" - "))}),v.listen("MDCDialog:closed",e=>{if("close"!=e.detail.action){var n=$(e.target).attr("for");window.myLine.removeStn(n)?(t.chips.filter(e=>e.id===n)[0].beginExit(),$(`#pivot__selection [data-value="${n}"]`).remove()):C.open()}})}}}]);