(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{11:function(e,t,n){"use strict";n.d(t,"b",(function(){return l})),n.d(t,"c",(function(){return s})),n.d(t,"f",(function(){return o})),n.d(t,"e",(function(){return u})),n.d(t,"a",(function(){return f})),n.d(t,"d",(function(){return m}));n(4);var r=function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},a=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,i=n.call(e),c=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)c.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(a)throw a.error}}return c},i=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(a(arguments[t]));return e},c=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},l=function(e,t,n){return Object.keys(e).reduce((function(a,i){var c;return r(r({},a),((c={})[i]=e[i].children.reduce((function(a,c){var l;return r(r({},a),((l={})[c]=1+t(e,c)+n(e,i),l))}),{}),c))}),{})},s=function(e,t,n){if(e==t)return{len:0,nodes:[e]};var r=[],a=[];Object.keys(n[e]).forEach((function(i){var c=s(i,t,n);c.len<0||(r.push(n[e][i]+c.len),c.nodes.unshift(e),a.push(c.nodes))}));var c=Math.max.apply(Math,i(r));return{len:c,nodes:a[r.indexOf(c)]}},o=function(e,t,n){var r=s("linestart","lineend",t);if(r.nodes.includes(e))return s(r.nodes[1],e,t).len;for(var a=n.filter((function(t){return t.includes(e)}))[0],i=e;!r.nodes.includes(i);)i=a[a.indexOf(i)-1];for(var c=e;!r.nodes.includes(c);)c=a[a.indexOf(c)+1];var l="linestart"===i,o=[];return l||"lineend"===c?l?(o[0]=0,o[1]=s(r.nodes[1],c,t).len,o[2]=s(a[1],e,t).len,o[3]=s(e,c,t).len):(o[0]=s(r.nodes[1],i,t).len,o[1]=s(i,r.nodes.slice(-2)[0],t).len,o[2]=s(i,e,t).len,o[3]=s(e,a.slice(-2)[0],t).len):(o[0]=s(r.nodes[1],i,t).len,o[1]=s(i,c,t).len,o[2]=s(i,e,t).len,o[3]=s(e,c,t).len),o[0]+o[2]*o[1]/(o[2]+o[3])},u=function(e,t,n){return console.log("computing stations' states"),i(new Set([].concat.apply([],i(t)))).reduce((function(a,i){var l;return r(r({},a),((l={})[i]=i===e?0:("r"===n?function(e,t,n){var r,a;try{for(var i=c(n),l=i.next();!l.done;l=i.next()){var s=l.value,o=s.indexOf(e),u=s.indexOf(t);if(-1!==o&&o<u)return!0}}catch(e){r={error:e}}finally{try{l&&!l.done&&(a=i.return)&&a.call(i)}finally{if(r)throw r.error}}return!1}(e,i,t):function(e,t,n){var r,a;try{for(var i=c(n),l=i.next();!l.done;l=i.next()){var s=l.value,o=s.indexOf(e),u=s.indexOf(t);if(-1!==u&&u<o)return!0}}catch(e){r={error:e}}finally{try{l&&!l.done&&(a=i.return)&&a.call(i)}finally{if(r)throw r.error}}return!1}(e,i,t))?1:-1,l))}),{})},f=function(){function e(e){var t=this;this.yShares={},this.xShares={},this.namePoss={},this.stnList={},this.criticalPath={},this.leftWideFactor=function(e){return 0},this.rightWideFactor=function(e){return 0},this.pathWeight=function(e,n){return t.stnList[e].children.includes(n)?1+t.rightWideFactor(e)+t.leftWideFactor(n):-1/0},this.pathTurnParams=function(e){var t=35-17.5*Math.sqrt(3),n=e-2*t;return{tr:35,dx_a:17.5,dy_a:t,dx_l:n*Math.sqrt(3),dy_l:n}},this.pathTurnSE=function(e){var n=t.pathTurnParams(e),r=n.tr,a=n.dx_a,i=n.dy_a;return"a "+r+","+r+" 0 0,1 "+a+","+i+" l "+n.dx_l+","+n.dy_l+" a "+r+","+r+" 0 0,0 "+a+","+i},this.pathTurnNE=function(e){var n=t.pathTurnParams(e),r=n.tr,a=n.dx_a,i=n.dy_a;return"a "+r+","+r+" 0 0,0 "+a+","+-i+" l "+n.dx_l+","+-n.dy_l+" a "+r+","+r+" 0 0,1 "+a+","+-i},this.stnList=e.stnList,this.criticalPath=e.criticalPath}return e.prototype.getYShare=function(e,t){if(e in this.yShares)return this.yShares[e];if(["linestart","lineend"].includes(e)||this.stnList[e].parents.length>1||this.stnList[e].children.length>1)return this.yShares[e]=0,0;var n=this.stnList[e].parents[0];if(n){if(1==this.stnList[n].children.length){var r=this.getYShare(n);return this.yShares[e]=r,r}r=0==this.stnList[n].children.indexOf(e)?1:-1;return this.yShares[e]=r,r}return this.yShares[e]=0,0},e.getYShares=function(e,t){console.log("computing y shares");var n=new this({stnList:e});return Object.keys(e).forEach((function(e){["linestart","lineend"].includes(e)||e in n.yShares||n.getYShare(e,t)})),n.yShares},e.prototype.getNamePos=function(e){if("linestart"===e)return this.namePoss.linestart=!0,!0;var t=this.criticalPath.nodes.indexOf(e)%2;if(-1===t){var n=this.stnList[e].parents[0];if(2===this.stnList[n].children.length){var r=this.getNamePos(n);return this.namePoss[e]=r,r}var a=!this.getNamePos(n);return this.namePoss[e]=a,a}return this.namePoss[e]=1===t,1===t},e.getNamePos=function(e,t){console.log("computing name position");var n=new this({stnList:e,criticalPath:t});return Object.keys(e).forEach((function(e){["linestart","lineend"].includes(e)||e in n.namePoss||n.getNamePos(e)})),n.namePoss},e.prototype._linePath=function(e,t,n,r,i,c,l){var s=this,o=a([],3),u=o[0],f=o[1],m=o[2],h=[],d=this.pathTurnParams(c),g=d.dx_a+d.dx_l/2,p=(t[1]-t[0])/l.len*.8,y=((t[1]-t[0])/l.len-2*g)/2;return y+p<0&&console.warn("SVG width too small! "+(y+p)),e.forEach((function(t){var l,o,d=r[t],v=i[t];if(!f&&0!==f)return l=a([t,d,v],3),u=l[0],m=l[1],f=l[2],void(1===e.length?h.push("M "+d+","+v):n[0].includes(t)?n[0].includes(e[1])?h.push("M "+d+","+v):(r[e[1]]>0&&h.push("M "+d+","+(v+9.68)),i[e[1]]<0&&h.push("M "+d+","+(v-9.68))):h.push("M "+d+","+v));v>f?(h.push(0===v?"h "+(d-m-p*s.leftWideFactor(t)-y-2*g):"h "+(p*s.rightWideFactor(u)+y)),h.push(s.pathTurnSE(c))):v<f&&(h.push(0===v?"h "+(d-m-p*s.leftWideFactor(t)-y-2*g):"h "+(p*s.rightWideFactor(u)+y)),h.push(s.pathTurnNE(c))),h.push("H "+d),o=a([t,d,v],3),u=o[0],m=o[1],f=o[2]})),h.join(" ").replace(/( H ([\d.]+))+/g," H $2")},e.drawLine=function(e,t,n,r,a,i,c,l){var s=this,o={main:[],pass:[]};return e.map((function(u,f){var m=(u=u.filter((function(e){return!["linestart","lineend"].includes(e)}))).filter((function(e){return t[e]>=0})),h=u.filter((function(e){return t[e]<=0}));1===m.length&&(h=u),0==m.filter((function(e){return-1!==h.indexOf(e)})).length&&m.length&&(h[0]===u[0]?h.push(m[0]):m[0]===u[0]&&m[m.length-1]===u[u.length-1]&&h.length?(h=u,m=[]):h.unshift(m[m.length-1])),o.main.push(new s({stnList:n,criticalPath:l})._linePath(m,r,e,a,i,c,l)),o.pass.push(new s({stnList:n,criticalPath:l})._linePath(h,r,e,a,i,c,l))})),o},e}(),m=function(e,t){var n={main:[],pass:[]};return e.map((function(e){var r=(e=e.filter((function(e){return!["linestart","lineend"].includes(e)}))).filter((function(e){return t[e]>=0})),a=e.filter((function(e){return t[e]<=0}));1===r.length&&(a=e),0==r.filter((function(e){return-1!==a.indexOf(e)})).length&&r.length&&(a[0]===e[0]?a.push(r[0]):r[0]===e[0]&&r[r.length-1]===e[e.length-1]&&a.length?(a=e,r=[]):a.unshift(r[r.length-1])),n.main.push(r),n.pass.push(a)})),n}},35:function(e,t,n){"use strict";var r=n(0),a=function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};t.a=function(e){var t,n=function(e){switch(e){case"gz28":case"gzgf":return 60;case"gz1":case"gz3":return 40;case"gz1421":return 20;default:return 0}}(e.variant),c=r.useMemo((function(){switch(e.variant){case"gz1":return r.createElement("circle",{cy:-28,r:16,fill:"red"});case"gz28":return r.createElement("ellipse",{rx:24,ry:12,fill:"orange"});case"gz3":return r.createElement("rect",{x:-15,y:-25,height:30,width:30,fill:"red"});case"gzgf":return r.createElement("ellipse",{rx:24,ry:12,fill:"white"});case"gz1421":return r.createElement("ellipse",{cy:-8,rx:24,ry:12,fill:"orange"});default:return r.createElement(r.Fragment,null)}}),[e.variant]);return r.createElement("g",null,r.createElement("rect",{id:"strip_gz",style:(t={},t["--height"]=n+"px",t)}),r.createElement("g",{style:{transform:"translate(calc(var(--rmg-svg-width) / 2),calc(var(--rmg-svg-height) - 30px))"}},e.isShowLight&&c),e.isShowPSD&&r.createElement(i,a({},e)))};var i=r.memo((function(e){var t;return r.createElement("g",{id:"big_psd",fill:["gz3","gz1421","gz1"].includes(e.variant)?"var(--rmg-theme-fg)":"#000",style:(t={},t["--psd-dy"]=["gz1","gz3"].includes(e.variant)?"82px":"gz1421"===e.variant?"62px":"58px",t)},r.createElement("rect",{height:40,width:40,rx:4,x:-20,fill:["gz3","gz1421","gz1"].includes(e.variant)?"var(--rmg-theme-colour)":"#fff"}),r.createElement("text",{className:"rmg-name__en",fontSize:20,dy:12},e.isShowPSD),r.createElement("text",{className:"rmg-name__zh",fontSize:12,dy:26},"屏蔽门"),r.createElement("text",{className:"rmg-name__en",fontSize:6.5,dy:36},"Screen Door"))}),(function(e,t){return e.variant===t.variant&&e.isShowPSD===t.isShowPSD}))},36:function(e,t,n){"use strict";var r=n(0),a=function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},i=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n},c=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,i=n.call(e),c=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)c.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(a)throw a.error}}return c};t.a=function(e){var t=e.lineNum,n=e.stnNum,l=i(e,["lineNum","stnNum"]),s=r.useRef(),o=c(r.useState({width:15.03125}),2),u=o[0],f=o[1];r.useEffect((function(){return f(s.current.getBBox())}),[t]);var m=u.width>15.03125?15.03125/u.width:1,h=2===t.length?m:1;return r.createElement("g",a({textAnchor:"middle",fontSize:13.5},l),r.useMemo((function(){return r.createElement(r.Fragment,null,r.createElement("g",{transform:"translate(-9.25,0)scale("+m+")"},r.createElement("text",{ref:s,className:"rmg-name__zh"},t)),r.createElement("g",{transform:"translate(9.25,0)scale("+h+")"},r.createElement("text",{className:"rmg-name__zh"},n)))}),[u.width,t,n]))}},78:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n(2),i=n(35),c=n(36),l=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,i=n.call(e),c=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)c.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(a)throw a.error}}return c},s=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(l(arguments[t]));return e},o=r.memo((function(e){return r.createElement("g",{textAnchor:"middle",fill:-1===e.stnState?"#fff":e.info[3]},r.createElement("use",{xlinkHref:"#intbox",fill:-1===e.stnState?"#aaa":e.info[2]}),e.info[4][0]===e.info[5][0]?r.createElement(f,{name:e.info.slice(-2)}):r.createElement(u,{name:e.info.slice(-2)}))}),(function(e,t){return e.info.toString()===t.info.toString()&&e.stnState===t.stnState})),u=r.memo((function(e){var t,n=[],a=0;null===(t=e.name[0].match(/\d+|\D+/g))||void 0===t||t.forEach((function(e,t){isNaN(Number(e))?(n.push(r.createElement("tspan",{key:t,dominantBaseline:"hanging",dy:1-a},e)),a+=1-a):(n.push(r.createElement("tspan",{key:t,dominantBaseline:"hanging",fontSize:16,dy:-a},e)),a=0)}));var i=r.useRef(),c=l(r.useState({width:0}),2),s=c[0],o=c[1];r.useEffect((function(){return o(i.current.getBBox())}),[e.name[0]]);var u=s.width>43.5?43.5/s.width:1,f=r.useRef(),m=l(r.useState({width:0}),2),h=m[0],d=m[1];r.useEffect((function(){return d(f.current.getBBox())}),[e.name[1]]);var g=h.width>43.5?43.5/h.width:1;return r.createElement(r.Fragment,null,r.createElement("text",{ref:i,y:2,className:"rmg-name__zh",fontSize:12,transform:"scale("+u+",1)"},n),r.createElement("text",{ref:f,y:19.5,fontSize:e.name[1].replace("\\"," ").length>10?7:8,className:"rmg-name__en",transform:"scale("+g+",1)"},e.name[1]))}),(function(e,t){return e.name.toString()===t.name.toString()})),f=r.memo((function(e){var t="";for(var n in s(e.name[0])){if(e.name[0][n]!==e.name[1][n])break;t+=e.name[0][n]}var a=r.useRef(),i=l(r.useState({x:0,width:0}),2),c=i[0],o=i[1];r.useEffect((function(){return o(a.current.getBBox())}),[e.name.toString()]);var u=c.width>43.5?43.5/c.width:1;return r.createElement("g",{transform:"scale("+u+",1)"},r.createElement("g",{transform:"translate("+(-c.x-c.width/2)+",0)"},r.createElement("text",{ref:a,className:"rmg-name__zh",fontSize:14,y:12,textAnchor:"end"},t,r.createElement("tspan",{className:"rmg-name__zh",fontSize:8,x:0,dy:-2,textAnchor:"start"},e.name[0].slice(t.length)),r.createElement("tspan",{className:"rmg-name__en",fontSize:4,x:0,dy:6,textAnchor:"start"},e.name[1].slice(t.length).trim()))))}),(function(e,t){return e.name.toString()===t.name.toString()})),m=function(){return(m=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},h=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n},d=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,i=n.call(e),c=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)c.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(a)throw a.error}}return c},g=function(e){var t=r.useContext(a.b).param,n=t.stn_list[e.stnId],i=2===n.parents.length||2===n.children.length,l=e.stnY>0||1===n.parents.indexOf(n.branch.left[1])||1===n.children.indexOf(n.branch.right[1])?180:0,s=n.name[1].split("\\").length,o=i?180===l?16+12*(s-1)*Math.cos(-45):-9:180===l?-6:(25+15*(s-1))*Math.cos(-45);return r.createElement(r.Fragment,null,r.createElement(x,{intInfos:i?[[t.theme[0],t.theme[1],"var(--rmg-theme-colour)","var(--rmg-theme-fg)",t.line_name[0],t.line_name[1]]].concat(n.transfer.info[0]):n.transfer.info[0],stnState:e.stnState,tickRotation:l}),r.createElement("g",null,r.createElement("use",{xlinkHref:"#stn",stroke:-1===e.stnState?"#aaa":"var(--rmg-theme-colour)"}),r.createElement(c.a,{className:"Name "+(-1===e.stnState?"Pass":"Future"),lineNum:t.line_num,stnNum:n.num})),r.createElement("g",{style:{transform:"translateX("+-o+"px)"}},r.createElement(p,{name:n.name,stnState:e.stnState,tickRotation:l,isExpress:n.services.includes("express")})))},p=function(e){var t=180===e.tickRotation?17.5:-20-14*e.name[1].split("\\").length*Math.cos(-45),n=r.useRef(),a=d(r.useState({width:0}),2),i=a[0],c=a[1];return r.useEffect((function(){return c(n.current.getBBox())}),[e.name.toString()]),r.createElement("g",{textAnchor:180===e.tickRotation?"end":"start",className:"Name "+(-1===e.stnState?"Pass":0===e.stnState?"CurrentGZ":"Future"),transform:"translate(0,"+t+")rotate(-45)"},r.createElement(y,{ref:n,name:e.name}),e.isExpress&&r.createElement(v,{fill:-1===e.stnState?"#aaa":"var(--rmg-theme-colour)",transform:"translate("+(i.width+35)*(180===e.tickRotation?-1:1)+","+(2+5*(e.name[1].split("\\").length-1))+")"}))},y=r.forwardRef((function(e,t){return r.useMemo((function(){return r.createElement("g",{ref:t},r.createElement("text",{className:"rmg-name__zh",fontSize:18},e.name[0]),r.createElement("g",{fontSize:10.5},e.name[1].split("\\").map((function(e,t){return r.createElement("text",{key:t,className:"rmg-name__en",dy:16+11*t},e)}))))}),[e.name[0],e.name[1]])})),v=r.memo((function(e){return r.createElement("g",m({textAnchor:"middle"},e),r.createElement("text",{className:"rmg-name__zh",fontSize:13},"快车停靠站"),r.createElement("text",{dy:10,className:"rmg-name__en",fontSize:6.5},"Express Station"))})),x=function(e){return r.createElement(r.Fragment,null,r.createElement(E,m({strokeWidth:4},e)),r.createElement(S,m({transform:"translate(0,"+(180===e.tickRotation?-47:23)+")"},e)))},E=function(e){var t=e.intInfos,n=e.stnState,a=e.tickRotation,i=h(e,["intInfos","stnState","tickRotation"]);return r.createElement("g",m({},i),t.map((function(e,i){return r.createElement("use",{key:i,xlinkHref:"#inttick",stroke:-1===n?"#aaa":e[2],transform:"translate("+(-2*(t.length-1)+4*i)+",0)rotate("+(180===a?180:0)+")"})})))},S=function(e){var t=e.intInfos,n=e.tickRotation,a=e.stnState,i=h(e,["intInfos","tickRotation","stnState"]);return r.createElement("g",m({},i),t.map((function(e,t){return r.createElement("g",{key:t,transform:"translate(0,"+28*t*(180===n?-1:1)+")"},r.createElement(o,{info:e,stnState:a}))})))},_=n(11),b=function(){return(b=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},O=function(e,t){return 2===e[t].parents.length||2===e[t].children.length?.25:0},w=function(){var e,t,n=r.useContext(a.b),i=n.param,c=n.branches,l=n.routes,s=n.deps,u=Object(_.b)(i.stn_list,O,O),f=r.useMemo((function(){return console.log("computing x shares"),Object.keys(i.stn_list).reduce((function(e,t){var n;return b(b({},e),((n={})[t]=function(e,t,n){var r=Object(_.c)("linestart","lineend",t);if(r.nodes.includes(e))return Object(_.c)(r.nodes[1],e,t).len;for(var a=n.filter((function(t){return t.includes(e)}))[0],i=e;!r.nodes.includes(i);)i=a[a.indexOf(i)-1];for(var c=e;!r.nodes.includes(c);)c=a[a.indexOf(c)+1];var l="linestart"===i,s="lineend"===c;if(a.toString()===n[0].toString()){var o=[];return l||s?l?(o[0]=0,o[1]=Object(_.c)(r.nodes[1],c,t).len,o[2]=Object(_.c)(a[1],e,t).len,o[3]=Object(_.c)(e,c,t).len):(o[0]=Object(_.c)(r.nodes[1],i,t).len,o[1]=Object(_.c)(i,r.nodes.slice(-2)[0],t).len,o[2]=Object(_.c)(i,e,t).len,o[3]=Object(_.c)(e,a.slice(-2)[0],t).len):(o[0]=Object(_.c)(r.nodes[1],i,t).len,o[1]=Object(_.c)(i,c,t).len,o[2]=Object(_.c)(i,e,t).len,o[3]=Object(_.c)(e,c,t).len),o[0]+o[2]*o[1]/(o[2]+o[3])}return l||s?l?Object(_.c)(r.nodes[1],c,t).len-Object(_.c)(e,c,t).len:Object(_.c)(r.nodes[1],i,t).len+Object(_.c)(i,e,t).len:((o=[])[0]=Object(_.c)(r.nodes[1],i,t).len,o[1]=Object(_.c)(i,c,t).len,o[2]=Object(_.c)(i,e,t).len,o[3]=Object(_.c)(e,c,t).len,o[0]+o[2]*o[1]/(o[2]+o[3]))}(t,u,c),n))}),{})}),[c.toString(),JSON.stringify(u)]),m=Object(_.c)("linestart","lineend",u),h=Object(_.c)(m.nodes[1],m.nodes.slice(-2)[0],u),d="r"===i.direction?[i.svgWidth.railmap*i.padding/100+65,i.svgWidth.railmap*(1-i.padding/100)-20]:[i.svgWidth.railmap*i.padding/100,i.svgWidth.railmap*(1-i.padding/100)-65],g=Object.keys(f).reduce((function(e,t){var n;return b(b({},e),((n={})[t]=d[0]+f[t]/h.len*(d[1]-d[0]),n))}),{}),p=r.useMemo((function(){return console.log("computing y shares"),Object.keys(i.stn_list).reduce((function(e,t){var n,r;if(c[0].includes(t))return b(b({},e),((n={})[t]=0,n));var a=c.slice(1).filter((function(e){return e.includes(t)}))[0];return b(b({},e),((r={})[t]=i.stn_list[a[0]].children.indexOf(a[1])?-2:2,r))}),{})}),[s]),y=Object.keys(p).reduce((function(e,t){var n;return b(b({},e),((n={})[t]=-p[t]*i.branch_spacing,n))}),{}),v=r.useMemo((function(){return Object(_.e)(i.current_stn_idx,l,i.direction)}),[i.current_stn_idx,i.direction,l.toString()]),x=Object(_.d)(c,v),E=Object.keys(x).reduce((function(e,t){var n;return b(b({},e),((n={})[t]=x[t].map((function(e){return z(e,g,y)})),n))}),{});return r.createElement("g",{id:"main",style:(e={},e["--y-percentage"]=i.y_pc,e.transform="translateY(calc(var(--y-percentage) * var(--rmg-svg-height) / 100))",e)},r.createElement(j,{paths:E}),r.createElement(k,{xs:g,ys:y,stnStates:v}),r.createElement("g",{id:"line_name",style:(t={},t["--translate-x"]="r"==i.direction?d[0]-65+"px":d[1]+65+"px",t)},r.createElement(o,{info:[,,"var(--rmg-theme-colour)","var(--rmg-theme-fg)",i.line_name[0],i.line_name[1]],stnState:1})))},j=r.memo((function(e){return r.createElement("g",{fill:"none",strokeWidth:4},r.createElement("g",{stroke:"#aaa",strokeDasharray:4},e.paths.pass.map((function(e,t){return r.createElement("path",{key:t,d:e})}))),r.createElement("g",{stroke:"var(--rmg-theme-colour)"},e.paths.main.map((function(e,t){return r.createElement("path",{key:t,d:e})}))))}),(function(e,t){return JSON.stringify(e.paths)===JSON.stringify(t.paths)})),z=function(e,t,n){var r,a=[];return e.forEach((function(e){var i=t[e],c=n[e];if(!r&&0!==r)return r=c,void a.push("M "+i+","+c);0===c?(c<r&&a.push("H "+(i-40),"a 40,40 0 0,0 40,-40","V "+c),c>r&&a.push("H "+(i-40),"a 40,40 0 0,1 40,40","V "+c)):(c<r&&a.push("V "+(c+40),"a 40,40 0 0,1 40,-40","H "+i),c>r&&a.push("V "+(c-40),"a 40,40 0 0,0 40,40","H "+i)),a.push("H "+i),r=c})),a.join(" ").replace(/( H ([\d.]+))+/g," H $2")},k=function(e){var t=r.useContext(a.b).param;return r.createElement("g",{id:"stn_icons"},Object.keys(t.stn_list).map((function(t){if(!["linestart","lineend"].includes(t))return r.createElement("g",{key:t,style:{transform:"translate("+e.xs[t]+"px,"+e.ys[t]+"px)"}},r.createElement(g,{stnId:t,stnState:e.stnStates[t],stnY:e.ys[t]}))})))},N=function(){return(N=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},P=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n},M=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,i=n.call(e),c=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)c.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(a)throw a.error}}return c},L=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(M(arguments[t]));return e},H=(t.default=function(){var e=r.useContext(a.b).param;return r.createElement(r.Fragment,null,r.createElement(H,null),r.createElement(i.a,{variant:e.info_panel_type,isShowLight:!1,isShowPSD:!1}),"l"===e.direction&&e.stn_list[e.current_stn_idx].parents.includes("linestart")||"r"===e.direction&&e.stn_list[e.current_stn_idx].children.includes("lineend")?r.createElement(I,null):r.createElement(r.Fragment,null,r.createElement(w,null),r.createElement(F,null),e.notesGZMTR.map((function(e,t){return r.createElement(B,{key:t,note:e})}))))},r.memo((function(){return r.createElement("defs",null,r.createElement("path",{id:"stn",className:"rmg-stn",d:"M 0,9.25 V -9.25 H -9.25 a 9.25,9.25 0 0,0 0,18.5 h 18.5 a 9.25,9.25 0 0,0 0,-18.5 H 0 "}),r.createElement("path",{id:"stn_pass",stroke:"#aaa",fill:"#fff",strokeWidth:2,d:"M 0,9.25 V -9.25 H -9.25 a 9.25,9.25 0 0,0 0,18.5 h 18.5 a 9.25,9.25 0 0,0 0,-18.5 H 0 "}),r.createElement("path",{id:"arrow_direction",d:"M 60,60 L 0,0 L 60,-60 H 100 L 55,-15 H 160 V 15 H 55 L 100,60z",fill:"black"}),r.createElement("path",{id:"inttick",d:"M 0,0 v 18",strokeLinecap:"square"}),r.createElement("rect",{id:"intbox",x:-22.5,height:24,width:45,rx:4.5}))}))),F=function(){var e,t,n=r.useContext(a.b),i=n.param,c=n.routes,l=r.useMemo((function(){return L(new Set(c.reduce((function(e,t){return t.includes(i.current_stn_idx)?e.concat(t.filter((function(e){return!["linestart","lineend"].includes(e)})).slice("l"===i.direction?0:-1)[0]):e}),[])))}),[i.current_stn_idx,i.direction,c.toString()]),s={textAnchor:"l"===i.direction?"start":"end",transform:"translate("+("l"===i.direction?65:-65)+",-5)",destIds:l};return r.createElement("g",{id:"direction_gz",style:(e={},e["--x-percentage"]=i.direction_gz_x,e["--y-percentage"]=i.direction_gz_y,e)},r.createElement("use",{xlinkHref:"#arrow_direction",style:(t={},t["--rotate"]="l"===i.direction?"0deg":"180deg",t)}),2!==l.length?r.createElement(R,N({},s)):r.createElement(W,N({},s)))},R=function(e){var t=e.destIds,n=P(e,["destIds"]),i=r.useContext(a.b).param;return r.createElement("g",N({},n),r.createElement("text",{className:"rmg-name__zh",fontSize:28},t.map((function(e){return i.stn_list[e].name[0]})).join("/")+"方向"),r.createElement("text",{className:"rmg-name__en",fontSize:14,dy:22},"Towards "+t.map((function(e){return i.stn_list[e].name[1].replace("\\"," ")})).join("/")))},W=function(e){var t=e.destIds,n=P(e,["destIds"]),i=r.useContext(a.b).param,c=t.map((function(e){return i.stn_list[e].name[0].length})),l=Math.min.apply(Math,L(c)),s=l>1&&c[0]!==c[1]?Math.abs(c[0]-c[1])/(l-1):0;return r.createElement("g",N({},n),t.map((function(e,t){return r.createElement(r.Fragment,{key:e},r.createElement("text",{className:"rmg-name__zh",fontSize:25,x:"l"===i.direction?0:-75,y:42*t-21,letterSpacing:c[t]>c[1-t]?"0em":s+"em"},i.stn_list[e].name[0]),r.createElement("text",{className:"rmg-name__en",fontSize:11.5,x:"l"===i.direction?0:-75,y:42*t-1},"Towards "+i.stn_list[e].name[1].replace("\\"," ")))})),r.createElement("text",{className:"rmg-name__zh",fontSize:28,x:"l"===i.direction?25*(Math.max.apply(Math,L(c))+1):0,y:5},"方向"))},I=r.memo((function(){return r.createElement("g",{id:"terminus_gz",textAnchor:"middle"},r.createElement("text",{className:"rmg-name__zh",fontSize:90},"终 点 站"),r.createElement("text",{dy:70,className:"rmg-name__en",fontSize:36},"Terminal"),r.createElement("g",{strokeWidth:8,stroke:"#000"},r.createElement("path",{d:"M -160,68 h -160"}),r.createElement("path",{d:"M 160,68 h 160"})))})),B=r.memo((function(e){var t,n=r.useRef(),a=M(r.useState({width:0,height:0,y:0}),2),i=a[0],c=a[1];return r.useEffect((function(){return c(n.current.getBBox())}),[e.note[0],e.note[1]]),r.createElement("g",{className:"note-box",style:(t={},t["--x-percentage"]=e.note[2],t["--y-percentage"]=e.note[3],t)},e.note[4]&&r.createElement("rect",{height:i.height+4,width:i.width+4,x:-2,y:i.y-2,fill:"none",stroke:"black",strokeWidth:.5}),r.createElement("g",{ref:n},r.createElement("g",{fontSize:16,letterSpacing:1.2},e.note[0].split("\n").map((function(e,t){return r.createElement("text",{key:t,className:"rmg-name__zh",y:18*t},e)}))),r.createElement("g",{fontSize:10,letterSpacing:.33,transform:"translate(0,"+18*e.note[0].split("\n").length+")"},e.note[1].split("\n").map((function(t,n){var a;return r.createElement("text",{key:n,className:"rmg-name__en",y:11*n,textLength:n<(null===(a=e.note[1].match(/\n/g))||void 0===a?void 0:a.length)?i.width:0,lengthAdjust:"spacing"},t)})))))}),(function(e,t){return e.note.toString()===t.note.toString()}))}}]);