(window.webpackJsonp=window.webpackJsonp||[]).push([[56],{77:function(e,t,n){"use strict";n.r(t);var o=n(0),r=n(3),l=n(1),a=n(5),i=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,l=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=l.next()).done;)a.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}return a},c=function(e){var t=Object(r.useTranslation)().t,n=i(o.useState(!1),2),a=n[0],c=n[1],u=i(o.useState({}),2),m=u[0],p=u[1];return o.createElement("div",null,o.createElement(l.ListItem,{button:!0,component:"label",htmlFor:"upload-param"},o.createElement(l.ListItemIcon,null,o.createElement(l.Icon,null,"folder_open")),o.createElement(l.ListItemText,{primary:t("file.open.button")})),o.createElement("input",{type:"file",accept:"application/json",style:{display:"none"},id:"upload-param",onChange:function(e){console.log(e.target.files[0]),new Promise((function(t){var n=new FileReader;n.onloadend=t,n.readAsText(e.target.files[0])})).then((function(e){return JSON.parse(e.target.result)})).then((function(e){p(e),c(!0)}))}}),o.createElement(s,{open:a,onClose:function(e){return function(){if("close"===e)return document.getElementById("upload-param").value="",void c(!1);"accept"===e&&(localStorage.rmgParam=JSON.stringify(m),location.reload(!0))}},content:m}))};function s(e){var t,n=Object(r.useTranslation)().t;return o.createElement(l.Dialog,{onClose:e.onClose("close"),open:e.open},o.createElement(l.DialogTitle,null,"Your Configuration"),o.createElement(l.DialogContent,{dividers:!0},o.createElement(l.DialogContentText,{style:{whiteSpace:"pre-line"}},0===Object.keys(e.content).length?"empty":(t=e.content,"Number of stations: "+(Object.keys(t.stn_list).length-2)+"\n                "+Object.entries(t.stn_list).map((function(e){return["linestart","lineend"].includes(e[0])?"":e[1].name.join(" - ")})).join("\r\n").trim().replace(/\\/," ")))),o.createElement(l.DialogActions,null,o.createElement(l.Button,{onClick:e.onClose("close"),color:"primary"},n("dialog.cancel")),o.createElement(l.Button,{onClick:e.onClose("accept"),color:"primary",autoFocus:!0},"Import")))}function u(e){var t=e.viewBox.baseVal.width,n=e.viewBox.baseVal.height;e.setAttribute("width",t.toString()),e.setAttribute("height",n.toString());var o=document.querySelectorAll("canvas")[0];o.width=2.5*Number(t),o.height=2.5*Number(n);var r=o.getContext("2d");r.clearRect(0,0,o.width,o.height),e.querySelectorAll(".rmg-name__en.rmg-name__mtr--station").forEach((function(e){return e.setAttribute("font-size","11px")})),e.querySelectorAll(".rmg-name__zh.IntName").forEach((function(e){return e.setAttribute("font-size","10px")})),e.querySelectorAll(".rmg-name__en.rmg-name__mtr--osi").forEach((function(e){return e.setAttribute("font-size","9px")})),e.querySelectorAll(".rmg-name__en.rmg-name__gzmtr--next2-dest").forEach((function(e){return e.setAttribute("font-size","8.5px")})),e.querySelectorAll(".rmg-name__en.IntName").forEach((function(e){return e.setAttribute("font-size","7px")})),e.querySelectorAll("text:not([font-size]), tspan:not([font-size])").forEach((function(e){return e.setAttribute("font-size",window.getComputedStyle(e).fontSize)})),e.querySelectorAll("text, tspan").forEach((function(e){var t=window.getComputedStyle(e);e.setAttribute("font-family",t.fontFamily),e.setAttribute("fill",t.fill),e.setAttribute("dominant-baseline",t.dominantBaseline),e.setAttribute("text-anchor",t.textAnchor),e.removeAttribute("class")}));var l=new Image;l.onload=function(){setTimeout((function(){var e,a,i;r.drawImage(l,0,0,2.5*Number(t),2.5*Number(n)),e=o.toDataURL("image/png"),a="rmg."+(new Date).toISOString()+".png","string"==typeof(i=document.createElement("a")).download?(i.href=e,i.download=a,document.body.appendChild(i),i.click(),document.body.removeChild(i)):window.open(e)}),2e3)},l.addEventListener("loadend",(function(){console.log("img loaded")})),l.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e.outerHTML)))}var m=function(e,t,n,o){return new(n||(n=Promise))((function(r,l){function a(e){try{c(o.next(e))}catch(e){l(e)}}function i(e){try{c(o.throw(e))}catch(e){l(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,i)}c((o=o.apply(e,t||[])).next())}))},p=function(e,t){var n,o,r,l,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return l={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function i(l){return function(i){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&l[0]?o.return:l[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,l[1])).done)return r;switch(o=0,r&&(l=[2&l[0],r.value]),l[0]){case 0:case 1:r=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,o=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==l[0]&&2!==l[0])){a=0;continue}if(3===l[0]&&(!r||l[1]>r[0]&&l[1]<r[3])){a.label=l[1];break}if(6===l[0]&&a.label<r[1]){a.label=r[1],r=l;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(l);break}r[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],o=0}finally{n=r=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,i])}}},f=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,l=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=l.next()).done;)a.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}return a},d=function(e){var t=Object(r.useTranslation)().t,a=f(o.useState(document.createElement("svg")),2),i=a[0],c=a[1],s=f(o.useState(!1),2),d=s[0],g=s[1],y=o.useRef();o.useEffect((function(){if(""===e.canvas)return c(document.createElement("svg")),void g(!1);var t=f(["--rmg-svg-width","--rmg-svg-height"].map((function(t){return document.querySelector("svg#"+e.canvas).style.getPropertyValue(t).match(/\d+/g)[0]})).map(Number),2),o=t[0],r=t[1],l=Math.min(window.innerWidth,1412)-64-48,a=window.innerHeight-64-64-52-16,i=Math.min(l/o,a/r),s=document.querySelector("svg#"+e.canvas).cloneNode(!0);s.setAttribute("height",(r*i).toString()),s.style.setProperty("all","initial"),["share",e.canvas].map((function(e){var t;return Array.from((null===(t=Array.from(document.querySelectorAll("link")).filter((function(t){return t.id==="css_"+e}))[0])||void 0===t?void 0:t.sheet).cssRules).map((function(e){return e.cssText})).join(" ")})).forEach((function(e){var t=document.createElement("style");t.innerText=e,s.prepend(t)})),"mtr"===window.urlParams.get("style")?n.e(55).then(n.bind(null,69)).then((function(e){(0,e.getBase64FontFace)(s).then((function(e){return m(void 0,void 0,void 0,(function(){var t,n;return p(this,(function(o){switch(o.label){case 0:return[4,Promise.all(e)];case 1:return t=o.sent(),(n=document.createElement("style")).innerText=t.join(" "),s.prepend(n),c(s),document.fonts.ready.then((function(){return g(!0)})),[2]}}))}))}))})):(c(s),g(!0))}),[e.canvas]);var v=function(t){return function(){var n=y.current.querySelector("svg");if("png"===t)u(n);else if("svg"===t){var o=document.createElement("a");o.href="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(n.outerHTML))),o.download="rmg."+(new Date).toISOString()+".svg",o.click()}e.onClose("close")}};return o.createElement(l.Dialog,{onClose:v("close"),open:e.open,maxWidth:!1},o.createElement(l.DialogTitle,null,t("file.preview.title")),o.createElement(l.DialogContent,{dangerouslySetInnerHTML:{__html:i.outerHTML},ref:y}),o.createElement(l.DialogActions,null,o.createElement(l.Button,{onClick:v("close"),color:"primary",autoFocus:!0},t("dialog.cancel")),o.createElement(l.Button,{onClick:v("png"),color:"primary",disabled:!d},t("file.preview.png")),o.createElement(l.Button,{onClick:v("svg"),color:"primary",disabled:!d},t("file.preview.svg"))))},g=n(2),y=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,l=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=l.next()).done;)a.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}return a};var v,h=function(e){var t=Object(r.useTranslation)().t,n=o.useContext(g.a),a=n.canvasAvailable,i=n.canvasToShown,c=y(o.useState(!1),2),s=c[0],u=c[1],m=y(o.useState(""),2),p=m[0],f=m[1],v=function(t){return function(){"close"!==t&&(u(!0),f(t)),e.onClose("close")}};return o.createElement(o.Fragment,null,o.createElement(l.Dialog,{onClose:v("close"),open:e.open},o.createElement(l.DialogTitle,null,t("file.export.title")),o.createElement(l.DialogContent,{dividers:!0},o.createElement(l.List,null,("all"===i?a:[i]).map((function(e){return o.createElement(l.ListItem,{button:!0,key:e,onClick:v(e)},o.createElement(l.ListItemText,{primary:t("file.export."+e)}))}))))),o.createElement(d,{open:s,onClose:function(e){"close"===e&&(u(!1),f(""))},canvas:p}))},b=(v=function(e,t){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}v(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),E=o.lazy((function(){return n.e(57).then(n.bind(null,83))})),w={gzmtr:"Guangzhou Metro",mtr:"MTR",shmetro:"Shanghai Metro (Alpha)"},C={en:"English","zh-Hans":"中文（简体）","zh-HK":"中文（香港）"},S=function(e){function t(t){var n=e.call(this,t)||this;return n.state={style:window.urlParams.get("style"),lang:window.urlParams.get("lang"),templateDialogOpened:!1,exportDialogOpened:!1,previewDialogOpened:!1,previewDialogCanvas:"",styleDialogOpened:!1,langDialogOpened:!1},n.saveClick=n.saveClick.bind(n),n.exportDialogClose=n.exportDialogClose.bind(n),n.previewDialogClose=n.previewDialogClose.bind(n),n.styleDialogClose=n.styleDialogClose.bind(n),n}return b(t,e),t.prototype.saveClick=function(){var e=document.createElement("a");e.href="data:application/json;base64,"+btoa(unescape(encodeURIComponent(localStorage.rmgParam))),e.download="rmg.param."+(new Date).toISOString()+".json",e.click()},t.prototype.exportDialogClose=function(e){"close"!==e?this.setState({exportDialogOpened:!1,previewDialogOpened:!0,previewDialogCanvas:e}):this.setState({exportDialogOpened:!1})},t.prototype.previewDialogClose=function(e){"close"===e&&this.setState({previewDialogOpened:!1,previewDialogCanvas:""})},t.prototype.styleDialogClose=function(e){"close"===e||e===this.state.style?this.setState({styleDialogOpened:!1}):(this.setState({style:e,styleDialogOpened:!1}),window.urlParams.set("style",e),window.gtag("event","set",{event_category:"style",event_label:e}),window.location.href="?"+window.urlParams.toString())},t.prototype.render=function(){var e=this;return o.createElement("div",null,o.createElement(l.Card,null,o.createElement(l.List,{component:"nav"},o.createElement(l.ListItem,{button:!0,onClick:function(){return e.setState({templateDialogOpened:!0})}},o.createElement(l.ListItemIcon,null,o.createElement(l.Icon,null,"note_add")),o.createElement(l.ListItemText,{primary:this.props.t("file.new.button")})),o.createElement(c,null),o.createElement(l.ListItem,{button:!0,onClick:this.saveClick},o.createElement(l.ListItemIcon,null,o.createElement(l.Icon,null,"save")),o.createElement(l.ListItemText,{primary:this.props.t("file.save")})),o.createElement(l.ListItem,{button:!0,onClick:function(){return e.setState({exportDialogOpened:!0})}},o.createElement(l.ListItemIcon,null,o.createElement(l.Icon,null,"cloud_download")),o.createElement(l.ListItemText,{primary:this.props.t("file.export.button")}))),o.createElement(l.Divider,null),o.createElement(l.List,{component:"nav"},o.createElement(l.ListItem,{button:!0,onClick:function(){return e.setState({styleDialogOpened:!0})}},o.createElement(l.ListItemIcon,null,o.createElement(l.Icon,null,"style")),o.createElement(l.ListItemText,{primary:this.props.t("file.style.button"),secondary:this.props.t("file.style."+this.state.style)})),o.createElement(l.ListItem,{button:!0,onClick:function(){return e.setState({langDialogOpened:!0})}},o.createElement(l.ListItemIcon,null,o.createElement(l.Icon,null,"translate")),o.createElement(l.ListItemText,{primary:this.props.t("file.lang.button"),secondary:Object(a.b)(C,this.props.i18n.languages)})))),o.createElement(o.Suspense,{fallback:o.createElement(l.LinearProgress,null)},o.createElement(E,{open:this.state.templateDialogOpened,onClose:function(){return e.setState({templateDialogOpened:!1})}})),o.createElement(h,{open:this.state.exportDialogOpened,onClose:this.exportDialogClose}),o.createElement(D,{open:this.state.styleDialogOpened,onClose:this.styleDialogClose}),o.createElement(x,{open:this.state.langDialogOpened,onClose:function(){return e.setState({langDialogOpened:!1})}}))},t}(o.Component);function D(e){var t=Object(r.useTranslation)(),n=t.t;t.i18n;return o.createElement(l.Dialog,{onClose:function(){return e.onClose("close")},open:e.open},o.createElement(l.DialogTitle,null,n("file.style.title")),o.createElement(l.DialogContent,{dividers:!0},o.createElement(l.List,null,Object.keys(w).map((function(t){return o.createElement(l.ListItem,{button:!0,onClick:function(){return e.onClose(t)},key:t},o.createElement(l.ListItemText,{primary:n("file.style."+t)}))})))))}function x(e){var t=Object(r.useTranslation)(),n=t.t,a=t.i18n;return o.createElement(l.Dialog,{onClose:e.onClose,open:e.open},o.createElement(l.DialogTitle,null,n("file.lang.title")),o.createElement(l.DialogContent,{dividers:!0},o.createElement(l.List,null,Object.keys(C).map((function(t){return o.createElement(l.ListItem,{button:!0,onClick:function(){return(n=t)===a.language||(a.changeLanguage(n).then((function(e){return document.title=e("title")})),window.gtag("event","set",{event_category:"language",event_label:n}),document.documentElement.setAttribute("lang",n)),void e.onClose();var n},key:t},o.createElement(l.ListItemText,{primary:C[t]}))})))))}t.default=function(e){var t=Object(r.withTranslation)()(S);return o.createElement(l.Grid,{container:!0,spacing:3,justify:"center",alignItems:"center"},o.createElement(l.Grid,{item:!0,xs:12,sm:8,md:6,lg:4},o.createElement(t,null)))}}}]);