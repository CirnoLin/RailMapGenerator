(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{11:function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return l})),n.d(e,"f",(function(){return c})),n.d(e,"e",(function(){return u})),n.d(e,"a",(function(){return f})),n.d(e,"d",(function(){return h}));n(4);var r=function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},i=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,a=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=a.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return s},a=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(i(arguments[e]));return t},s=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},o=function(t,e,n){return Object.keys(t).reduce((function(i,a){var s;return r(r({},i),((s={})[a]=t[a].children.reduce((function(i,s){var o;return r(r({},i),((o={})[s]=1+e(t,s)+n(t,a),o))}),{}),s))}),{})},l=function(t,e,n){if(t==e)return{len:0,nodes:[t]};var r=[],i=[];Object.keys(n[t]).forEach((function(a){var s=l(a,e,n);s.len<0||(r.push(n[t][a]+s.len),s.nodes.unshift(t),i.push(s.nodes))}));var s=Math.max.apply(Math,a(r));return{len:s,nodes:i[r.indexOf(s)]}},c=function(t,e,n){var r=l("linestart","lineend",e);if(r.nodes.includes(t))return l(r.nodes[1],t,e).len;for(var i=n.filter((function(e){return e.includes(t)}))[0],a=t;!r.nodes.includes(a);)a=i[i.indexOf(a)-1];for(var s=t;!r.nodes.includes(s);)s=i[i.indexOf(s)+1];var o="linestart"===a,c=[];return o||"lineend"===s?o?(c[0]=0,c[1]=l(r.nodes[1],s,e).len,c[2]=l(i[1],t,e).len,c[3]=l(t,s,e).len):(c[0]=l(r.nodes[1],a,e).len,c[1]=l(a,r.nodes.slice(-2)[0],e).len,c[2]=l(a,t,e).len,c[3]=l(t,i.slice(-2)[0],e).len):(c[0]=l(r.nodes[1],a,e).len,c[1]=l(a,s,e).len,c[2]=l(a,t,e).len,c[3]=l(t,s,e).len),c[0]+c[2]*c[1]/(c[2]+c[3])},u=function(t,e,n){return console.log("computing stations' states"),a(new Set([].concat.apply([],a(e)))).reduce((function(i,a){var o;return r(r({},i),((o={})[a]=a===t?0:("r"===n?function(t,e,n){var r,i;try{for(var a=s(n),o=a.next();!o.done;o=a.next()){var l=o.value,c=l.indexOf(t),u=l.indexOf(e);if(-1!==c&&c<u)return!0}}catch(t){r={error:t}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return!1}(t,a,e):function(t,e,n){var r,i;try{for(var a=s(n),o=a.next();!o.done;o=a.next()){var l=o.value,c=l.indexOf(t),u=l.indexOf(e);if(-1!==u&&u<c)return!0}}catch(t){r={error:t}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return!1}(t,a,e))?1:-1,o))}),{})},f=function(){function t(t){var e=this;this.yShares={},this.xShares={},this.namePoss={},this.stnList={},this.criticalPath={},this.leftWideFactor=function(t){return 0},this.rightWideFactor=function(t){return 0},this.pathWeight=function(t,n){return e.stnList[t].children.includes(n)?1+e.rightWideFactor(t)+e.leftWideFactor(n):-1/0},this.pathTurnParams=function(t){var e=35-17.5*Math.sqrt(3),n=t-2*e;return{tr:35,dx_a:17.5,dy_a:e,dx_l:n*Math.sqrt(3),dy_l:n}},this.pathTurnSE=function(t){var n=e.pathTurnParams(t),r=n.tr,i=n.dx_a,a=n.dy_a;return"a "+r+","+r+" 0 0,1 "+i+","+a+" l "+n.dx_l+","+n.dy_l+" a "+r+","+r+" 0 0,0 "+i+","+a},this.pathTurnNE=function(t){var n=e.pathTurnParams(t),r=n.tr,i=n.dx_a,a=n.dy_a;return"a "+r+","+r+" 0 0,0 "+i+","+-a+" l "+n.dx_l+","+-n.dy_l+" a "+r+","+r+" 0 0,1 "+i+","+-a},this.stnList=t.stnList,this.criticalPath=t.criticalPath}return t.prototype.getYShare=function(t,e){if(t in this.yShares)return this.yShares[t];if(["linestart","lineend"].includes(t)||this.stnList[t].parents.length>1||this.stnList[t].children.length>1)return this.yShares[t]=0,0;var n=this.stnList[t].parents[0];if(n){if(1==this.stnList[n].children.length){var r=this.getYShare(n);return this.yShares[t]=r,r}r=0==this.stnList[n].children.indexOf(t)?1:-1;return this.yShares[t]=r,r}return this.yShares[t]=0,0},t.getYShares=function(t,e){console.log("computing y shares");var n=new this({stnList:t});return Object.keys(t).forEach((function(t){["linestart","lineend"].includes(t)||t in n.yShares||n.getYShare(t,e)})),n.yShares},t.prototype.getNamePos=function(t){if("linestart"===t)return this.namePoss.linestart=!0,!0;var e=this.criticalPath.nodes.indexOf(t)%2;if(-1===e){var n=this.stnList[t].parents[0];if(2===this.stnList[n].children.length){var r=this.getNamePos(n);return this.namePoss[t]=r,r}var i=!this.getNamePos(n);return this.namePoss[t]=i,i}return this.namePoss[t]=1===e,1===e},t.getNamePos=function(t,e){console.log("computing name position");var n=new this({stnList:t,criticalPath:e});return Object.keys(t).forEach((function(t){["linestart","lineend"].includes(t)||t in n.namePoss||n.getNamePos(t)})),n.namePoss},t.prototype._linePath=function(t,e,n,r,a,s,o){var l=this,c=i([],3),u=c[0],f=c[1],h=c[2],m=[],d=this.pathTurnParams(s),p=d.dx_a+d.dx_l/2,g=(e[1]-e[0])/o.len*.8,y=((e[1]-e[0])/o.len-2*p)/2;return y+g<0&&console.warn("SVG width too small! "+(y+g)),t.forEach((function(e){var o,c,d=r[e],v=a[e];if(!f&&0!==f)return o=i([e,d,v],3),u=o[0],h=o[1],f=o[2],void(1===t.length?m.push("M "+d+","+v):n[0].includes(e)?n[0].includes(t[1])?m.push("M "+d+","+v):(r[t[1]]>0&&m.push("M "+d+","+(v+9.68)),a[t[1]]<0&&m.push("M "+d+","+(v-9.68))):m.push("M "+d+","+v));v>f?(m.push(0===v?"h "+(d-h-g*l.leftWideFactor(e)-y-2*p):"h "+(g*l.rightWideFactor(u)+y)),m.push(l.pathTurnSE(s))):v<f&&(m.push(0===v?"h "+(d-h-g*l.leftWideFactor(e)-y-2*p):"h "+(g*l.rightWideFactor(u)+y)),m.push(l.pathTurnNE(s))),m.push("H "+d),c=i([e,d,v],3),u=c[0],h=c[1],f=c[2]})),m.join(" ").replace(/( H ([\d.]+))+/g," H $2")},t.drawLine=function(t,e,n,r,i,a,s,o){var l=this,c={main:[],pass:[]};return t.map((function(u,f){var h=(u=u.filter((function(t){return!["linestart","lineend"].includes(t)}))).filter((function(t){return e[t]>=0})),m=u.filter((function(t){return e[t]<=0}));1===h.length&&(m=u),0==h.filter((function(t){return-1!==m.indexOf(t)})).length&&h.length&&(m[0]===u[0]?m.push(h[0]):h[0]===u[0]&&h[h.length-1]===u[u.length-1]&&m.length?(m=u,h=[]):m.unshift(h[h.length-1])),c.main.push(new l({stnList:n,criticalPath:o})._linePath(h,r,t,i,a,s,o)),c.pass.push(new l({stnList:n,criticalPath:o})._linePath(m,r,t,i,a,s,o))})),c},t}(),h=function(t,e){var n={main:[],pass:[]};return t.map((function(t){var r=(t=t.filter((function(t){return!["linestart","lineend"].includes(t)}))).filter((function(t){return e[t]>=0})),i=t.filter((function(t){return e[t]<=0}));1===r.length&&(i=t),0==r.filter((function(t){return-1!==i.indexOf(t)})).length&&r.length&&(i[0]===t[0]?i.push(r[0]):r[0]===t[0]&&r[r.length-1]===t[t.length-1]&&i.length?(i=t,r=[]):i.unshift(r[r.length-1])),n.main.push(r),n.pass.push(i)})),n}},82:function(t,e,n){"use strict";n.r(e);var r=n(0),i=n(2),a=n(11),s=function(){return(s=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},o=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n},l=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,a=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=a.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return s},c=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(l(arguments[e]));return t},u=function(t){var e=r.useContext(i.b).param.stn_list[t.stnId];return r.createElement(r.Fragment,null,r.createElement("use",{xlinkHref:"#"+("none"===e.transfer.type?"stn_sh":"int2_sh")+(-1===t.stnState?"_pass":""),className:"rmg-stn"}),r.createElement("g",{transform:"translate("+(c(e.branch.left,e.branch.right).length?30:0)+",0)"},r.createElement(f,{name:e.name,infos:e.transfer.info,isOSI:e.transfer.type.includes("osi"),stnState:t.stnState})))},f=function(t){var e=t.name[1].split("\\").length,n=r.useRef(),i=l(r.useState({width:0}),2),a=i[0],s=i[1];r.useEffect((function(){return s(n.current.getBBox())}),[t.name.toString()]);var o=a.width+5;return r.createElement("g",{className:"Name Future",transform:"translate("+-(24+12*(e-1))*Math.cos(-45)+","+(-25.921875-12*(e-1)*Math.cos(-45))+")rotate(-50)",textAnchor:"start"},r.createElement(h,{ref:n,name:t.name}),r.createElement(m,{intInfos:t.isOSI?t.infos.flat():t.infos[0],transform:"translate("+o+",0)"}),t.isOSI&&r.createElement("g",{transform:"translate("+(o+15*t.infos.flat().length)+",-30)"},r.createElement(g,{osiInfos:t.infos[1]})))},h=r.forwardRef((function(t,e){return r.useMemo((function(){return r.createElement("g",{ref:e},r.createElement("text",{className:"rmg-name__zh"},t.name[0]),r.createElement("g",{fontSize:"60%"},t.name[1].split("\\").map((function(t,e){return r.createElement("text",{key:e,className:"rmg-name__en",dy:12*(e+1)},t)}))))}),[t.name.toString()])})),m=function(t){var e=t.intInfos,n=o(t,["intInfos"]),i=0;return r.createElement("g",s({},n),e.map((function(t,e){var n=Boolean(t[4].match(/^\d.*$/)),a=r.createElement("g",{transform:"translate("+i+",0)",key:e},n?r.createElement(d,{info:t}):r.createElement(p,{info:t}));return i+=n?25:16*t[4].length+12+5,a})))},d=r.memo((function(t){return r.createElement(r.Fragment,null,r.createElement("rect",{height:30,width:20,y:-15,fill:t.info[2]}),r.createElement("text",{x:10,className:"rmg-name__zh",textAnchor:"middle",fill:t.info[3],dominantBaseline:"central"},String(t.info[4]).match(/(\d*)\w+/)[0]))}),(function(t,e){return t.info.toString()===e.info.toString()})),p=r.memo((function(t){var e=t.info[4].split("\\")[0].length;return r.createElement(r.Fragment,null,r.createElement("rect",{height:30,width:16*e+12,y:-15,fill:t.info[2]}),r.createElement("text",{x:8*e+6,className:"rmg-name__zh",textAnchor:"middle",fill:t.info[3],dominantBaseline:"central"},t.info[4].split("\\")[0]))}),(function(t,e){return t.info.toString()===e.info.toString()})),g=function(t){var e=t.osiInfos.map((function(t){return t[4]}));return r.useMemo((function(){return r.createElement("g",{textAnchor:"middle",fontSize:"50%"},r.createElement("text",{className:"rmg-name__zh rmg-name__shmetro--station"},"换乘"+e.join("，")),r.createElement("text",{className:"rmg-name__zh rmg-name__shmetro--station",dy:10},"仅限公共交通卡"))}),[e.toString()])},y=function(){return(y=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},v=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,a=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=a.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return s},_=function(){var t=r.useContext(i.b),e=t.param,n=t.routes,s=t.branches,o=t.deps,l=Object(a.b)(e.stn_list,(function(){return 0}),(function(){return 0})),c=Object(a.c)("linestart","lineend",l),u=Object(a.c)(c.nodes[1],c.nodes.slice(-2)[0],l),f=r.useMemo((function(){return console.log("computing x shares"),Object.keys(e.stn_list).reduce((function(t,e){var n;return y(y({},t),((n={})[e]=Object(a.f)(e,l,s),n))}),{})}),[s.toString(),JSON.stringify(l)]),h=[e.svgWidth.railmap*e.padding/100,e.svgWidth.railmap*(1-e.padding/100)],m=Object.keys(f).reduce((function(t,e){var n;return y(y({},t),((n={})[e]=h[0]+f[e]/u.len*(h[1]-h[0]),n))}),{}),d=r.useMemo((function(){return console.log("computing y shares"),Object.keys(e.stn_list).reduce((function(t,e){var n;return y(y({},t),((n={})[e]=s[0].includes(e)?0:3,n))}),{})}),[o]),p=Object.keys(d).reduce((function(t,n){var r;return y(y({},t),((r={})[n]=-d[n]*e.branch_spacing,r))}),{}),g=r.useMemo((function(){return Object(a.e)(e.current_stn_idx,n,e.direction)}),[e.current_stn_idx,e.direction,n.toString()]),v=Object(a.d)(s,g),_=Object.keys(v).reduce((function(t,n){var r;return y(y({},t),((r={})[n]=v[n].map((function(t){return b(t,n,m,p,e.direction)})),r))}),{});return r.createElement("g",{id:"main",transform:"translate(0,"+(e.svg_height-63)+")"},r.createElement(E,{paths:_}),r.createElement(x,{xs:m,ys:p,stnStates:g}))},E=function(t){return r.createElement(r.Fragment,null,r.createElement("g",{className:"rmg-line rmg-line__pass rmg-line__shmetro"},t.paths.pass.map((function(t,e){return r.createElement("path",{key:e,stroke:"gray",strokeWidth:12,fill:"none",d:t})}))),r.createElement("g",{className:"rmg-line rmg-line__shmetro"},t.paths.main.map((function(t,e){return r.createElement("path",{key:e,fill:"var(--rmg-theme-colour)",d:t})}))))},b=function(t,e,n,r,i){var a=v([],3),s=(a[0],a[1]),o=a[2],l={},c=30;if(t.forEach((function(t){var e,i,a=n[t],c=r[t];if(!s&&0!==s)return e=v([t,a,c],3),e[0],o=e[1],s=e[2],void(l.start=[a,c]);0===c?c!=s&&(l.bifurcate=[o,s]):c!=s&&(l.bifurcate=[a,c]),l.end=[a,c],i=v([t,a,c],3),i[0],o=i[1],s=i[2]})),l.hasOwnProperty("start")){if(l.hasOwnProperty("end")){if(l.hasOwnProperty("bifurcate")){var u=v(l.start,2),f=(g=u[0],y=u[1],_=l.end[0],v(l.bifurcate,2)),h=(f[0],f[1],v(l.end,2)),m=h[0],d=h[1];return"main"===e?"l"===i?d>y?"M "+(g-c)+","+(y-6)+" H "+(m+6)+" V "+(d-6)+" h -12 V "+(y+6)+" H "+(g-c-12)+" Z":"M "+m+","+(d-6)+" H "+(g-6)+" V "+(y-6)+" h 12 V "+(d+6)+" H "+m+" Z":d>y?"M "+g+","+(y-6)+" H "+(m+6)+" V "+(d-6)+" h -12 V "+(y+6)+" H "+g+" Z":"M "+(m+c)+","+(d-6)+" H "+(g-6)+" V "+(y-6)+" h 12 V "+(d+6)+" H "+(m+c+12)+" Z":d>y?"M "+(g-c)+","+y+" H "+m+" V "+d:"M "+g+","+y+" V "+d+" H "+(m+c)}var p=v(l.start,2),g=p[0],y=p[1],_=l.end[0];return"main"===e?"l"===i?"M "+(g-c)+","+(y-6)+" H "+_+" l 0,12 L "+(g-42)+","+(y+6)+" Z":"M "+g+","+(y-6)+" H "+(_+c)+" l 12,12 L "+g+","+(y+6)+" Z":"M "+(g-c)+","+y+" H "+(_+c)}var E=v(l.start,2),g=E[0],y=E[1];return"main"===e?"l"===i?"M "+g+","+(y-6)+" L "+(g-c)+","+(y-6)+" l -12,12 L "+g+","+(y+6)+" Z":"M "+g+","+(y-6)+" L "+(g+c)+","+(y-6)+" l 12,12 L "+g+","+(y+6)+" Z":"l"===i?"M "+g+","+y+" L "+(g+c)+","+y:"M "+(g-c)+","+y+" L "+g+","+y}return""},x=function(t){var e=r.useContext(i.b).param;return r.createElement("g",{id:"stn_icons"},Object.keys(e.stn_list).map((function(e){if(!["linestart","lineend"].includes(e))return r.createElement("g",{key:e,style:{transform:"translate("+t.xs[e]+"px,"+t.ys[e]+"px)"}},r.createElement(u,{stnId:e,stnState:t.stnStates[e]}))})))},O=r.memo((function(){return r.createElement(r.Fragment,null,r.createElement(S,null),r.createElement(_,null))})),S=(e.default=O,r.memo((function(){return r.createElement("defs",null,r.createElement("circle",{id:"stn_sh",fill:"#fff",stroke:"var(--rmg-theme-colour)",strokeWidth:2,r:5}),r.createElement("circle",{id:"stn_sh_pass",fill:"#fff",stroke:"#aaa",strokeWidth:2,r:5}),r.createElement("path",{id:"int2_sh",fill:"#fff",stroke:"var(--rmg-theme-colour)",strokeWidth:2,d:"M -5,0 a 5,5 0 1 1 10,0 V10 a 5,5 0 1 1 -10,0Z"}),r.createElement("path",{id:"int2_sh_pass",fill:"#fff",stroke:"#aaa",strokeWidth:2,d:"M -5,0 a 5,5 0 1 1 10,0 V10 a 5,5 0 1 1 -10,0Z"}))})))}}]);