(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{16:function(t,e,s){"use strict";s.r(e);var n=s(7),a=s(1);class i extends a.l{constructor(t,e){super(t,e),this.stnNum=e.num}get _nameShift(){return!1}get _tickRotation(){return this.y>0?180:0}get _dxdy(){var t=this.name[1].split("\\").length;let e;return e=this._nameShift?0===this._tickRotation?-9:16+12*(t-1)*Math.cos(-45):0===this._tickRotation?(24+12*(t-1))*Math.cos(-45):-6,[e,0===this._tickRotation?-25.921875-12*(t-1)*Math.cos(-45):17.5]}get iconHTML(){var[t,e]=-1==this.state?["stn_sh_pass","Pass"]:["stn_sh","Future"];return $("<g>",{transform:`translate(${this.x},${this.y})`}).append($("<use>",{"xlink:href":"#"+t,class:"rmg-stn"}))}get nameHTML(){let[t,e]=this._dxdy;return $("<g>",{transform:`translate(${this.x-t},${this.y+e})rotate(-60)`,"text-anchor":0===this._tickRotation?"start":"end",class:"Name Future"}).append($("<text>").addClass("rmg-name__zh rmg-name__shmetro--station").text(this.name[0])).append($("<text>",{dy:15,class:"rmg-name__en rmg-name__shmetro--station"}).text(this.name[1].split("\\")[0]).append($("<tspan>",{x:0,dy:12}).text(this.name[1].split("\\")[1])))}}class r extends i{constructor(t,e){super(t,e),this._intInfos=e.interchange[0]}get html(){return $("<g>",{id:this.id}).append(...this.ungrpHTML)}get ungrpHTML(){return[this.iconHTML,this.nameHTML]}get ungrpIconHTML(){return[...this.intTickHTML]}get iconHTML(){var[t,e]=-1==this.state?["int2_sh_pass","Pass"]:["int2_sh","Future"];return $("<g>",{transform:`translate(${this.x},${this.y})`}).append($("<use>",{"xlink:href":"#"+t,class:"rmg-stn",stroke:this._intInfos[a.d.colour]}))}get nameHTML(){let[t,e]=this._dxdy;return $("<g>",{transform:`translate(${this.x-t},${this.y+e})`}).append($("<g>",{id:`rmg-name__shmetro--${this.id}`,"text-anchor":0===this._tickRotation?"start":"end",class:"Name Future"}).append($("<text>").addClass("rmg-name__zh rmg-name__shmetro--station").text(this.name[0])).append($("<text>",{dy:15,class:"rmg-name__en rmg-name__shmetro--station"}).text(this.name[1].split("\\")[0]).append($("<tspan>",{x:0,dy:12}).text(this.name[1].split("\\")[1]))))}get intTickHTML(){let t=[],e=$(`#rmg-name__shmetro--${this.id}`),s=e.get(0).getBoundingClientRect(),n=s.right-s.left+5;this._intInfos.map((e,s)=>{var i=e[a.d.colour],r=$("<use>",{"xlink:href":"#int_sh",fill:i,transform:`translate(${n+25*s},-12)`,class:"rmg-line__shmetro rmg-line__change"});-1==this.state&&r.addClass("rmg-line__pass");let o=String(e[a.d.nameZH]).match(/(\d*)\w+/);if(o)var h=o[0];else h=String(e[a.d.nameZH]);var l=$("<text>",{transform:`translate(${n+6+25*s},8)`,class:"rmg-name__zh rmg-name__shmetro--line_name"}).text(h);t.push(r,l)});let i=e.parent();return i.attr("transform",`${i.attr("transform")}rotate(-60)`),t}get _nameClass(){return-1==this.state?"Pass":"Future"}}s.d(e,"RMGLineSH",(function(){return o}));class o extends n.a{constructor(t){super(t)}_initStnInstance(t,e){switch(e.change_type){case"int2":case"int3_l":case"int3_r":return new r(t,e);case"osi11_ul":case"osi11_pl":case"osi11_ur":case"osi11_pr":case"osi12_ul":case"osi12_pl":case"osi12_ur":case"osi12_pr":case"osi21_ul":case"osi21_pl":case"osi21_ur":case"osi21_pr":case"osi22_ul":case"osi22_pl":case"osi22_ur":case"osi22_pr":default:return new i(t,e)}}drawDestInfo(){$("#station_info_shmetro > #platform > text").text(this._platformNum);var t=310+$("#station_info_shmetro > #dest_text")[0].getBoundingClientRect().width+45+50,e="l"==this._direction?1:-1,s=(this._svgDestWidth-e*t)/20;s="l"==this._direction?s:this._svgDestWidth-20;var n=90*(1-e);$("#station_info_shmetro > #arrow_left_use").attr("transform",`translate(${s},135)rotate(${n})`);var a=s+285*e;if($("#station_info_shmetro > #platform").attr("transform",`translate(${a},130)`),"r"===this._direction)var i="end",r=.8*this._svgDestWidth;else i="start",r=.2*this._svgDestWidth;$("#station_info_shmetro > #dest_text").attr({transform:`translate(${r},135)`,"text-anchor":i});var[o,h]=["",""];this[`${this._direction}ValidDests`].forEach(t=>{o+=this.stations[t].name[0],h+=this.stations[t].name[1]}),$("#station_info_shmetro > #dest_text > text:first-child").text(`往${o}`),$("#station_info_shmetro > #dest_text > text:last-child").text(`To ${h}`);let l="l"===this._direction?this._svgDestWidth:320;var[_,m]=this._lineNames,d=_.match(/(\d*)\w+/);d?(l-=180,_="号线",$("#station_info_shmetro > #line_number > rect").attr({style:`fill:${this._themeColour}`,transform:`translate(${l-120},70)`}),$("#station_info_shmetro > #line_number > text").text(d[0]).attr("transform",`translate(${l-100},170)`)):(l-=280,$("#station_info_shmetro > #line_number > rect").attr({style:`fill:${this._themeColour}`,transform:`translate(${l-10},60)`,width:260,height:150}),$("#station_info_shmetro > #line_number > text").hide(),$("#station_info_shmetro > #line_name_text > text:last-child").attr("dx",10)),$("#station_info_shmetro > #line_name_text > text:first-child").text(_),$("#station_info_shmetro > #line_name_text > text:last-child").text(m),$("#station_info_shmetro > #line_name_text").attr({transform:`translate(${l},135)`,"text-anchor":"start"});let c="l"==this._direction?"left":"right";$("#line_shmetro_use").attr({"xlink:href":`#line_shmetro_${c}`,transform:"translate(0,220)"})}drawStns(){for(let[t,e]of Object.entries(this.stations))["linestart","lineend"].includes(t)||$("#stn_icons").append(e.html);$("#stn_icons").html($("#stn_icons").html());for(let[t,e]of Object.entries(this.stations).filter(t=>t[1]instanceof r))$(`#rmg-name__shmetro--${t}`).parent().append(e.ungrpIconHTML);$("#stn_icons").html($("#stn_icons").html())}drawLine(){$(".rmg-line").removeClass("rmg-line__mtr").addClass("rmg-line__shmetro"),this.branches.map(t=>{var e=t.filter(t=>this.stations[t].state>=0),s=t.filter(t=>this.stations[t].state<=0);1===e.length&&(s=t),0==e.filter(t=>-1!==s.indexOf(t)).length&&e.length&&(s[0]===t[0]?s.push(e[0]):e[0]===t[0]&&e[e.length-1]===t[t.length-1]&&s.length?(s=t,e=[]):s.unshift(e[e.length-1]));var n=this._linePath(e),[a,i,r]=n.match(/[\d.]+/g).map(t=>Number(t));n="r"===this._direction?`M ${a},${i-6} H ${r+30} l 12,12 L ${a},${i+6} Z`:`M ${a-30},${i-6} H ${r} l 0,12 L ${a-42},${i+6} Z`,$("#line_main").append($("<path>",{id:"line_main_path",d:n}));n=this._linePath(s);var[a,i,r]=n.match(/[\d.]+/g).map(t=>Number(t));n="r"===this._direction?`M ${a-30},${i-6} H ${r} l 0,12 L ${a-30},${i+6} Z`:`M ${a},${i-6} H ${r+30} l 0,12 L ${a},${i+6} Z`,$("#line_pass").append($("<path>",{id:"line_pass_path",d:n}))}),$("#line_main").html($("#line_main").html()),$("#line_pass").html($("#line_pass").html())}fillThemeColour(){super.fillThemeColour(),$("path#stn_sh").attr("stroke",this._themeColour),$("path#int2_sh").attr("stroke",this._themeColour),$("path#stn_sh_pass").attr("stroke","#aaa"),$("path#int2_sh_pass").attr("stroke","#aaa"),$("path#line_main_path").attr("fill",this._themeColour),$("path#line_pass_path").attr("fill","#aaa");let t="l"==this._direction?"left":"right";$(`#line_shmetro_${t}`).attr("fill",this._themeColour),this._lineNames[0].match(/(\d*)\w+/)?$("#station_info_shmetro > #line_number > text").attr("fill","#fff"):$("#station_info_shmetro > #line_name_text").attr("fill","#fff")}updateStnNameBg(){$("#current_bg").hide()}static initSVG(t){t.drawSVGFrame(),t.showFrameOuter(),t.drawStns(),t.drawLine(),t.fillThemeColour(),t.drawStrip(),t.drawDestInfo(),t.loadFonts(),t.updateStnNameBg()}set direction(t){super.direction=t,this.fillThemeColour()}set currentStnId(t){super.currentStnId=t,this.fillThemeColour()}updateStnTransfer(t,e,s=null){super.updateStnTransfer(t,e,s),$("#stn_icons").empty(),this.drawStns()}set yPc(t){super.yPc=t;let e=t*this._svgHeight/50;$("g#main").attr("transform",`translate(0,${e})`)}}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvU3RhdGlvbi9TdGF0aW9uU0gudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL0xpbmUvTGluZVNILnRzIl0sIm5hbWVzIjpbImlkIiwiZGF0YSIsInN1cGVyIiwidGhpcyIsInN0bk51bSIsIm51bSIsInkiLCJuYW1lRU5MbiIsIm5hbWUiLCJzcGxpdCIsImxlbmd0aCIsImR4IiwiX25hbWVTaGlmdCIsIl90aWNrUm90YXRpb24iLCJNYXRoIiwiY29zIiwiaWNvblR5cGUiLCJudW1DbGFzcyIsInN0YXRlIiwic3RhdGlvbl9pZCIsIiQiLCJ0cmFuc2Zvcm0iLCJ4IiwiYXBwZW5kIiwiY2xhc3MiLCJkeSIsIl9keGR5IiwiYWRkQ2xhc3MiLCJ0ZXh0IiwiX2ludEluZm9zIiwiaW50ZXJjaGFuZ2UiLCJ1bmdycEhUTUwiLCJpY29uSFRNTCIsIm5hbWVIVE1MIiwiaW50VGlja0hUTUwiLCJzdHJva2UiLCJjb2xvdXIiLCJsaW5lRWxlbXMiLCJzdG5OYW1lRWxlbSIsImJjciIsImdldCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsInJpZ2h0IiwibGVmdCIsIm1hcCIsInN0biIsImluZGV4IiwibGluZUljb25Db2xvdXIiLCJsaW5lSWNvbkVsZW0iLCJmaWxsIiwibGluZU51bWJlciIsIlN0cmluZyIsIm5hbWVaSCIsIm1hdGNoIiwibGluZU5hbWUiLCJsaW5lTmFtZUVsZW0iLCJwdXNoIiwic3RuSW5mb0VsZW0iLCJwYXJlbnQiLCJhdHRyIiwicGFyYW0iLCJzdG5JZCIsInN0bkluZm8iLCJjaGFuZ2VfdHlwZSIsIl9wbGF0Zm9ybU51bSIsImZsYWdMZW5ndGgiLCJ3aWR0aCIsImlzTGVmdCIsIl9kaXJlY3Rpb24iLCJhcnJvd1giLCJfc3ZnRGVzdFdpZHRoIiwiYXJyb3dSb3RhdGUiLCJwbGF0Zm9ybU51bVgiLCJ0eHRBbmNob3IiLCJkZXN0TmFtZVgiLCJkZXN0aW5hdGlvbnNfemgiLCJkZXN0aW5hdGlvbnNfZW4iLCJmb3JFYWNoIiwic3RhdGlvbnMiLCJsaW5lTmFtZVgiLCJsaW5lTmFtZVpIIiwibGluZU5hbWVFTiIsIl9saW5lTmFtZXMiLCJfdGhlbWVDb2xvdXIiLCJoaWRlIiwiZGlyZWN0aW9uIiwic3RuSW5zdGFuY2UiLCJPYmplY3QiLCJlbnRyaWVzIiwiaW5jbHVkZXMiLCJodG1sIiwiZmlsdGVyIiwidW5ncnBJY29uSFRNTCIsInJlbW92ZUNsYXNzIiwiYnJhbmNoZXMiLCJicmFuY2giLCJsaW5lTWFpblN0bnMiLCJsaW5lUGFzc1N0bnMiLCJpbmRleE9mIiwidW5zaGlmdCIsInBhdGgiLCJfbGluZVBhdGgiLCJoIiwicG9zIiwiTnVtYmVyIiwiZCIsImZpbGxUaGVtZUNvbG91ciIsImxpbmUiLCJkcmF3U1ZHRnJhbWUiLCJzaG93RnJhbWVPdXRlciIsImRyYXdTdG5zIiwiZHJhd0xpbmUiLCJkcmF3U3RyaXAiLCJkcmF3RGVzdEluZm8iLCJsb2FkRm9udHMiLCJ1cGRhdGVTdG5OYW1lQmciLCJ2YWwiLCJjdXJyZW50U3RuSWQiLCJ0eXBlIiwiaW5mbyIsInVwZGF0ZVN0blRyYW5zZmVyIiwiZW1wdHkiLCJ5UGMiLCJfc3ZnSGVpZ2h0Il0sIm1hcHBpbmdzIjoia0hBS0EsTUFBTSxVQUFxQixJQUN2QixZQUFZQSxFQUFRQyxHQUNoQkMsTUFBTUYsRUFBSUMsR0FDVkUsS0FBS0MsT0FBU0gsRUFBS0ksSUFHdkIsaUJBQW1CLE9BQU8sRUFDMUIsb0JBQXNCLE9BQU9GLEtBQUtHLEVBQUksRUFBSSxJQUFNLEVBQ2hELFlBQ0ksSUFBSUMsRUFBV0osS0FBS0ssS0FBSyxHQUFHQyxNQUFNLE1BQU1DLE9BQ3hDLElBQUlDLEVBU0osT0FQSUEsRUFEQVIsS0FBS1MsV0FDdUIsSUFBdkJULEtBQUtVLGVBQXVCLEVBQUksR0FBc0IsSUFBaEJOLEVBQVcsR0FBVU8sS0FBS0MsS0FBSyxJQUU5QyxJQUF2QlosS0FBS1UsZUFBdUIsR0FBc0IsSUFBaEJOLEVBQVcsSUFBV08sS0FBS0MsS0FBSyxLQUFPLEVBSzNFLENBQUNKLEVBRndCLElB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QWEsR0FDaEN2RyxFQUFFLFVBQVV1QyxLQUFLLFlBQWEsZUFBZXJEIiwiZmlsZSI6IkxpbmVTSC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSTUdTdGF0aW9uLCBJbnRJbmZvVGFnLCBJbnRlcmNoYW5nZUluZm8gfSBmcm9tICcuL1N0YXRpb24nO1xyXG5pbXBvcnQgeyBJRCwgTmFtZSwgQnJhbmNoSW5mbywgU3RhdGlvbkluZm8gfSBmcm9tICcuLi91dGlscyc7XHJcblxyXG5jb25zdCBzdGF0aW9uX2lkID0gJ3N0bl9zaCdcclxuXHJcbmNsYXNzIFJNR1N0YXRpb25TSCBleHRlbmRzIFJNR1N0YXRpb24ge1xyXG4gICAgY29uc3RydWN0b3IoaWQ6IElELCBkYXRhOiBTdGF0aW9uSW5mbykge1xyXG4gICAgICAgIHN1cGVyKGlkLCBkYXRhKTtcclxuICAgICAgICB0aGlzLnN0bk51bSA9IGRhdGEubnVtO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBfbmFtZVNoaWZ0KCkgeyByZXR1cm4gZmFsc2U7IH1cclxuICAgIGdldCBfdGlja1JvdGF0aW9uKCkgeyByZXR1cm4gdGhpcy55ID4gMCA/IDE4MCA6IDA7IH1cclxuICAgIGdldCBfZHhkeSgpIHtcclxuICAgICAgICB2YXIgbmFtZUVOTG4gPSB0aGlzLm5hbWVbMV0uc3BsaXQoJ1xcXFwnKS5sZW5ndGg7XHJcbiAgICAgICAgbGV0IGR4OiBudW1iZXI7XHJcbiAgICAgICAgaWYgKHRoaXMuX25hbWVTaGlmdCkge1xyXG4gICAgICAgICAgICBkeCA9IHRoaXMuX3RpY2tSb3RhdGlvbiA9PT0gMCA/IC05IDogMTYgKyAobmFtZUVOTG4gLSAxKSAqIDEyICogTWF0aC5jb3MoLTQ1KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBkeCA9IHRoaXMuX3RpY2tSb3RhdGlvbiA9PT0gMCA/ICgyNCArIChuYW1lRU5MbiAtIDEpICogMTIpICogTWF0aC5jb3MoLTQ1KSA6IC02O1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBsZXQgZHggPSB0aGlzLl9uYW1lU2hpZnQgPyAtOCA6ICgyNCArIChuYW1lRU5Mbi0xKSoxMikgKiBNYXRoLmNvcygtNDUpO1xyXG4gICAgICAgIGxldCBkeSA9IHRoaXMuX3RpY2tSb3RhdGlvbiA9PT0gMCA/ICgtNCAtIDIxLjkyMTg3NSAtIChuYW1lRU5MbiAtIDEpICogMTIgKiBNYXRoLmNvcygtNDUpKSA6IDE3LjU7XHJcbiAgICAgICAgLy8gdmFyIGR5ID0gKC00IC0gMjEuOTIxODc1IC0gKG5hbWVFTkxuLTEpKjEyKk1hdGguY29zKC00NSkpICogKHRoaXMuX3RpY2tSb3RhdGlvbiA9PT0gMCA/IDEgOiAtMSk7XHJcbiAgICAgICAgcmV0dXJuIFtkeCwgZHldXHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGljb25IVE1MKCkge1xyXG4gICAgICAgIHZhciBbaWNvblR5cGUsIG51bUNsYXNzXSA9ICh0aGlzLnN0YXRlID09IC0xKSA/IFtzdGF0aW9uX2lkICsgJ19wYXNzJywgJ1Bhc3MnXSA6IFtzdGF0aW9uX2lkLCAnRnV0dXJlJ107XHJcbiAgICAgICAgcmV0dXJuICQoJzxnPicsIHsgdHJhbnNmb3JtOiBgdHJhbnNsYXRlKCR7dGhpcy54fSwke3RoaXMueX0pYCB9KVxyXG4gICAgICAgICAgICAuYXBwZW5kKCQoJzx1c2U+JywgeyAneGxpbms6aHJlZic6ICcjJyArIGljb25UeXBlLCBjbGFzczogJ3JtZy1zdG4nIH0pKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgbmFtZUhUTUwoKSB7XHJcbiAgICAgICAgbGV0IFtkeCwgZHldID0gdGhpcy5fZHhkeVxyXG4gICAgICAgIHJldHVybiAkKCc8Zz4nLCB7XHJcbiAgICAgICAgICAgICd0cmFuc2Zvcm0nOiBgdHJhbnNsYXRlKCR7dGhpcy54IC0gZHh9LCR7dGhpcy55ICsgZHl9KXJvdGF0ZSgtNjApYCxcclxuICAgICAgICAgICAgJ3RleHQtYW5jaG9yJzogdGhpcy5fdGlja1JvdGF0aW9uID09PSAwID8gJ3N0YXJ0JyA6ICdlbmQnLFxyXG4gICAgICAgICAgICAvLyBjbGFzczogYE5hbWUgJHt0aGlzLm5hbWVDbGFzc31gXHJcbiAgICAgICAgICAgIGNsYXNzOiBgTmFtZSBGdXR1cmVgICAvLyB0b2RvOiBmaXggdGhpc1xyXG4gICAgICAgIH0pLmFwcGVuZChcclxuICAgICAgICAgICAgJCgnPHRleHQ+JykuYWRkQ2xhc3MoJ3JtZy1uYW1lX196aCBybWctbmFtZV9fc2htZXRyby0tc3RhdGlvbicpLnRleHQodGhpcy5uYW1lWzBdKVxyXG4gICAgICAgICkuYXBwZW5kKFxyXG4gICAgICAgICAgICAkKCc8dGV4dD4nLCB7XHJcbiAgICAgICAgICAgICAgICBkeTogMTUsIGNsYXNzOiAncm1nLW5hbWVfX2VuIHJtZy1uYW1lX19zaG1ldHJvLS1zdGF0aW9uJ1xyXG4gICAgICAgICAgICB9KS50ZXh0KHRoaXMubmFtZVsxXS5zcGxpdCgnXFxcXCcpWzBdKS5hcHBlbmQoXHJcbiAgICAgICAgICAgICAgICAkKCc8dHNwYW4+Jywge1xyXG4gICAgICAgICAgICAgICAgICAgICd4JzogMCwgJ2R5JzogMTJcclxuICAgICAgICAgICAgICAgIH0pLnRleHQodGhpcy5uYW1lWzFdLnNwbGl0KCdcXFxcJylbMV0pXHJcbiAgICAgICAgICAgIClcclxuICAgICAgICApO1xyXG4gICAgfVxyXG59XHJcblxyXG5jbGFzcyBJbnRTdGF0aW9uU0ggZXh0ZW5kcyBSTUdTdGF0aW9uU0gge1xyXG4gICAgcHJvdGVjdGVkIF9pbnRJbmZvczogSW50ZXJjaGFuZ2VJbmZvW107XHJcblxyXG4gICAgY29uc3RydWN0b3IoaWQ6IElELCBkYXRhOiBTdGF0aW9uSW5mbykge1xyXG4gICAgICAgIHN1cGVyKGlkLCBkYXRhKTtcclxuICAgICAgICB0aGlzLl9pbnRJbmZvcyA9IGRhdGEuaW50ZXJjaGFuZ2VbMF07XHJcbiAgICB9XHJcblxyXG4gICAgLy8gcmV3cml0ZSB0aGlzIHRvIGFwcGVuZCBkb20gYW5kIHRoZW4gZ2V0Qm91bmRpbmdDbGllbnRSZWN0XHJcbiAgICAvLyB0byBnZXQgdGhlIGV4YWN0IHBvc2l0aW9uIHdoZXJlIGludCBpY29uIGNhbiBiZSBmaXRcclxuICAgIGdldCBodG1sKCkge1xyXG4gICAgICAgIHJldHVybiAkKCc8Zz4nLCB7IGlkOiB0aGlzLmlkIH0pLmFwcGVuZCguLi50aGlzLnVuZ3JwSFRNTCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gcmV3cml0ZSB0aGlzIHRvIGdldCBhbGwgZHJhd2luZyBmdW5jdGlvbiB0byBiZSBjYWxsZWRcclxuICAgIGdldCB1bmdycEhUTUwoKSB7XHJcbiAgICAgICAgcmV0dXJuIFt0aGlzLmljb25IVE1MLCB0aGlzLm5hbWVIVE1MXTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgdW5ncnBJY29uSFRNTCgpIHtcclxuICAgICAgICByZXR1cm4gWy4uLnRoaXMuaW50VGlja0hUTUxdXHJcbiAgICB9XHJcblxyXG4gICAgLy8gaW50ZXJjaGFuZ2Ugc3RhdGlvbiBpY29uIG9uIG1haW4gbGluZVxyXG4gICAgZ2V0IGljb25IVE1MKCkge1xyXG4gICAgICAgIHZhciBbaWNvblR5cGUsIG51bUNsYXNzXSA9ICh0aGlzLnN0YXRlID09IC0xKSA/IFsnaW50Ml9zaF9wYXNzJywgJ1Bhc3MnXSA6IFsnaW50Ml9zaCcsICdGdXR1cmUnXTtcclxuICAgICAgICByZXR1cm4gJCgnPGc+JywgeyB0cmFuc2Zvcm06IGB0cmFuc2xhdGUoJHt0aGlzLnh9LCR7dGhpcy55fSlgIH0pXHJcbiAgICAgICAgICAgIC5hcHBlbmQoJCgnPHVzZT4nLCB7ICd4bGluazpocmVmJzogJyMnICsgaWNvblR5cGUsIGNsYXNzOiAncm1nLXN0bicsIHN0cm9rZTogdGhpcy5faW50SW5mb3NbSW50SW5mb1RhZy5jb2xvdXJdIH0pKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyByZWd1bGFyIHN0YXRpb24gbmFtZVxyXG4gICAgZ2V0IG5hbWVIVE1MKCkge1xyXG4gICAgICAgIGxldCBbZHgsIGR5XSA9IHRoaXMuX2R4ZHk7XHJcbiAgICAgICAgLy8gd3JhcCB0aGUgbmFtZSwgZGVjcm9fbGluZSBhbmQgaW50X2xpbmUgdW5kZXIgZyBpbiBvcmRlciB0byByb3RhdGUgYXQgb25jZVxyXG4gICAgICAgIHJldHVybiAkKCc8Zz4nLCB7XHJcbiAgICAgICAgICAgIHRyYW5zZm9ybTogYHRyYW5zbGF0ZSgke3RoaXMueCAtIGR4fSwke3RoaXMueSArIGR5fSlgLCAgLy9yb3RhdGUoLTYwKVxyXG4gICAgICAgIH0pLmFwcGVuZChcclxuICAgICAgICAgICAgLy8gdGhlIG9yaWdpbmFsIG5hbWUgdGV4dFxyXG4gICAgICAgICAgICAkKCc8Zz4nLCB7XHJcbiAgICAgICAgICAgICAgICBpZDogYHJtZy1uYW1lX19zaG1ldHJvLS0ke3RoaXMuaWR9YCxcclxuICAgICAgICAgICAgICAgICd0ZXh0LWFuY2hvcic6IHRoaXMuX3RpY2tSb3RhdGlvbiA9PT0gMCA/ICdzdGFydCcgOiAnZW5kJyxcclxuICAgICAgICAgICAgICAgIGNsYXNzOiBgTmFtZSBGdXR1cmVgICAvLyB0b2RvOiBmaXggdGhpc1xyXG4gICAgICAgICAgICB9KS5hcHBlbmQoXHJcbiAgICAgICAgICAgICAgICAkKCc8dGV4dD4nKS5hZGRDbGFzcygncm1nLW5hbWVfX3poIHJtZy1uYW1lX19zaG1ldHJvLS1zdGF0aW9uJykudGV4dCh0aGlzLm5hbWVbMF0pXHJcbiAgICAgICAgICAgICkuYXBwZW5kKFxyXG4gICAgICAgICAgICAgICAgJCgnPHRleHQ+Jywge1xyXG4gICAgICAgICAgICAgICAgICAgIGR5OiAxNSwgY2xhc3M6ICdybWctbmFtZV9fZW4gcm1nLW5hbWVfX3NobWV0cm8tLXN0YXRpb24nXHJcbiAgICAgICAgICAgICAgICB9KS50ZXh0KHRoaXMubmFtZVsxXS5zcGxpdCgnXFxcXCcpWzBdKS5hcHBlbmQoXHJcbiAgICAgICAgICAgICAgICAgICAgJCgnPHRzcGFuPicsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ3gnOiAwLCAnZHknOiAxMlxyXG4gICAgICAgICAgICAgICAgICAgIH0pLnRleHQodGhpcy5uYW1lWzFdLnNwbGl0KCdcXFxcJylbMV0pXHJcbiAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgIClcclxuICAgICAgICApXHJcbiAgICB9XHJcblxyXG4gICAgLy8gaW50ZXJjaGFuZ2Ugc3RhdGlvbiBpY29uIGFmdGVyIHRoZSBzdGF0aW9uIG5hbWVcclxuICAgIGdldCBpbnRUaWNrSFRNTCgpIHtcclxuICAgICAgICBsZXQgbGluZUVsZW1zOiBKUXVlcnk8SFRNTEVsZW1lbnQ+W10gPSBbXVxyXG5cclxuICAgICAgICAvLyBnZXQgdGhlIGV4YWN0IHN0YXRpb24gbmFtZSB3aWR0aCBzbyB0aGF0IHRoZVxyXG4gICAgICAgIC8vIGludGVyY2hhbmdlIHN0YXRpb24gaWNvbiBjYW4gYmUgcmlnaHQgYWZ0ZXIgdGhlIHN0YXRpb24gbmFtZVxyXG4gICAgICAgIGxldCBzdG5OYW1lRWxlbSA9ICQoYCNybWctbmFtZV9fc2htZXRyby0tJHt0aGlzLmlkfWApXHJcbiAgICAgICAgbGV0IGJjciA9IHN0bk5hbWVFbGVtLmdldCgwKS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKVxyXG4gICAgICAgIGxldCBkeCA9IGJjci5yaWdodCAtIGJjci5sZWZ0ICsgNVxyXG5cclxuICAgICAgICB0aGlzLl9pbnRJbmZvcy5tYXAoKHN0biwgaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgLy8gaW50ZXJjaGFuZ2UgbGluZSBpY29uIGFmdGVyIHN0YXRpb24gbmFtZVxyXG4gICAgICAgICAgICB2YXIgbGluZUljb25Db2xvdXIgPSBzdG5bSW50SW5mb1RhZy5jb2xvdXJdO1xyXG4gICAgICAgICAgICB2YXIgbGluZUljb25FbGVtID0gJCgnPHVzZT4nLCB7XHJcbiAgICAgICAgICAgICAgICAneGxpbms6aHJlZic6ICcjaW50X3NoJyxcclxuICAgICAgICAgICAgICAgIGZpbGw6IGxpbmVJY29uQ29sb3VyLFxyXG4gICAgICAgICAgICAgICAgdHJhbnNmb3JtOiBgdHJhbnNsYXRlKCR7ZHggKyBpbmRleCAqIDI1fSwtMTIpYCxcclxuICAgICAgICAgICAgICAgIGNsYXNzOiAncm1nLWxpbmVfX3NobWV0cm8gcm1nLWxpbmVfX2NoYW5nZScsXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5zdGF0ZSA9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgbGluZUljb25FbGVtLmFkZENsYXNzKCdybWctbGluZV9fcGFzcycpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBsaW5lIHN0YXJ0cyB3aXRoIG51bWJlcnMgb3IgbGV0dGVyc1xyXG4gICAgICAgICAgICBsZXQgbGluZU51bWJlciA9IFN0cmluZyhzdG5bSW50SW5mb1RhZy5uYW1lWkhdKS5tYXRjaCgvKFxcZCopXFx3Ky8pXHJcbiAgICAgICAgICAgIGlmIChsaW5lTnVtYmVyKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbGluZU5hbWUgPSBsaW5lTnVtYmVyWzBdXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbGluZU5hbWUgPSBTdHJpbmcoc3RuW0ludEluZm9UYWcubmFtZVpIXSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBpbnRlcmNoYW5nZSBsaW5lIG5hbWVcclxuICAgICAgICAgICAgdmFyIGxpbmVOYW1lRWxlbSA9ICQoJzx0ZXh0PicsIHtcclxuICAgICAgICAgICAgICAgIC8vIFRvZG86IGZpeCB0aGlzIGhhcmQtY29kZWQgY2VudGVyKDYpIHBvc2l0aW9uXHJcbiAgICAgICAgICAgICAgICB0cmFuc2Zvcm06IGB0cmFuc2xhdGUoJHtkeCArIDYgKyBpbmRleCAqIDI1fSw4KWAsXHJcbiAgICAgICAgICAgICAgICBjbGFzczogJ3JtZy1uYW1lX196aCBybWctbmFtZV9fc2htZXRyby0tbGluZV9uYW1lJyxcclxuICAgICAgICAgICAgfSkudGV4dChsaW5lTmFtZSlcclxuXHJcbiAgICAgICAgICAgIGxpbmVFbGVtcy5wdXNoKGxpbmVJY29uRWxlbSwgbGluZU5hbWVFbGVtKVxyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICAgIC8vIHJvdGF0ZSB0aGUgc3RhdGlvbiBpbmZvIG5vd1xyXG4gICAgICAgIC8vIG90aGVyIHdpc2UgdGhlIGJjciB3aWxsIGJlIGluYWNjdXJhdGUgZHVlIHRvIHRoZSByb3RhdGlvblxyXG4gICAgICAgIGxldCBzdG5JbmZvRWxlbSA9IHN0bk5hbWVFbGVtLnBhcmVudCgpO1xyXG4gICAgICAgIHN0bkluZm9FbGVtLmF0dHIoJ3RyYW5zZm9ybScsIGAke3N0bkluZm9FbGVtLmF0dHIoJ3RyYW5zZm9ybScpfXJvdGF0ZSgtNjApYClcclxuXHJcbiAgICAgICAgcmV0dXJuIGxpbmVFbGVtcztcclxuICAgIH1cclxuXHJcbiAgICBnZXQgX25hbWVDbGFzcygpIHtcclxuICAgICAgICByZXR1cm4gKHRoaXMuc3RhdGUgPT0gLTEpID8gJ1Bhc3MnIDogJ0Z1dHVyZSc7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCB7IFJNR1N0YXRpb25TSCwgSW50U3RhdGlvblNILCBzdGF0aW9uX2lkIH07XHJcbiIsImltcG9ydCB7IFJNR0xpbmUgfSBmcm9tICcuL0xpbmUnO1xyXG5pbXBvcnQgeyBSTUdTdGF0aW9uU0gsIEludFN0YXRpb25TSCwgc3RhdGlvbl9pZCB9IGZyb20gJy4uL1N0YXRpb24vU3RhdGlvblNIJztcclxuaW1wb3J0IHsgUk1HU3RhdGlvbiB9IGZyb20gJy4uL1N0YXRpb24vU3RhdGlvbic7XHJcblxyXG5pbXBvcnQgeyBJRCwgTmFtZSwgU3RhdGlvbkluZm8sIFJNR1BhcmFtLCBzZXRQYXJhbXMgfSBmcm9tICcuLi91dGlscyc7XHJcblxyXG5leHBvcnQgY2xhc3MgUk1HTGluZVNIIGV4dGVuZHMgUk1HTGluZSB7XHJcbiAgICBjb25zdHJ1Y3RvcihwYXJhbSkge1xyXG4gICAgICAgIHN1cGVyKHBhcmFtKTtcclxuICAgIH1cclxuXHJcbiAgICBfaW5pdFN0bkluc3RhbmNlKHN0bklkOiBJRCwgc3RuSW5mbzogU3RhdGlvbkluZm8pOiBSTUdTdGF0aW9uIHtcclxuICAgICAgICBzd2l0Y2ggKHN0bkluZm8uY2hhbmdlX3R5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSAnaW50Mic6XHJcbiAgICAgICAgICAgIGNhc2UgJ2ludDNfbCc6XHJcbiAgICAgICAgICAgIGNhc2UgJ2ludDNfcic6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEludFN0YXRpb25TSChzdG5JZCwgc3RuSW5mbyk7XHJcbiAgICAgICAgICAgIGNhc2UgJ29zaTExX3VsJzpcclxuICAgICAgICAgICAgY2FzZSAnb3NpMTFfcGwnOlxyXG4gICAgICAgICAgICBjYXNlICdvc2kxMV91cic6XHJcbiAgICAgICAgICAgIGNhc2UgJ29zaTExX3ByJzpcclxuICAgICAgICAgICAgY2FzZSAnb3NpMTJfdWwnOlxyXG4gICAgICAgICAgICBjYXNlICdvc2kxMl9wbCc6XHJcbiAgICAgICAgICAgIGNhc2UgJ29zaTEyX3VyJzpcclxuICAgICAgICAgICAgY2FzZSAnb3NpMTJfcHInOlxyXG4gICAgICAgICAgICBjYXNlICdvc2kyMV91bCc6XHJcbiAgICAgICAgICAgIGNhc2UgJ29zaTIxX3BsJzpcclxuICAgICAgICAgICAgY2FzZSAnb3NpMjFfdXInOlxyXG4gICAgICAgICAgICBjYXNlICdvc2kyMV9wcic6XHJcbiAgICAgICAgICAgIGNhc2UgJ29zaTIyX3VsJzpcclxuICAgICAgICAgICAgY2FzZSAnb3NpMjJfcGwnOlxyXG4gICAgICAgICAgICBjYXNlICdvc2kyMl91cic6XHJcbiAgICAgICAgICAgIGNhc2UgJ29zaTIyX3ByJzpcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUk1HU3RhdGlvblNIKHN0bklkLCBzdG5JbmZvKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gZHJhdyB0aGUgZGVzdGluYXRpb25cclxuICAgIGRyYXdEZXN0SW5mbygpIHtcclxuICAgICAgICAkKCcjc3RhdGlvbl9pbmZvX3NobWV0cm8gPiAjcGxhdGZvcm0gPiB0ZXh0JykudGV4dCh0aGlzLl9wbGF0Zm9ybU51bSk7XHJcblxyXG4gICAgICAgIHZhciBiY3IgPSAkKCcjc3RhdGlvbl9pbmZvX3NobWV0cm8gPiAjZGVzdF90ZXh0JylbMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgICAgdmFyIGZsYWdMZW5ndGggPSAxNjAgKyAxNTAgKyBiY3Iud2lkdGggKyA0NSArIDUwO1xyXG5cclxuXHJcblxyXG4gICAgICAgIC8vIGFycm93XHJcbiAgICAgICAgdmFyIGlzTGVmdCA9ICh0aGlzLl9kaXJlY3Rpb24gPT0gJ2wnKSA/IDEgOiAtMTtcclxuICAgICAgICB2YXIgYXJyb3dYID0gKHRoaXMuX3N2Z0Rlc3RXaWR0aCAtIGlzTGVmdCAqIGZsYWdMZW5ndGgpIC8gMjA7XHJcbiAgICAgICAgYXJyb3dYID0gKHRoaXMuX2RpcmVjdGlvbiA9PSAnbCcpID8gYXJyb3dYIDogdGhpcy5fc3ZnRGVzdFdpZHRoIC0gMjA7XHJcbiAgICAgICAgdmFyIGFycm93Um90YXRlID0gOTAgKiAoMSAtIGlzTGVmdCk7XHJcbiAgICAgICAgJCgnI3N0YXRpb25faW5mb19zaG1ldHJvID4gI2Fycm93X2xlZnRfdXNlJykuYXR0cigndHJhbnNmb3JtJywgYHRyYW5zbGF0ZSgke2Fycm93WH0sMTM1KXJvdGF0ZSgke2Fycm93Um90YXRlfSlgKTtcclxuXHJcbiAgICAgICAgLy8gbm90IGluIHVzZSBub3dcclxuICAgICAgICB2YXIgcGxhdGZvcm1OdW1YID0gYXJyb3dYICsgaXNMZWZ0ICogKDE2MCArIDUwICsgNzUpO1xyXG4gICAgICAgICQoJyNzdGF0aW9uX2luZm9fc2htZXRybyA+ICNwbGF0Zm9ybScpLmF0dHIoJ3RyYW5zZm9ybScsIGB0cmFuc2xhdGUoJHtwbGF0Zm9ybU51bVh9LDEzMClgKTtcclxuXHJcbiAgICAgICAgLy8gbGlzdCB0aGUgZGVzdGluYXRpb24gdGV4dFxyXG4gICAgICAgIC8vIFRvZG86IGZpeCBzdmdfZGVzdF93aWR0aCowLjgsIHRoaXMgaGFzIG9ubHkgYmVlbiB0ZXN0ZWQgb24gMTAwMCB3aWR0aFxyXG4gICAgICAgIGlmICh0aGlzLl9kaXJlY3Rpb24gPT09ICdyJykge1xyXG4gICAgICAgICAgICB2YXIgdHh0QW5jaG9yID0gJ2VuZCc7XHJcbiAgICAgICAgICAgIHZhciBkZXN0TmFtZVggPSB0aGlzLl9zdmdEZXN0V2lkdGggKiAwLjg7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdmFyIHR4dEFuY2hvciA9ICdzdGFydCc7XHJcbiAgICAgICAgICAgIHZhciBkZXN0TmFtZVggPSB0aGlzLl9zdmdEZXN0V2lkdGggKiAwLjI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgICQoJyNzdGF0aW9uX2luZm9fc2htZXRybyA+ICNkZXN0X3RleHQnKS5hdHRyKHtcclxuICAgICAgICAgICAgdHJhbnNmb3JtOiBgdHJhbnNsYXRlKCR7ZGVzdE5hbWVYfSwxMzUpYCxcclxuICAgICAgICAgICAgJ3RleHQtYW5jaG9yJzogdHh0QW5jaG9yXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIGZvciBlYWNoIGxlZnQgdmFsaWQgZGVzdGluYXRpb25zLCBnZXQgdGhlIG5hbWUgZnJvbSBpZFxyXG4gICAgICAgIHZhciBbZGVzdGluYXRpb25zX3poLCBkZXN0aW5hdGlvbnNfZW5dID0gW1wiXCIsIFwiXCJdXHJcbiAgICAgICAgdGhpc1tgJHt0aGlzLl9kaXJlY3Rpb259VmFsaWREZXN0c2BdLmZvckVhY2goc3RuID0+IHtcclxuICAgICAgICAgICAgZGVzdGluYXRpb25zX3poICs9IHRoaXMuc3RhdGlvbnNbc3RuXS5uYW1lWzBdXHJcbiAgICAgICAgICAgIGRlc3RpbmF0aW9uc19lbiArPSB0aGlzLnN0YXRpb25zW3N0bl0ubmFtZVsxXVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgICQoJyNzdGF0aW9uX2luZm9fc2htZXRybyA+ICNkZXN0X3RleHQgPiB0ZXh0OmZpcnN0LWNoaWxkJykudGV4dChg5b6AJHtkZXN0aW5hdGlvbnNfemh9YClcclxuICAgICAgICAkKCcjc3RhdGlvbl9pbmZvX3NobWV0cm8gPiAjZGVzdF90ZXh0ID4gdGV4dDpsYXN0LWNoaWxkJykudGV4dChgVG8gJHtkZXN0aW5hdGlvbnNfZW59YClcclxuXHJcbiAgICAgICAgLy8gcHJlcGFyZSBmb3IgdGhlIGxpbmUgbmFtZVxyXG4gICAgICAgIGxldCBsaW5lTmFtZVggPSB0aGlzLl9kaXJlY3Rpb24gPT09ICdsJyA/IHRoaXMuX3N2Z0Rlc3RXaWR0aCA6IDMyMFxyXG4gICAgICAgIHZhciBbbGluZU5hbWVaSCwgbGluZU5hbWVFTl0gPSB0aGlzLl9saW5lTmFtZXM7XHJcblxyXG4gICAgICAgIC8vIGxpbmUgc3RhcnRzIHdpdGggbnVtYmVycyBvciBsZXR0ZXJzXHJcbiAgICAgICAgdmFyIGxpbmVOdW1iZXIgPSBsaW5lTmFtZVpILm1hdGNoKC8oXFxkKilcXHcrLylcclxuICAgICAgICBpZiAobGluZU51bWJlcikge1xyXG4gICAgICAgICAgICBsaW5lTmFtZVggLT0gMTgwO1xyXG4gICAgICAgICAgICBsaW5lTmFtZVpIID0gXCLlj7fnur9cIlxyXG4gICAgICAgICAgICAkKCcjc3RhdGlvbl9pbmZvX3NobWV0cm8gPiAjbGluZV9udW1iZXIgPiByZWN0JykuYXR0cih7XHJcbiAgICAgICAgICAgICAgICAnc3R5bGUnOiBgZmlsbDoke3RoaXMuX3RoZW1lQ29sb3VyfWAsXHJcbiAgICAgICAgICAgICAgICAndHJhbnNmb3JtJzogYHRyYW5zbGF0ZSgke2xpbmVOYW1lWCAtIDEyMH0sNzApYFxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAkKCcjc3RhdGlvbl9pbmZvX3NobWV0cm8gPiAjbGluZV9udW1iZXIgPiB0ZXh0JylcclxuICAgICAgICAgICAgICAgIC50ZXh0KGxpbmVOdW1iZXJbMF0pXHJcbiAgICAgICAgICAgICAgICAuYXR0cigndHJhbnNmb3JtJywgYHRyYW5zbGF0ZSgke2xpbmVOYW1lWCAtIDEwMH0sMTcwKWApXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbGluZU5hbWVYIC09IDI4MDtcclxuICAgICAgICAgICAgJCgnI3N0YXRpb25faW5mb19zaG1ldHJvID4gI2xpbmVfbnVtYmVyID4gcmVjdCcpLmF0dHIoe1xyXG4gICAgICAgICAgICAgICAgJ3N0eWxlJzogYGZpbGw6JHt0aGlzLl90aGVtZUNvbG91cn1gLFxyXG4gICAgICAgICAgICAgICAgJ3RyYW5zZm9ybSc6IGB0cmFuc2xhdGUoJHtsaW5lTmFtZVggLSAxMH0sNjApYCxcclxuICAgICAgICAgICAgICAgICd3aWR0aCc6IDI2MCxcclxuICAgICAgICAgICAgICAgICdoZWlnaHQnOiAxNTBcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgJCgnI3N0YXRpb25faW5mb19zaG1ldHJvID4gI2xpbmVfbnVtYmVyID4gdGV4dCcpLmhpZGUoKVxyXG5cclxuICAgICAgICAgICAgLy8gVG9kbzogc2V0IHRoZSBlbmcgaW4gdGhlIG1pZGRsZVxyXG4gICAgICAgICAgICAkKCcjc3RhdGlvbl9pbmZvX3NobWV0cm8gPiAjbGluZV9uYW1lX3RleHQgPiB0ZXh0Omxhc3QtY2hpbGQnKS5hdHRyKCdkeCcsIDEwKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gc2V0IHRoZSBsaW5lIG5hbWVcclxuICAgICAgICAkKCcjc3RhdGlvbl9pbmZvX3NobWV0cm8gPiAjbGluZV9uYW1lX3RleHQgPiB0ZXh0OmZpcnN0LWNoaWxkJykudGV4dChsaW5lTmFtZVpIKVxyXG4gICAgICAgICQoJyNzdGF0aW9uX2luZm9fc2htZXRybyA+ICNsaW5lX25hbWVfdGV4dCA+IHRleHQ6bGFzdC1jaGlsZCcpLnRleHQobGluZU5hbWVFTilcclxuICAgICAgICAkKCcjc3RhdGlvbl9pbmZvX3NobWV0cm8gPiAjbGluZV9uYW1lX3RleHQnKS5hdHRyKHtcclxuICAgICAgICAgICAgdHJhbnNmb3JtOiBgdHJhbnNsYXRlKCR7bGluZU5hbWVYfSwxMzUpYCxcclxuICAgICAgICAgICAgJ3RleHQtYW5jaG9yJzogJ3N0YXJ0J1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyB0aGUgbGFzdCBkZWNvcmF0aW9uIGxpbmVcclxuICAgICAgICBsZXQgZGlyZWN0aW9uID0gdGhpcy5fZGlyZWN0aW9uID09ICdsJyA/ICdsZWZ0JyA6ICdyaWdodCdcclxuICAgICAgICAkKCcjbGluZV9zaG1ldHJvX3VzZScpLmF0dHIoe1xyXG4gICAgICAgICAgICAneGxpbms6aHJlZic6IGAjbGluZV9zaG1ldHJvXyR7ZGlyZWN0aW9ufWAsXHJcbiAgICAgICAgICAgIHRyYW5zZm9ybTogYHRyYW5zbGF0ZSgwLDIyMClgLFxyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG5cclxuICAgIC8vIHJld3JpdGUgdGhpcyB0byBhcHBlbmQgZG9tIGFuZCB0aGVuIGdldEJvdW5kaW5nQ2xpZW50UmVjdFxyXG4gICAgLy8gdG8gZ2V0IHRoZSBleGFjdCBwb3NpdGlvbiB3aGVyZSBpbnQgaWNvbiBjYW4gYmUgZml0XHJcbiAgICBkcmF3U3RucygpIHtcclxuICAgICAgICBmb3IgKGxldCBbc3RuSWQsIHN0bkluc3RhbmNlXSBvZiBPYmplY3QuZW50cmllcyh0aGlzLnN0YXRpb25zKSkge1xyXG4gICAgICAgICAgICBpZiAoWydsaW5lc3RhcnQnLCAnbGluZWVuZCddLmluY2x1ZGVzKHN0bklkKSkgeyBjb250aW51ZTsgfVxyXG4gICAgICAgICAgICAkKCcjc3RuX2ljb25zJykuYXBwZW5kKHN0bkluc3RhbmNlLmh0bWwpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAkKCcjc3RuX2ljb25zJykuaHRtbCgkKCcjc3RuX2ljb25zJykuaHRtbCgpKTsgLy8gUmVmcmVzaCBET01cclxuXHJcbiAgICAgICAgZm9yIChsZXQgW3N0bklkLCBzdG5JbnN0YW5jZV0gb2YgT2JqZWN0LmVudHJpZXModGhpcy5zdGF0aW9ucylcclxuICAgICAgICAgICAgLmZpbHRlcihzdG4gPT4gc3RuWzFdIGluc3RhbmNlb2YgSW50U3RhdGlvblNIKSBhcyBbSUQsIEludFN0YXRpb25TSF1bXSkge1xyXG4gICAgICAgICAgICAkKGAjcm1nLW5hbWVfX3NobWV0cm8tLSR7c3RuSWR9YCkucGFyZW50KCkuYXBwZW5kKHN0bkluc3RhbmNlLnVuZ3JwSWNvbkhUTUwpXHJcbiAgICAgICAgfVxyXG4gICAgICAgICQoJyNzdG5faWNvbnMnKS5odG1sKCQoJyNzdG5faWNvbnMnKS5odG1sKCkpOyAvLyBSZWZyZXNoIERPTVxyXG4gICAgfVxyXG5cclxuICAgIC8vIGRyYXcgdGhlIGxpbmUgaW4gcmFpbG1hcFxyXG4gICAgZHJhd0xpbmUoKSB7XHJcbiAgICAgICAgJCgnLnJtZy1saW5lJykucmVtb3ZlQ2xhc3MoJ3JtZy1saW5lX19tdHInKS5hZGRDbGFzcygncm1nLWxpbmVfX3NobWV0cm8nKTtcclxuXHJcbiAgICAgICAgdGhpcy5icmFuY2hlcy5tYXAoYnJhbmNoID0+IHtcclxuICAgICAgICAgICAgdmFyIGxpbmVNYWluU3RucyA9IGJyYW5jaC5maWx0ZXIoc3RuSWQgPT4gdGhpcy5zdGF0aW9uc1tzdG5JZF0uc3RhdGUgPj0gMCk7XHJcbiAgICAgICAgICAgIHZhciBsaW5lUGFzc1N0bnMgPSBicmFuY2guZmlsdGVyKHN0bklkID0+IHRoaXMuc3RhdGlvbnNbc3RuSWRdLnN0YXRlIDw9IDApO1xyXG5cclxuICAgICAgICAgICAgaWYgKGxpbmVNYWluU3Rucy5sZW5ndGggPT09IDEpIHtcclxuICAgICAgICAgICAgICAgIGxpbmVQYXNzU3RucyA9IGJyYW5jaDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGxpbmVNYWluU3Rucy5maWx0ZXIoc3RuSWQgPT4gbGluZVBhc3NTdG5zLmluZGV4T2Yoc3RuSWQpICE9PSAtMSkubGVuZ3RoID09IDAgJiYgbGluZU1haW5TdG5zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgLy8gaWYgdHdvIHNldCBkaXNqb2ludFxyXG4gICAgICAgICAgICAgICAgaWYgKGxpbmVQYXNzU3Ruc1swXSA9PT0gYnJhbmNoWzBdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gLTEgLTEgMSAxXHJcbiAgICAgICAgICAgICAgICAgICAgbGluZVBhc3NTdG5zLnB1c2gobGluZU1haW5TdG5zWzBdKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobGluZU1haW5TdG5zWzBdID09PSBicmFuY2hbMF0gJiYgbGluZU1haW5TdG5zW2xpbmVNYWluU3Rucy5sZW5ndGggLSAxXSA9PT0gYnJhbmNoW2JyYW5jaC5sZW5ndGggLSAxXSAmJiBsaW5lUGFzc1N0bnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGluZVBhc3NTdG5zID0gYnJhbmNoO1xyXG4gICAgICAgICAgICAgICAgICAgIGxpbmVNYWluU3RucyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyAxIDEgLTEgLTFcclxuICAgICAgICAgICAgICAgICAgICBsaW5lUGFzc1N0bnMudW5zaGlmdChsaW5lTWFpblN0bnNbbGluZU1haW5TdG5zLmxlbmd0aCAtIDFdKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gc3RyZXRjaCB0aGUgbWFpbiBsaW5lXHJcbiAgICAgICAgICAgIHZhciBwYXRoID0gdGhpcy5fbGluZVBhdGgobGluZU1haW5TdG5zKVxyXG4gICAgICAgICAgICB2YXIgW3gsIHksIGhdID0gcGF0aC5tYXRjaCgvW1xcZC5dKy9nKS5tYXAocG9zID0+IE51bWJlcihwb3MpKVxyXG4gICAgICAgICAgICBpZiAodGhpcy5fZGlyZWN0aW9uID09PSAncicpIHtcclxuICAgICAgICAgICAgICAgIHBhdGggPSBgTSAke3h9LCR7eSAtIDZ9IEggJHtoICsgMzB9IGwgMTIsMTIgTCAke3h9LCR7eSArIDZ9IFpgXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBwYXRoID0gYE0gJHt4IC0gMzB9LCR7eSAtIDZ9IEggJHtofSBsIDAsMTIgTCAke3ggLSA0Mn0sJHt5ICsgNn0gWmBcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gZHJhdyB0aGUgbWFpbiBsaW5lXHJcbiAgICAgICAgICAgICQoJyNsaW5lX21haW4nKS5hcHBlbmQoJCgnPHBhdGg+JywgeyBpZDogJ2xpbmVfbWFpbl9wYXRoJywgZDogcGF0aCB9KSk7XHJcblxyXG4gICAgICAgICAgICAvLyBzdHJldGNoIHRoZSBwYXNzIGxpbmVcclxuICAgICAgICAgICAgdmFyIHBhdGggPSB0aGlzLl9saW5lUGF0aChsaW5lUGFzc1N0bnMpXHJcbiAgICAgICAgICAgIHZhciBbeCwgeSwgaF0gPSBwYXRoLm1hdGNoKC9bXFxkLl0rL2cpLm1hcChwb3MgPT4gTnVtYmVyKHBvcykpXHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9kaXJlY3Rpb24gPT09ICdyJykge1xyXG4gICAgICAgICAgICAgICAgcGF0aCA9IGBNICR7eCAtIDMwfSwke3kgLSA2fSBIICR7aH0gbCAwLDEyIEwgJHt4IC0gMzB9LCR7eSArIDZ9IFpgXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBwYXRoID0gYE0gJHt4fSwke3kgLSA2fSBIICR7aCArIDMwfSBsIDAsMTIgTCAke3h9LCR7eSArIDZ9IFpgXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIGRyYXcgdGhlIHBhc3MgbGluZVxyXG4gICAgICAgICAgICAkKCcjbGluZV9wYXNzJykuYXBwZW5kKCQoJzxwYXRoPicsIHsgaWQ6ICdsaW5lX3Bhc3NfcGF0aCcsIGQ6IHBhdGggfSkpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAkKCcjbGluZV9tYWluJykuaHRtbCgkKCcjbGluZV9tYWluJykuaHRtbCgpKTtcclxuICAgICAgICAkKCcjbGluZV9wYXNzJykuaHRtbCgkKCcjbGluZV9wYXNzJykuaHRtbCgpKTtcclxuICAgIH1cclxuXHJcbiAgICBmaWxsVGhlbWVDb2xvdXIoKSB7XHJcbiAgICAgICAgc3VwZXIuZmlsbFRoZW1lQ29sb3VyKCk7XHJcblxyXG4gICAgICAgIC8vIHRoaXMgd2lsbCBhZGQgdGhlIHN0cm9rZSBvZiB0aGUgc3RhdGlvbiBjaXJjbGVcclxuICAgICAgICAvLyBob3dldmVyIHRoZSBzdHJva2UgcGF0aCBpcyBkZWZpbmVkIGluIGluZGV4Lmh0bWxcclxuICAgICAgICAvLyB3aGljaCBtYWRlIGNoYW5naW5nIHN0YXRpb24gc3R5bGUgc3RyYW5nZVxyXG4gICAgICAgICQoJ3BhdGgjJyArIHN0YXRpb25faWQpLmF0dHIoJ3N0cm9rZScsIHRoaXMuX3RoZW1lQ29sb3VyKTtcclxuICAgICAgICAkKCdwYXRoI2ludDJfc2gnKS5hdHRyKCdzdHJva2UnLCB0aGlzLl90aGVtZUNvbG91cik7XHJcblxyXG4gICAgICAgIC8vIHBhc3Mgc3Ryb2tlIHNob3VsZCBiZSBhZGRlZCBzb21ld2hlcmUgZWxzZVxyXG4gICAgICAgIC8vIGJ1dCBJIGNhbid0IGZpZ3VyZSBpdCBvdXRcclxuICAgICAgICAkKCdwYXRoI3N0bl9zaF9wYXNzJykuYXR0cignc3Ryb2tlJywgJyNhYWEnKTtcclxuICAgICAgICAkKCdwYXRoI2ludDJfc2hfcGFzcycpLmF0dHIoJ3N0cm9rZScsICcjYWFhJyk7XHJcblxyXG4gICAgICAgIC8vIHRoZSByYWlsbWFwIG1haW4gbGluZVxyXG4gICAgICAgICQoJ3BhdGgjbGluZV9tYWluX3BhdGgnKS5hdHRyKCdmaWxsJywgdGhpcy5fdGhlbWVDb2xvdXIpXHJcbiAgICAgICAgJCgncGF0aCNsaW5lX3Bhc3NfcGF0aCcpLmF0dHIoJ2ZpbGwnLCAnI2FhYScpXHJcblxyXG4gICAgICAgIC8vIHRoZSBsYXN0IGRlY29yYXRpb24gbGluZVxyXG4gICAgICAgIGxldCBkaXJlY3Rpb24gPSB0aGlzLl9kaXJlY3Rpb24gPT0gJ2wnID8gJ2xlZnQnIDogJ3JpZ2h0J1xyXG4gICAgICAgICQoYCNsaW5lX3NobWV0cm9fJHtkaXJlY3Rpb259YCkuYXR0cignZmlsbCcsIHRoaXMuX3RoZW1lQ29sb3VyKVxyXG5cclxuICAgICAgICBpZiAodGhpcy5fbGluZU5hbWVzWzBdLm1hdGNoKC8oXFxkKilcXHcrLykpIHtcclxuICAgICAgICAgICAgLy8gdGhlIGxpbmUgc3RhcnRzIHdpdGggbnVtYmVyXHJcbiAgICAgICAgICAgICQoJyNzdGF0aW9uX2luZm9fc2htZXRybyA+ICNsaW5lX251bWJlciA+IHRleHQnKS5hdHRyKCdmaWxsJywgJyNmZmYnKVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIHRoZSBsaW5lIHN0YXJ0cyB3aXRoIGxldHRlclxyXG4gICAgICAgICAgICAkKCcjc3RhdGlvbl9pbmZvX3NobWV0cm8gPiAjbGluZV9uYW1lX3RleHQnKS5hdHRyKCdmaWxsJywgJyNmZmYnKVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGVTdG5OYW1lQmcoKSB7XHJcbiAgICAgICAgJCgnI2N1cnJlbnRfYmcnKS5oaWRlKCk7ICAvLyBmaXggdGhlIG15c3RlcmlvdXMgYmxhY2sgcmVjdFxyXG4gICAgfVxyXG5cclxuICAgIC8vIHJld3JpdGUgdGhpcyB0byBtYWtlIHN1cmUgdGhlIGxpbmUgaXMgZHJhdyBiZWZvcmUgY29sb3JcclxuICAgIHN0YXRpYyBpbml0U1ZHKGxpbmUpIHtcclxuICAgICAgICBsaW5lLmRyYXdTVkdGcmFtZSgpO1xyXG4gICAgICAgIGxpbmUuc2hvd0ZyYW1lT3V0ZXIoKTtcclxuICAgICAgICBsaW5lLmRyYXdTdG5zKCk7XHJcblxyXG4gICAgICAgIC8vIGNoYW5nZSB0aGUgZnVuYyBjYWxsIGhlcmVcclxuICAgICAgICBsaW5lLmRyYXdMaW5lKCk7XHJcbiAgICAgICAgbGluZS5maWxsVGhlbWVDb2xvdXIoKTtcclxuICAgICAgICAvLyBjaGFuZ2UgdGhlIGZ1bmMgY2FsbCBoZXJlXHJcblxyXG4gICAgICAgIGxpbmUuZHJhd1N0cmlwKCk7XHJcbiAgICAgICAgbGluZS5kcmF3RGVzdEluZm8oKTtcclxuICAgICAgICBsaW5lLmxvYWRGb250cygpO1xyXG4gICAgICAgIGxpbmUudXBkYXRlU3RuTmFtZUJnKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gcmV3cml0ZSB0aGlzIHRvIGNhbGwgZmlsbFRoZW1lQ29sb3VyIHdoZW4gZmxpcCBkaXJlY3Rpb25cclxuICAgIHNldCBkaXJlY3Rpb24odmFsKSB7XHJcbiAgICAgICAgc3VwZXIuZGlyZWN0aW9uID0gdmFsXHJcblxyXG4gICAgICAgIHRoaXMuZmlsbFRoZW1lQ29sb3VyKClcclxuICAgIH1cclxuXHJcbiAgICAvLyByZXdyaXRlIHRoaXMgdG8gY2FsbCBmaWxsVGhlbWVDb2xvdXIgd2hlbiBzZXQgY3VycmVudCBzdGF0aW9uXHJcbiAgICBzZXQgY3VycmVudFN0bklkKHZhbCkge1xyXG4gICAgICAgIHN1cGVyLmN1cnJlbnRTdG5JZCA9IHZhbFxyXG5cclxuICAgICAgICB0aGlzLmZpbGxUaGVtZUNvbG91cigpXHJcbiAgICB9XHJcblxyXG4gICAgLy8gcmV3cml0ZSB0aGlzIHRvIGdldCBkcmF3U3RucyByZWNhbGxlZFxyXG4gICAgdXBkYXRlU3RuVHJhbnNmZXIoc3RuSWQ6IElELCB0eXBlLCBpbmZvID0gbnVsbCkge1xyXG4gICAgICAgIHN1cGVyLnVwZGF0ZVN0blRyYW5zZmVyKHN0bklkLCB0eXBlLCBpbmZvKVxyXG5cclxuICAgICAgICAvLyBjbGVhciB0aGUgb3JpZ2luYWwgc3RhdGlvbnNcclxuICAgICAgICAkKCcjc3RuX2ljb25zJykuZW1wdHkoKVxyXG4gICAgICAgIHRoaXMuZHJhd1N0bnMoKVxyXG4gICAgfVxyXG5cclxuICAgIC8vIHJld3JpdGUgdGhpcyB0byBjaGFuZ2UgdGhlIHJhaWxtYXAgcG9zaXRpb25cclxuICAgIHNldCB5UGModmFsKSB7XHJcbiAgICAgICAgc3VwZXIueVBjID0gdmFsXHJcbiAgICAgICAgXHJcbiAgICAgICAgbGV0IHkgPSB2YWwgKiB0aGlzLl9zdmdIZWlnaHQgLyA1MDtcclxuICAgICAgICAkKCdnI21haW4nKS5hdHRyKCd0cmFuc2Zvcm0nLCBgdHJhbnNsYXRlKDAsJHt5fSlgKTtcclxuICAgIH1cclxuXHJcbn1cclxuIl0sInNvdXJjZVJvb3QiOiIifQ==